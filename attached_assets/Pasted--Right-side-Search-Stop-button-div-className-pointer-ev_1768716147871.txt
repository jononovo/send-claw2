            {/* Right side: Search/Stop button */}
            <div className="pointer-events-auto">
<<<<<<< 260117_fix_compose-drawer_compresses_search-input-field
              <Button 
                type="submit"
                onClick={handleSearch} 
                disabled={isAnalyzing || quickSearchMutation.isPending}
                className={`
                  rounded-md
                  transition-all duration-300 flex items-center gap-2
                  ${lastExecutedQuery && !inputHasChanged 
                    ? 'bg-secondary hover:bg-secondary-hover shadow-md hover:shadow-lg text-muted-foreground' 
                    : 'bg-gradient-to-r from-accent-light to-accent hover:from-accent hover:to-accent text-white shadow-md hover:shadow-lg'
                  }
                `}
                aria-label="Search"
                data-testid="search-button"
              >
                {(isAnalyzing || quickSearchMutation.isPending) ? (
                  <>
                    <Loader2 className="h-4 w-4 animate-spin" />
                    <span>Searching...</span>
                  </>
                ) : (
                  <>
                    <Search className="h-4 w-4" />
                    <span>Search</span>
                  </>
                )}
              </Button>
=======
              {(() => {
                const isSearchActive = isAnalyzing || quickSearchMutation.isPending || isPolling;
                return (
                  <Button 
                    type={isSearchActive ? "button" : "submit"}
                    onClick={isSearchActive ? handleStopSearch : handleSearch}
                    disabled={!isSearchActive && (isAnalyzing || quickSearchMutation.isPending)}
                    className={`
                      rounded-md group
                      transition-all duration-300 flex items-center gap-2
                      ${lastExecutedQuery && !inputHasChanged && !isSearchActive
                        ? 'bg-gray-200 hover:bg-gray-300 dark:bg-gray-400 dark:hover:bg-gray-500 shadow-md hover:shadow-lg text-gray-700 dark:text-gray-900' 
                        : 'bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 shadow-md hover:shadow-lg'
                      }
                    `}
                    aria-label={isSearchActive ? "Stop Search" : "Search"}
                    data-testid={isSearchActive ? "stop-search-button" : "search-button"}
                  >
                    {isSearchActive ? (
                      <>
                        {/* Desktop: Searching by default, Stop on hover */}
                        <Loader2 className="h-4 w-4 animate-spin hidden md:block md:group-hover:hidden" />
                        <span className="hidden md:block md:group-hover:hidden">Searching</span>
                        {/* Desktop hover + Mobile default: Stop */}
                        <Square className="h-4 w-4 block md:hidden md:group-hover:block" />
                        <span className="block md:hidden md:group-hover:block">Stop</span>
                      </>
                    ) : (
                      <>
                        <Search className="h-4 w-4" />
                        <span>Search</span>
                      </>
                    )}
                  </Button>
                );
              })()}
>>>>>>> main
            </div>
          </div>
        </div>