Technical Plan: Fix Double-Reload Bug
Problem Summary
Home component mounts twice on browser back, each time restoring from localStorage and fetching from DB, causing glitchy double-reload.

Root Cause
localStorage is being treated as source of truth alongside URL routing, creating race conditions and stale state resurrection.

Touchpoints Identified
File	localStorage writes	localStorage reads
home.tsx	5 writes, 4 removes	2 reads
useSearchState.ts	1 write	2 reads
prompt-editor.tsx	1 write	1 read
useEmailSearchOrchestration.ts	1 write	0 reads
Total: 8+ localStorage writes, 5+ reads for searchState alone

Implementation Plan
Phase A: Create Session-Only Helper (~30 lines)
Create client/src/features/search-state/searchSessionStorage.ts:

// Simple helper for session-scoped search state
export const searchSessionStorage = {
  load: (): SavedSearchState | null => { /* sessionStorage only */ },
  save: (state: SavedSearchState) => { /* sessionStorage only */ },
  clear: () => sessionStorage.removeItem('searchState')
};
Phase B: Wire Up Route-Aware Cleanup
In home.tsx, add cleanup effect:

// Clear session state when navigating AWAY from /app
useEffect(() => {
  return () => {
    if (isNewSearch) { // Only on /app/new-search route
      searchSessionStorage.clear();
    }
  };
}, []);
Phase C: Simplify /app Mount Logic
Replace the current mount effect (~100 lines) with:

Check for pendingSearchQuery (landing page flow) - keep as-is
If on /app: Load from sessionStorage helper, restore if exists
If on /search/:slug/:listId: Do not restore - let URL-based fetch handle it
Phase D: URL-Based Fetch for Saved Searches
For /search/:slug/:listId routes:

Skip all localStorage/sessionStorage restoration
Use existing handleLoadSavedSearch which fetches from API
This becomes the single source of truth
Phase E: Remove Legacy Code
Remove hasSessionRestoredDataRef, isInitializedRef refs (no longer needed)
Remove refreshAndUpdateResults database refresh on mount (fetch once from API)
Remove scattered localStorage.setItem('searchState', ...) calls
Keep only pendingSearchQuery for landing page flow
Keep lastEmailSearchTimestamp but migrate to sessionStorage
Validation Checklist
Scenario	Current	After Fix
Refresh on /app with results	✓ Works (localStorage)	✓ Works (sessionStorage)
Navigate away, back to /app	❌ Stale state resurrects	✓ Clean slate
Browser back to saved search	❌ Double load	✓ Single API fetch
Drawer → saved search	✓ Works	✓ Works (unchanged)
Landing page → /app	✓ Works	✓ Works (pendingSearchQuery kept)
Email search persistence	✓ Works	✓ Works (timestamp in sessionStorage)
Risk Analysis
Risk	Mitigation
Email updates not persisted	Keep onContactUpdate saving to sessionStorage
Landing page flow breaks	pendingSearchQuery stays in localStorage (cross-page)
Saved search drawer breaks	No change - it navigates to URL, triggers API fetch
Files to Modify
client/src/features/search-state/searchSessionStorage.ts (NEW)
client/src/features/search-state/useSearchState.ts (simplify, use new helper)
client/src/pages/home.tsx (major cleanup, ~150 lines removed)
client/src/components/prompt-editor.tsx (switch to sessionStorage helper)
client/src/features/email-search-orchestration/useEmailSearchOrchestration.ts (switch to sessionStorage)
