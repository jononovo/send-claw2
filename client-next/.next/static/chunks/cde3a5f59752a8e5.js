(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,17484,93823,36308,37931,e=>{"use strict";var t=e.i(43476),a=e.i(37727),s=e.i(63488),r=e.i(73375),i=e.i(63059),n=e.i(75254);let l=(0,n.default)("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]),o=(0,n.default)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var d=e.i(98361),c=e.i(26336),m=e.i(71645),u=e.i(37880),p=e.i(6625),x=e.i(54460),h=e.i(64659),g=e.i(55900),f=e.i(61911),b=e.i(52301),j=e.i(66027),y=e.i(54616),v=e.i(84923),N=e.i(58260);async function w(e){return(await (0,v.apiRequest)("POST","/api/generate-email",e)).json()}function C(e,t,a,s,r){let i=e,n=0,l=0;for(;n<s&&l<i.length;){let e=i.indexOf(t,l);if(-1===e)break;let s=i.substring(Math.max(0,e-20),e),r=i.substring(e,Math.min(i.length,e+t.length+20));if(s.includes("@")||s.includes("://")||r.includes("@")||r.includes(".com")||r.includes(".org")){l=e+t.length;continue}i=i.substring(0,e)+a+i.substring(e+t.length),n++,l=e+a.length}return i}function S(e,t){return!!(RegExp(`[\\w.-]+@[\\w.-]*${t}[\\w.-]*`,"i").test(e)||RegExp(`(https?://|www\\.).*${t}`,"i").test(e)||RegExp(`${t}\\.(com|org|net|io|co|app)`,"i").test(e))}function k(e,t){let a=e.match(RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"));return a?a.length:0}function T(e,t){let a=e.match(RegExp(t.replace(/[{}]/g,"\\$&"),"g"));return a?a.length:0}var D=e.i(84401),P=e.i(94318);let E=[{id:"silly",name:"Silly",description:"Playful jokes and lighthearted humor"},{id:"friendly",name:"Friendly",description:"Really warm, overly friendly and enthusiastic"},{id:"default",name:"Casual",description:"Not trying too hard and nonchalant"},{id:"direct",name:"Professional",description:"Direct but Professional - Confident and polite"},{id:"abrupt",name:"Abrupt",description:"Sometimes effective in getting leadership attention"},{id:"beast",name:"BEAST",description:"Impossible to ignore. Ranges wild to insane"},{id:"genz",name:"Gen-Z",description:"Text-style messaging with smart business focus"}],M=[{id:"none",name:"None",description:"No special offer strategy"},{id:"hormozi",name:"Hormozi",description:"Benefit stacking that makes price negligible"},{id:"oneOnOne",name:"1-on-1",description:"15 minutes personalized guidance and FREE setup"},{id:"ifWeCant",name:"Guarantee",description:"Guarantee-based with compelling backup offer"},{id:"shinyFree",name:"Shiny",description:"Free valuable resources like cheat sheets, API keys"},{id:"caseStudy",name:"Study",description:"Social proof with specific company results"},{id:"coldEmailFormula",name:"Formula",description:"5-part proven framework with 37% open rate"}];var A=e.i(84589),I=e.i(91593),F=e.i(87957),q=e.i(67244),L=e.i(55436);let O=(0,n.default)("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);var $=e.i(7233);function _({open:e,onOpenChange:a,currentListId:s,currentQuery:r,onSelect:i}){let[n,l]=(0,m.useState)("current"),[o,d]=(0,m.useState)(new Set),[c,u]=(0,m.useState)(""),{data:x=[]}=(0,j.useQuery)({queryKey:["/api/lists"],enabled:e&&"multiple"===n}),{data:h=[]}=(0,j.useQuery)({queryKey:["/api/contact-lists"],enabled:e&&"existing"===n}),g="current"===n&&(!s||!r)||"multiple"===n&&0===o.size||"existing"===n&&!c;return(0,t.jsx)(A.Dialog,{open:e,onOpenChange:a,children:(0,t.jsxs)(A.DialogContent,{className:"max-w-2xl",children:[(0,t.jsxs)(A.DialogHeader,{children:[(0,t.jsx)(A.DialogTitle,{children:"Select Campaign Recipients"}),(0,t.jsx)(A.DialogDescription,{children:"Choose how you want to select recipients for this campaign"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("button",{onClick:()=>l("current"),className:(0,b.cn)("w-full text-left p-4 rounded-lg border-2 transition-all","current"===n?"border-primary bg-primary/5":"border-border hover:border-muted-foreground/50"),disabled:!s||!r,children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(L.Search,{className:"h-5 w-5 mt-0.5 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-medium",children:"Current Search Results"}),r?(0,t.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:['"',r,'"']}):(0,t.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:"No active search available"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground mt-2",children:"This will create a new contact list from your current search"})]})]})}),(0,t.jsxs)("button",{onClick:()=>l("multiple"),className:(0,b.cn)("w-full text-left p-4 rounded-lg border-2 transition-all","multiple"===n?"border-primary bg-primary/5":"border-border hover:border-muted-foreground/50"),children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(O,{className:"h-5 w-5 mt-0.5 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-medium",children:"Include Multiple Search Lists"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground mt-2",children:"Combine contacts from multiple saved searches"})]})]}),"multiple"===n&&x.length>0&&(0,t.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,t.jsx)(F.ScrollArea,{className:"h-48 mt-3 border rounded-md p-2",children:x.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2 p-2 hover:bg-muted rounded",children:[(0,t.jsx)(I.Checkbox,{id:`list-${e.id}`,checked:o.has(e.listId),onCheckedChange:()=>{var t;let a;return t=e.listId,void((a=new Set(o)).has(t)?a.delete(t):a.add(t),d(a))}}),(0,t.jsxs)("label",{htmlFor:`list-${e.id}`,className:"flex-1 text-sm cursor-pointer",children:[(0,t.jsx)("div",{className:"font-medium",children:e.prompt}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.resultCount," companies â€¢ ID: ",e.listId]})]})]},e.id))})})]}),(0,t.jsxs)("button",{onClick:()=>l("existing"),className:(0,b.cn)("w-full text-left p-4 rounded-lg border-2 transition-all","existing"===n?"border-primary bg-primary/5":"border-border hover:border-muted-foreground/50"),children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(f.Users,{className:"h-5 w-5 mt-0.5 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-medium",children:"Use Existing Contact List"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground mt-2",children:"Select from your saved contact lists"})]})]}),"existing"===n&&(0,t.jsx)("div",{className:"mt-3",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)(q.Select,{value:c,onValueChange:u,children:[(0,t.jsx)(q.SelectTrigger,{children:(0,t.jsx)(q.SelectValue,{placeholder:"Choose a contact list"})}),(0,t.jsx)(q.SelectContent,{children:h.map(e=>(0,t.jsx)(q.SelectItem,{value:e.id.toString(),children:(0,t.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground ml-2",children:[e.contactCount," contacts"]})]})},e.id))})]})})]})]}),(0,t.jsxs)(A.DialogFooter,{children:[(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),(0,t.jsxs)(p.Button,{onClick:()=>{if("current"===n&&s&&r)i({type:"current",listId:s,query:r});else if("multiple"===n&&o.size>0){let e=Array.from(o),t=x.find(t=>t.listId===e[0]);i({type:"multiple",searchListIds:e,targetAudienceQuery:t?.prompt})}else if("existing"===n&&c){let e=h.find(e=>e.id.toString()===c);e&&i({type:"existing",contactListId:e.id,contactListName:e.name})}a(!1)},disabled:g,children:[(0,t.jsx)($.Plus,{className:"h-4 w-4 mr-2"}),"Create Campaign"]})]})]})})}var R=e.i(16112),z=e.i(24487),G=e.i(87316);let H=(0,n.default)("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);var B=e.i(52571);let K=(0,n.default)("MailCheck",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8",key:"12jkf8"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]);var Q=e.i(21345),V=e.i(82293),U=e.i(69638),W=e.i(63209),J=e.i(84614),Y=e.i(33356),X=e.i(32076),Z=e.i(45919);function ee({open:e,onOpenChange:a,selectedDate:s,selectedTime:r="09:00",onApply:i}){let[n,l]=(0,m.useState)(s||new Date),[o,d]=(0,m.useState)(r);return(0,t.jsx)(A.Dialog,{open:e,onOpenChange:a,children:(0,t.jsxs)(A.DialogContent,{className:"sm:max-w-[425px] p-0",children:[(0,t.jsx)(A.DialogHeader,{className:"px-6 pt-6 pb-2",children:(0,t.jsx)(A.DialogTitle,{className:"text-2xl font-semibold",children:"Settings"})}),(0,t.jsx)("div",{className:"px-6 pb-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-3 text-lg",children:[(0,t.jsx)("span",{children:"Schedule send"}),(0,t.jsx)(G.Calendar,{className:"h-5 w-5 text-muted-foreground"})]})}),(0,t.jsx)("div",{className:"px-6 pb-4",children:(0,t.jsx)(Y.Calendar,{mode:"single",selected:n,onSelect:l,className:"rounded-md border",disabled:e=>e<new Date(new Date().setHours(0,0,0,0))})}),(0,t.jsxs)("div",{className:"px-6 pb-4 space-y-3",children:[(0,t.jsx)("div",{children:(0,t.jsx)(X.Label,{className:"text-base font-normal text-muted-foreground",children:n?(0,Z.format)(n,"EEEE, MMM d, yyyy"):""})}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)(u.Input,{type:"time",value:o,onChange:e=>d(e.target.value),className:"w-32"})})]}),(0,t.jsxs)(A.DialogFooter,{className:"px-6 pb-6 flex flex-col gap-2 sm:flex-col",children:[(0,t.jsx)(p.Button,{onClick:()=>{n&&(i(n,o),a(!1))},className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:"Apply"}),(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>a(!1),className:"w-full",children:"Cancel"})]})]})})}var et=e.i(13853);function ea({open:e,onOpenChange:a,settings:r,onSettingsChange:i,className:n,totalRecipients:l=100}){let{user:o,authReady:d}=(0,P.useAuth)(),[c,u]=(0,m.useState)(r),[x,h]=(0,m.useState)(!1),[g,f]=(0,m.useState)(!1);(0,m.useEffect)(()=>{u(r)},[r]);let{data:y}=(0,j.useQuery)({queryKey:["/api/gmail/auth-status"],refetchInterval:1e4,enabled:d&&!!o}),{data:v}=(0,j.useQuery)({queryKey:["/api/sender-profiles"],enabled:d&&!!o});(0,m.useEffect)(()=>{if(v&&v.length>0&&!c.senderProfileId){let e=v.find(e=>e.isDefault)||v[0],t={...c,senderProfileId:e.id};u(t),i(t)}},[v]);let N=(e,t)=>{let a={...c,[e]:t};u(a),i(a)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,b.cn)("space-y-1 pt-1 pb-4",n),children:[(0,t.jsxs)("div",{className:"w-full px-2 py-2 bg-muted/30 rounded-lg mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s.Mail,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Sending Method"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:y?.authorized?"Gmail":"Manual"}),y?.authorized?(0,t.jsx)(z.TooltipProvider,{children:(0,t.jsxs)(z.Tooltip,{children:[(0,t.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(U.CheckCircle,{className:"h-4 w-4 text-green-500"})}),(0,t.jsx)(z.TooltipContent,{side:"top",children:(0,t.jsx)("p",{children:"Gmail connected - emails will be sent automatically"})})]})}):(0,t.jsx)(z.TooltipProvider,{children:(0,t.jsxs)(z.Tooltip,{children:[(0,t.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(W.AlertCircle,{className:"h-4 w-4 text-yellow-500"})}),(0,t.jsx)(z.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsx)("p",{children:"Gmail not connected - you'll need to send emails manually after approval"})})]})})]})]}),!y?.authorized&&(0,t.jsx)("div",{className:"mt-2 pt-2 border-t border-border/50",children:(0,t.jsx)(p.Button,{variant:"outline",size:"sm",className:"w-full text-xs py-1 h-7",onClick:()=>window.open(`/api/gmail/auth?userId=${window.userId||1}`,"_blank"),children:"Connect Gmail to enable automatic sending"})})]}),v&&v.length>0&&(0,t.jsxs)("div",{className:"w-full px-2 py-2 bg-muted/30 rounded-lg mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(J.User,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Sender profile"})]}),(0,t.jsxs)(q.Select,{value:c.senderProfileId?.toString()||"",onValueChange:e=>{let t={...c,senderProfileId:parseInt(e)};u(t),i(t)},children:[(0,t.jsx)(q.SelectTrigger,{className:"w-48 h-7 text-xs",children:(0,t.jsx)(q.SelectValue,{placeholder:"Select profile"})}),(0,t.jsx)(q.SelectContent,{children:v.map(e=>(0,t.jsx)(q.SelectItem,{value:e.id.toString(),children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{children:e.displayName}),e.isDefault&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"(default)"})]})},e.id))})]})]}),!v||0===v.length&&(0,t.jsx)("div",{className:"mt-2 pt-2 border-t border-border/50",children:(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Connect Gmail to create a sender profile"})})]}),(0,t.jsxs)(p.Button,{variant:"ghost",className:"w-full justify-between h-auto py-1.5 px-2 hover:bg-muted/50",onClick:()=>h(!0),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(G.Calendar,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm font-normal text-muted-foreground",children:"Schedule send"})]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:c.scheduleSend&&c.scheduleDate?(0,Z.format)(c.scheduleDate,"MMM d, h:mm a"):""})]}),(0,t.jsxs)(p.Button,{variant:"ghost",className:"w-full justify-between h-auto py-1.5 px-2 hover:bg-muted/50",onClick:()=>f(!0),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(H,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-sm font-normal text-muted-foreground",children:"Autopilot"}),(0,t.jsx)(z.TooltipProvider,{children:(0,t.jsxs)(z.Tooltip,{children:[(0,t.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(B.Info,{className:"h-3 w-3 text-muted-foreground cursor-help",onClick:e=>e.stopPropagation()})}),(0,t.jsx)(z.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsx)("p",{children:"Automatically send emails at optimal times throughout the day"})})]})})]})]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:c.autopilot&&c.autopilotSettings?.maxEmailsPerDay?`${c.autopilotSettings.maxEmailsPerDay} per day`:""})]}),(0,t.jsxs)(p.Button,{variant:"ghost",className:"w-full justify-between h-auto py-1.5 px-2 hover:bg-muted/50",onClick:()=>N("requiresHumanReview",!c.requiresHumanReview),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(V.UserCheck,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-sm font-normal text-muted-foreground",children:"Human review"}),(0,t.jsx)(z.TooltipProvider,{children:(0,t.jsxs)(z.Tooltip,{children:[(0,t.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(B.Info,{className:"h-3 w-3 text-muted-foreground cursor-help",onClick:e=>e.stopPropagation()})}),(0,t.jsx)(z.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsx)("p",{children:"When enabled, emails require your review before sending. When disabled, template-based emails are sent automatically."})})]})})]})]}),(0,t.jsx)(R.Switch,{checked:c.requiresHumanReview,onCheckedChange:e=>N("requiresHumanReview",e),className:"data-[state=checked]:bg-blue-600 scale-90",onClick:e=>e.stopPropagation()})]}),(0,t.jsxs)(p.Button,{variant:"ghost",className:"w-full justify-between h-auto py-1.5 px-2 hover:bg-muted/50",onClick:()=>N("trackEmails",!c.trackEmails),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(K,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-sm font-normal text-muted-foreground",children:"Track emails"}),(0,t.jsx)(z.TooltipProvider,{children:(0,t.jsxs)(z.Tooltip,{children:[(0,t.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(B.Info,{className:"h-3 w-3 text-muted-foreground cursor-help",onClick:e=>e.stopPropagation()})}),(0,t.jsx)(z.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsx)("p",{children:"Track when recipients open and click links in your emails"})})]})})]})]}),(0,t.jsx)(R.Switch,{checked:c.trackEmails,onCheckedChange:e=>N("trackEmails",e),className:"data-[state=checked]:bg-blue-600 scale-90",onClick:e=>e.stopPropagation()})]}),(0,t.jsxs)(p.Button,{variant:"ghost",className:"w-full justify-between h-auto py-1.5 px-2 hover:bg-muted/50",onClick:()=>N("unsubscribeLink",!c.unsubscribeLink),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Q.Link,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-sm font-normal text-muted-foreground",children:"Unsubscribe link"}),(0,t.jsx)(z.TooltipProvider,{children:(0,t.jsxs)(z.Tooltip,{children:[(0,t.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(B.Info,{className:"h-3 w-3 text-muted-foreground cursor-help",onClick:e=>e.stopPropagation()})}),(0,t.jsx)(z.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsx)("p",{children:"Add an unsubscribe link to comply with email regulations"})})]})})]})]}),(0,t.jsx)(R.Switch,{checked:c.unsubscribeLink,onCheckedChange:e=>N("unsubscribeLink",e),className:"data-[state=checked]:bg-blue-600 scale-90",onClick:e=>e.stopPropagation()})]})]}),(0,t.jsx)(ee,{open:x,onOpenChange:h,selectedDate:c.scheduleDate,selectedTime:c.scheduleTime||"09:00",onApply:(e,t)=>{let[a,s]=t.split(":").map(Number),r=new Date(e);r.setHours(a,s,0,0);let n={...c,scheduleSend:!0,scheduleDate:r,scheduleTime:t};u(n),i(n)}}),(0,t.jsx)(et.AutopilotModal,{open:g,onOpenChange:f,settings:c.autopilotSettings||{enabled:!1,days:{monday:{enabled:!0,startTime:"09:00",endTime:"17:00"},tuesday:{enabled:!0,startTime:"09:00",endTime:"17:00"},wednesday:{enabled:!0,startTime:"09:00",endTime:"17:00"},thursday:{enabled:!0,startTime:"09:00",endTime:"17:00"},friday:{enabled:!0,startTime:"09:00",endTime:"17:00"},saturday:{enabled:!1,startTime:"09:00",endTime:"17:00"},sunday:{enabled:!1,startTime:"09:00",endTime:"17:00"}},maxEmailsPerDay:300,delayBetweenEmails:3,delayUnit:"minutes"},onApply:e=>{let t={...c,autopilot:!0,autopilotSettings:e};u(t),i(t)},totalEmails:l})]})}let es="emailComposerState";function er(e,t=!0){let a=(0,m.useRef)(),s=(0,m.useRef)(!1),r=(0,m.useRef)(!1),i=(0,m.useRef)("");return(0,m.useEffect)(()=>{if(!t||s.current||!r.current)return;let n=JSON.stringify(e);if(n!==i.current)return a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{try{let t=Object.entries(e).reduce((e,[t,a])=>(void 0!==a&&"function"!=typeof a&&(e[t]=a),e),{});t.isOpen&&(localStorage.setItem(es,JSON.stringify(t)),i.current=n,console.log("Saved email composer state:",t))}catch(e){console.error("Failed to save email composer state:",e)}},500),()=>{a.current&&clearTimeout(a.current)}},[e,t]),{restoreState:()=>{try{s.current=!0;let e=localStorage.getItem(es);if(e){let t=JSON.parse(e);return console.log("Restored email composer state:",t),setTimeout(()=>{s.current=!1,r.current=!0},200),t}}catch(e){console.error("Failed to restore email composer state:",e)}return s.current=!1,setTimeout(()=>{r.current=!0},100),null},clearState:()=>{try{localStorage.removeItem(es),i.current="",console.log("Cleared email composer state")}catch(e){console.error("Failed to clear email composer state:",e)}}}}function ei(){try{let e=localStorage.getItem(es);if(e){let t=JSON.parse(e);return{isOpen:t.isOpen||!1,drawerMode:t.drawerMode,emailSubject:t.emailSubject||t.templateSubject||t.aiSubject}}}catch(e){console.error("Failed to get drawer state:",e)}return{isOpen:!1}}function en(e){try{let t=localStorage.getItem(es);if(t){let a=JSON.parse(t);a.isOpen=e,localStorage.setItem(es,JSON.stringify(a))}}catch(e){console.error("Failed to update drawer state:",e)}}function el(){try{let e=localStorage.getItem(es);if(e){let t=JSON.parse(e);return t.emailSubject||t.templateSubject||t.aiSubject}}catch(e){console.error("Failed to get email subject:",e)}}e.s(["getEmailComposerDrawerState",()=>ei,"getPersistedEmailSubject",()=>el,"setDrawerOpenState",()=>en,"useEmailComposerPersistence",()=>er],93823);var eo=e.i(83086),ed=e.i(78583);let ec=[{id:"merge_field",label:"Template with merge-fields",buttonText:"Generate Template",description:"Use merge fields for personalization",icon:ed.FileText,activeColor:"[&]:text-[#ff69b4]",buttonColor:"[&]:bg-[#ff69b4]/5 [&]:hover:bg-[#ff69b4]/10 [&]:text-[#ff69b4] dark:[&]:bg-[#ff69b4]/5 dark:[&]:hover:bg-[#ff69b4]/10 dark:[&]:text-[#ff69b4]"},{id:"ai_unique",label:"AI Each email unique",buttonText:"Generate Sample",description:"Generate unique email for each recipient",icon:eo.Sparkles,activeColor:"[&]:text-[#AA336A]",buttonColor:"[&]:bg-[#AA336A]/5 [&]:hover:bg-[#AA336A]/10 [&]:text-[#AA336A] dark:[&]:bg-[#AA336A]/5 dark:[&]:hover:bg-[#AA336A]/10 dark:[&]:text-[#AA336A]"}];function em({selectedMode:e,onModeChange:a,className:s}){return(0,t.jsx)("div",{className:(0,b.cn)("inline-flex rounded-tl-lg rounded-tr-lg p-0.5 gap-0.5",s),children:ec.map(s=>{var r;let i=s.icon,n=e===s.id;return(0,t.jsxs)("button",{type:"button",onClick:()=>a(s.id),className:(0,b.cn)("flex items-center gap-1.5 px-3 py-1 text-xs rounded-t-md transition-all min-w-fit group",n?(0,b.cn)("shadow-sm bg-muted/30","merge_field"===s.id?"hover:bg-[#ff69b4]/10":"hover:bg-[#AA336A]/10"):"hover:text-foreground bg-transparent opacity-55 hover:opacity-70"),title:s.description,children:[(0,t.jsx)(i,{className:(0,b.cn)("h-3.5 w-3.5 transition-colors",n?(0,b.cn)("text-muted-foreground","merge_field"===s.id?"group-hover:text-[#ff69b4]":"group-hover:text-[#AA336A]"):"text-muted-foreground/60")}),(s.label,r="ai_unique"===s.id,s.activeColor,r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"font-semibold text-muted-foreground",children:"AI"}),(0,t.jsx)("span",{className:"font-normal text-muted-foreground",children:" Each email unique"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Template"}),(0,t.jsx)("span",{className:"font-normal text-muted-foreground",children:" with merge-fields"})]}))]},s.id)})})}function eu(e){return ec.find(t=>t.id===e)||ec[0]}var ep=e.i(50741),ex=e.i(90250);let eh=(0,n.default)("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),eg=(0,n.default)("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);var ef=e.i(30699),eb=e.i(43531),ej=e.i(31278);let ey=(0,n.default)("IdCard",[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]]);var ev=e.i(70273),eN=e.i(92930),ew=e.i(27612);function eC({items:e,selectedId:a,onSelect:s,triggerIcon:r,triggerLabel:i,headerIcon:n,headerTitle:l,headerDescription:o,showNoneOption:d=!0,noneLabel:c="None",noneDescription:u="No selection",onAddNew:p,addNewLabel:x="Add New",onEdit:h,onDelete:g,renderItem:f,isOpen:j,onOpenChange:y,triggerClassName:v,contentClassName:N,testIdPrefix:w="profile"}){let[C,S]=(0,m.useState)(!1),[k,T]=(0,m.useState)(null),D=void 0!==j?j:C,P=y||S;(0,m.useEffect)(()=>{D||T(null)},[D]);let E=e=>{s(e),P(!1)};return(0,t.jsxs)(ep.Popover,{open:D,onOpenChange:P,children:[(0,t.jsx)(ep.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:(0,b.cn)("flex items-center gap-1.5 px-2 py-1 rounded hover:bg-yellow-400/20 transition-colors text-xs",v||"text-muted-foreground"),title:`Select ${l.toLowerCase()}`,"data-testid":`button-${w}-selector`,children:[r,i&&(0,t.jsx)("span",{className:"max-w-20 truncate",children:i})]})}),(0,t.jsxs)(ep.PopoverContent,{className:(0,b.cn)("w-72 p-0",N),align:"start",children:[(0,t.jsxs)("div",{className:"px-3 py-2 border-b bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[n,(0,t.jsx)("h4",{className:"font-semibold text-sm",children:l})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:o})]}),(0,t.jsxs)("div",{className:"p-2 space-y-1",children:[d&&(0,t.jsx)("button",{className:(0,b.cn)("w-full text-left p-3 rounded-md hover:bg-accent-hover transition-colors",null===a&&"bg-accent-active"),onClick:()=>E(null),"data-testid":`button-${w}-none`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("span",{className:"font-medium",children:c}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[" - ",u]})]}),null===a&&(0,t.jsx)(eb.Check,{className:"w-3 h-3 text-primary"})]})}),e.map(e=>(0,t.jsx)("button",{className:(0,b.cn)("w-full text-left p-3 rounded-md hover:bg-accent-hover transition-colors group relative",a===e.id&&"bg-accent-active"),onClick:()=>E(e),onMouseEnter:()=>T(e.id),onMouseLeave:()=>T(null),"data-testid":`button-${w}-${e.id}`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-xs flex-1 min-w-0",children:f(e)}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[k!==e.id&&(0,t.jsxs)(t.Fragment,{children:[a===e.id&&(0,t.jsx)(eb.Check,{className:"w-3 h-3 text-primary"}),e.isDefault&&(0,t.jsx)(ev.Star,{className:"w-3 h-3 text-yellow-500 fill-yellow-500"})]}),k===e.id&&(h||g)&&(0,t.jsxs)(t.Fragment,{children:[h&&(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),h(e,t)},className:"p-1 rounded hover:bg-accent-foreground/10",title:`Edit ${l.toLowerCase()}`,"data-testid":`button-edit-${w}-${e.id}`,children:(0,t.jsx)(eN.Edit2,{className:"w-3 h-3 text-muted-foreground"})}),g&&(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),g(e,t)},className:"p-1 rounded hover:bg-accent-foreground/10 hover:text-destructive",title:`Delete ${l.toLowerCase()}`,"data-testid":`button-delete-${w}-${e.id}`,children:(0,t.jsx)(ew.Trash2,{className:"w-3 h-3 text-muted-foreground"})})]})]})]})},e.id)),p&&(0,t.jsx)("button",{className:"w-full text-left p-3 rounded-md hover:bg-accent-hover transition-colors border-2 border-dashed border-muted-foreground/20 hover:border-muted-foreground/40",onClick:()=>{p(),P(!1)},"data-testid":`button-add-new-${w}`,children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)($.Plus,{className:"w-3 h-3"}),(0,t.jsx)("span",{children:x})]})})]})]})]})}var eS=e.i(12598),ek=e.i(70756);let eT={sender:{title:"Sender Profile",apiEndpoint:"/api/sender-profiles",queryKey:["/api/sender-profiles"],fields:[{name:"firstName",label:"First Name",type:"text",required:!0,placeholder:"John"},{name:"lastName",label:"Last Name",type:"text",required:!0,placeholder:"Doe"},{name:"displayName",label:"Display Name",type:"text",placeholder:"John Doe (auto-generated if empty)",helpText:"This is how your name will appear in the dropdown"},{name:"email",label:"Email",type:"email",required:!0,placeholder:"john.doe@company.com"},{name:"title",label:"Title",type:"text",placeholder:"Dr., Mr., Ms."},{name:"companyPosition",label:"Position",type:"text",placeholder:"Sales Manager"},{name:"companyName",label:"Company Name",type:"text",placeholder:"Acme Corp"},{name:"companyWebsite",label:"Company Website",type:"url",placeholder:"https://example.com"}]},product:{title:"Product",apiEndpoint:"/api/products",queryKey:["/api/strategic-profiles"],fields:[{name:"title",label:"Product Name",type:"text",required:!0,placeholder:"My Amazing Product"},{name:"productService",label:"Product Description",type:"textarea",required:!0,placeholder:"Describe what your product does...",helpText:"A clear description of your product or service"},{name:"customerFeedback",label:"What Customers Like",type:"textarea",placeholder:"Customers love our product because...",helpText:"What do customers say they like about your product?"},{name:"website",label:"Product Link",type:"url",placeholder:"https://myproduct.com"}]},customer:{title:"Customer Profile",apiEndpoint:"/api/customer-profiles",queryKey:["/api/customer-profiles"],fields:[{name:"displayName",label:"Profile Name",type:"text",required:!0,placeholder:"Enterprise B2B Customers"},{name:"targetIndustry",label:"Target Industry",type:"text",placeholder:"Technology, Healthcare, Finance..."},{name:"companySize",label:"Company Size",type:"text",placeholder:"100-500 employees"},{name:"targetRole",label:"Target Role",type:"text",placeholder:"VP of Sales, Marketing Manager..."},{name:"painPoints",label:"Pain Points",type:"textarea",placeholder:"What problems do they face?"},{name:"goals",label:"Goals",type:"textarea",placeholder:"What are they trying to achieve?"}]}};function eD({isOpen:e,onClose:a,profileType:s,profile:r,onSuccess:i}){let{toast:n}=(0,N.useToast)(),l=(0,eS.useQueryClient)(),o=!!r,d=eT[s],c=()=>{let e={isDefault:!1};return"product"===s&&(e.businessType="product",e.businessDescription="",e.targetCustomers=""),d.fields.forEach(t=>{e[t.name]=""}),e},[x,h]=(0,m.useState)(c());(0,m.useEffect)(()=>{if(e)if(r){let e={...c()};d.fields.forEach(t=>{e[t.name]=r[t.name]||""}),e.isDefault=r.isDefault||!1,"sender"===s&&(e.source=r.source||"manual"),"product"===s&&(e.businessType=r.businessType||"product",e.businessDescription=r.businessDescription||r.productService||"",e.targetCustomers=r.targetCustomers||"General audience"),h(e)}else h(c())},[e,r,s]);let g=(e,t)=>{let a={...x,[e]:t};if("sender"===s&&("firstName"===e||"lastName"===e)&&(!r||x.displayName===`${x.firstName} ${x.lastName}`.trim())){let s="firstName"===e?t:x.firstName,r="lastName"===e?t:x.lastName;a.displayName=`${s} ${r}`.trim()||""}h(a)},f=(0,y.useMutation)({mutationFn:async e=>("product"===s&&(e.businessDescription=e.productService||e.businessDescription,e.targetCustomers=e.targetCustomers||"General audience"),(0,v.apiRequest)("POST",d.apiEndpoint,e)),onSuccess:()=>{n({title:"Success",description:`${d.title} created successfully`}),l.invalidateQueries({queryKey:d.queryKey}),i?.(),a()},onError:e=>{n({title:"Error",description:e.message||`Failed to create ${d.title.toLowerCase()}`,variant:"destructive"})}}),b=(0,y.useMutation)({mutationFn:async e=>("product"===s&&(e.businessDescription=e.productService||e.businessDescription,e.targetCustomers=e.targetCustomers||"General audience"),(0,v.apiRequest)("PATCH",`${d.apiEndpoint}/${r?.id}`,e)),onSuccess:()=>{n({title:"Success",description:`${d.title} updated successfully`}),l.invalidateQueries({queryKey:d.queryKey}),i?.(),a()},onError:e=>{n({title:"Error",description:e.message||`Failed to update ${d.title.toLowerCase()}`,variant:"destructive"})}}),j=f.isPending||b.isPending;return(0,t.jsx)(A.Dialog,{open:e,onOpenChange:a,children:(0,t.jsxs)(A.DialogContent,{className:"max-w-xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)(A.DialogHeader,{children:(0,t.jsx)(A.DialogTitle,{children:o?`Edit ${d.title}`:`Create New ${d.title}`})}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=d.fields.filter(e=>e.required&&!x[e.name]).map(e=>e.label);t.length>0?n({title:"Validation Error",description:`Please fill in: ${t.join(", ")}`,variant:"destructive"}):o?b.mutate(x):f.mutate(x)},className:"space-y-4",children:[d.fields.map(e=>{var a;let r=(a=e.name,"sender"===s&&"email"===a&&("registered"===x.source||"gmail"===x.source)),i="textarea"===e.type?ex.Textarea:u.Input;if("sender"===s&&"firstName"===e.name){let a=d.fields.find(e=>"lastName"===e.name);return(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(X.Label,{htmlFor:e.name,children:[e.label," ",e.required&&(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(u.Input,{id:e.name,value:x[e.name],onChange:t=>g(e.name,t.target.value),placeholder:e.placeholder,required:e.required,disabled:r})]}),a&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(X.Label,{htmlFor:a.name,children:[a.label," ",a.required&&(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(u.Input,{id:a.name,value:x[a.name],onChange:e=>g(a.name,e.target.value),placeholder:a.placeholder,required:a.required})]})]},e.name)}if("sender"===s&&"lastName"===e.name)return null;if("sender"===s&&"title"===e.name){let a=d.fields.find(e=>"companyPosition"===e.name);return(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(X.Label,{htmlFor:e.name,children:e.label}),(0,t.jsx)(u.Input,{id:e.name,value:x[e.name],onChange:t=>g(e.name,t.target.value),placeholder:e.placeholder})]}),a&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(X.Label,{htmlFor:a.name,children:a.label}),(0,t.jsx)(u.Input,{id:a.name,value:x[a.name],onChange:e=>g(a.name,e.target.value),placeholder:a.placeholder})]})]},e.name)}if("sender"===s&&"companyPosition"===e.name)return null;if("sender"===s&&"companyName"===e.name){let a=d.fields.find(e=>"companyWebsite"===e.name);return(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(X.Label,{htmlFor:e.name,children:e.label}),(0,t.jsx)(u.Input,{id:e.name,value:x[e.name],onChange:t=>g(e.name,t.target.value),placeholder:e.placeholder})]}),a&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(X.Label,{htmlFor:a.name,children:a.label}),(0,t.jsx)(u.Input,{id:a.name,value:x[a.name],onChange:e=>g(a.name,e.target.value),placeholder:a.placeholder})]})]},e.name)}return"sender"===s&&"companyWebsite"===e.name?null:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(X.Label,{htmlFor:e.name,children:[e.label," ",e.required&&(0,t.jsx)("span",{className:"text-red-500",children:"*"}),r&&(0,t.jsx)(ek.Lock,{className:"w-3 h-3 inline-block ml-2 text-muted-foreground"})]}),(0,t.jsx)(i,{id:e.name,type:"textarea"===e.type?void 0:e.type,value:x[e.name],onChange:t=>{r||g(e.name,t.target.value)},placeholder:e.placeholder,required:e.required,disabled:r,className:r?"bg-muted":""}),e.helpText&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.helpText}),r&&"sender"===s&&"email"===e.name&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Email is synced with ","registered"===x.source?"your registered account":"Gmail API"]})]},e.name)}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(I.Checkbox,{id:"isDefault",checked:x.isDefault,onCheckedChange:e=>h({...x,isDefault:!0===e})}),(0,t.jsxs)(X.Label,{htmlFor:"isDefault",className:"text-sm cursor-pointer",children:["Set as default ","sender"===s?"sender profile":"product"]})]}),(0,t.jsxs)(A.DialogFooter,{children:[(0,t.jsx)(p.Button,{type:"button",variant:"outline",onClick:a,disabled:j,children:"Cancel"}),(0,t.jsx)(p.Button,{type:"submit",disabled:j,children:j?o?"Updating...":"Creating...":o?`Update ${d.title}`:`Create ${d.title}`})]})]})]})})}let eP={sender:{apiEndpoint:"/api/sender-profiles",queryKey:["/api/sender-profiles"],deleteSuccessMessage:"Sender profile deleted successfully",deleteErrorMessage:"Failed to delete sender profile"},customer:{apiEndpoint:"/api/customer-profiles",queryKey:["/api/customer-profiles"],deleteSuccessMessage:"Customer profile deleted successfully",deleteErrorMessage:"Failed to delete customer profile"},product:{apiEndpoint:"/api/strategic-profiles",queryKey:["/api/strategic-profiles"],deleteSuccessMessage:"Product deleted successfully",deleteErrorMessage:"Failed to delete product"}};function eE({contextType:e,items:a,selectedId:s,onSelect:r,triggerIcon:i,triggerClassName:n,contentClassName:l,showTriggerLabel:o=!0,headerTitle:d,headerDescription:c,noneLabel:u="None",noneDescription:p="No selection",addNewLabel:h="Add New",showNoneOption:g=!0,allowEdit:f=!0,allowDelete:j=!0,allowAdd:w=!0,renderItemContent:C,showSource:S=!1,showPosition:k=!1,onAfterAdd:T,onAfterEdit:D,onAfterDelete:P,testIdPrefix:E}){let[M,A]=(0,m.useState)(!1),[I,F]=(0,m.useState)(!1),[q,L]=(0,m.useState)(null),[O,$]=(0,m.useState)(!1),[_,R]=(0,m.useState)(null),{toast:z}=(0,N.useToast)(),G=(0,eS.useQueryClient)(),H=eP[e],B=a.find(e=>e.id===s),K=(0,y.useMutation)({mutationFn:async e=>(0,v.apiRequest)("DELETE",`${H.apiEndpoint}/${e}`),onSuccess:()=>{z({title:"Success",description:H.deleteSuccessMessage}),G.invalidateQueries({queryKey:H.queryKey}),s===_?.id&&r(null),$(!1),R(null),P?.()},onError:e=>{z({title:"Error",description:e.message||H.deleteErrorMessage,variant:"destructive"})}});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eC,{items:a.map(e=>({...e,isDefault:e.isDefault??void 0})),selectedId:s,onSelect:e=>{r(e?e.id:null)},triggerIcon:i,triggerLabel:o?(()=>{if(B)return"sender"===e?B.displayName:"product"===e?B.title||B.productService||"Product":B.displayName||B.title||B.name})():void 0,triggerClassName:(0,b.cn)(n,null!=s?"bg-yellow-400/20 hover:bg-yellow-400/30 text-yellow-700":"text-muted-foreground"),contentClassName:l,headerIcon:i,headerTitle:d||`Select ${e}`,headerDescription:c||`Choose a ${e} for context`,showNoneOption:g,noneLabel:u,noneDescription:p,onAddNew:w?()=>{L(null),F(!0),A(!1)}:void 0,addNewLabel:h,onEdit:f?(e,t)=>{t.stopPropagation(),L(e),F(!0),A(!1)}:void 0,onDelete:j?(e,t)=>{t.stopPropagation(),R(e),$(!0),A(!1)}:void 0,renderItem:a=>C?C(a):"sender"===e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium truncate",children:a.displayName}),S&&"registered"===a.source&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"(Registered User)"}),S&&"gmail"===a.source&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"(Gmail API)"})]}),k&&a.companyPosition&&(0,t.jsxs)("div",{className:"text-muted-foreground truncate mt-0.5",children:[a.companyPosition," ",a.companyName&&`at ${a.companyName}`]})]}):"product"===e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"font-medium truncate",children:a.title||a.productService||"Untitled Product"}),a.productService&&a.title!==a.productService&&(0,t.jsx)("div",{className:"text-muted-foreground truncate mt-0.5",children:a.productService})]}):(0,t.jsx)("div",{className:"font-medium truncate",children:a.displayName||a.title||a.name||"Untitled"}),isOpen:M,onOpenChange:A,testIdPrefix:E||e}),(w||f)&&(0,t.jsx)(eD,{isOpen:I,onClose:()=>{F(!1),L(null)},profileType:e,profile:q,onSuccess:()=>{F(!1),L(null),G.invalidateQueries({queryKey:H.queryKey}),q?D?.():T?.()}}),j&&(0,t.jsx)(x.AlertDialog,{open:O,onOpenChange:$,children:(0,t.jsxs)(x.AlertDialogContent,{children:[(0,t.jsxs)(x.AlertDialogHeader,{children:[(0,t.jsxs)(x.AlertDialogTitle,{children:["Delete ","sender"===e?"Sender Profile":"product"===e?"Product":"Profile"]}),(0,t.jsxs)(x.AlertDialogDescription,{children:['Are you sure you want to delete "',_?.displayName||_?.title||_?.name,'"? This action cannot be undone.']})]}),(0,t.jsxs)(x.AlertDialogFooter,{children:[(0,t.jsx)(x.AlertDialogCancel,{onClick:()=>{$(!1),R(null)},children:"Cancel"}),(0,t.jsx)(x.AlertDialogAction,{onClick:()=>{_&&K.mutate(_.id)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})}function eM({selectedProduct:e,selectedProductData:s,onProductSelect:r,onProductClear:i,selectedTone:n,onToneSelect:l,selectedOfferStrategy:o,onOfferStrategySelect:d,selectedSenderProfile:c,onSenderProfileSelect:u,senderProfiles:x,products:h,emailPrompt:g,originalEmailPrompt:f,onPromptChange:j,onPromptResize:y,promptTextareaRef:v,getDisplayValue:N,onGenerate:w,isGenerating:C,drawerMode:S="compose",generationMode:k="merge_field",isExpanded:T=!1,isMobile:D=!1}){let[P,A]=(0,m.useState)(!1),[I,F]=(0,m.useState)(!1),[q,L]=(0,m.useState)(!1);return x.find(e=>e.id===c),(0,t.jsxs)("div",{className:"relative border-t border-b rounded-tr-lg md:border-t-0 md:border-b-0 md:mb-6 mb-4 overflow-hidden",children:[s?(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("div",{className:"mobile-input mobile-input-text-fix border-0 rounded-none md:border md:rounded-md px-3 md:px-3 py-3 pb-10 bg-background min-h-[48px] flex items-center",children:(0,t.jsxs)("span",{className:"group inline-flex items-center px-2.5 py-1 rounded bg-muted/50 hover:bg-primary/10 text-muted-foreground hover:text-primary text-sm font-normal truncate max-w-full transition-colors",children:[(0,t.jsx)(eh,{className:"w-3 h-3 mr-1.5 flex-shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:s.title}),(0,t.jsx)("button",{onClick:i,className:"ml-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:text-destructive",title:"Remove product",children:(0,t.jsx)(a.X,{className:"h-3 w-3"})})]})})}):(0,t.jsx)(ex.Textarea,{ref:v,placeholder:"Add product, e.g.: Stationary products & printers",value:N(g,f),onChange:e=>{j(e.target.value),y()},className:"mobile-input mobile-input-text-fix resize-none transition-all duration-200 pb-8 border-0 rounded-none md:border md:rounded-md px-3 md:px-3 focus-visible:ring-0 focus-visible:ring-offset-0 placeholder:text-muted-foreground/50",style:{minHeight:"32px",maxHeight:"120px"}}),(0,t.jsxs)("div",{className:"absolute bottom-1 left-2 flex items-center gap-2 z-10",children:[(0,t.jsx)(eE,{contextType:"product",items:h,selectedId:e,onSelect:e=>{if(null!==e){let t=h.find(t=>t.id===e);t&&r(t)}else i()},triggerIcon:(0,t.jsx)(eh,{className:"w-3 h-3"}),triggerClassName:"text-xs",headerTitle:"Product Context",headerDescription:"Insert from your existing product list",noneDescription:"No specific product context",addNewLabel:"Add New Product",showSource:!1,showPosition:!1,showTriggerLabel:T&&!D&&!s,testIdPrefix:"product"}),(0,t.jsxs)(ep.Popover,{open:P,onOpenChange:A,children:[(0,t.jsx)(ep.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:(0,b.cn)("flex items-center gap-1.5 px-2 py-1 rounded transition-colors text-xs",n?"bg-yellow-400/20 hover:bg-yellow-400/30 text-yellow-700":"text-muted-foreground hover:bg-yellow-400/20"),title:"Select email tone","data-testid":"button-tone-selector",children:[(0,t.jsx)(eg,{className:"w-3 h-3"}),T&&!D&&(0,t.jsx)("span",{children:E.find(e=>e.id===n)?.name||"Casual"})]})}),(0,t.jsxs)(ep.PopoverContent,{className:"w-72 p-0",align:"start",children:[(0,t.jsxs)("div",{className:"px-3 py-2 border-b bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eg,{className:"w-4 h-4 text-primary"}),(0,t.jsx)("h4",{className:"font-semibold text-sm",children:"Email Tone"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Choose the personality for your email"})]}),(0,t.jsx)("div",{className:"p-2",children:E.map(e=>(0,t.jsx)("button",{className:(0,b.cn)("w-full text-left p-3 rounded-md hover:bg-accent-hover transition-colors",n===e.id&&"bg-accent-active"),onClick:()=>{l(e.id),A(!1)},"data-testid":`button-tone-${e.id}`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("span",{className:"font-medium",children:e.name}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[" - ",e.description]})]}),n===e.id&&(0,t.jsx)(eb.Check,{className:"w-3 h-3 text-primary"})]})},e.id))})]})]}),(0,t.jsxs)(ep.Popover,{open:I,onOpenChange:F,children:[(0,t.jsx)(ep.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:(0,b.cn)("flex items-center gap-1.5 px-2 py-1 rounded transition-colors text-xs",o&&"none"!==o?"bg-yellow-400/20 hover:bg-yellow-400/30 text-yellow-700":"text-muted-foreground hover:bg-yellow-400/20"),title:"Select offer strategy","data-testid":"button-offer-selector",children:[(0,t.jsx)(ef.Gift,{className:"w-3 h-3"}),T&&!D&&"none"!==o&&(0,t.jsx)("span",{children:M.find(e=>e.id===o)?.name})]})}),(0,t.jsxs)(ep.PopoverContent,{className:"w-72 p-0",align:"start",children:[(0,t.jsxs)("div",{className:"px-3 py-2 border-b bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ef.Gift,{className:"w-4 h-4 text-primary"}),(0,t.jsx)("h4",{className:"font-semibold text-sm",children:"Offer Strategy"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Optional: Structure your offer for maximum impact"})]}),(0,t.jsx)("div",{className:"p-2",children:M.map(e=>(0,t.jsx)("button",{className:(0,b.cn)("w-full text-left p-3 rounded-md hover:bg-accent-hover transition-colors",o===e.id&&"bg-accent-active"),onClick:()=>{d(e.id),F(!1)},"data-testid":`button-offer-${e.id}`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("span",{className:"font-medium",children:e.name}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[" - ",e.description]})]}),o===e.id&&(0,t.jsx)(eb.Check,{className:"w-3 h-3 text-primary"})]})},e.id))})]})]}),(0,t.jsx)(eE,{contextType:"sender",items:x,selectedId:c,onSelect:u,triggerIcon:(0,t.jsx)(ey,{className:"w-3 h-3"}),triggerClassName:"text-xs",showTriggerLabel:T&&!D,headerTitle:"Sender Profile",headerDescription:"Sender context for email generation",noneDescription:"No sender context",addNewLabel:"Add New Profile",showSource:!0,showPosition:!0,testIdPrefix:"sender"})]}),(0,t.jsxs)("div",{className:"absolute bottom-2 right-2 flex items-center gap-2",children:[(0,t.jsx)(z.TooltipProvider,{children:(0,t.jsxs)(z.Tooltip,{open:q,onOpenChange:L,children:[(0,t.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("button",{className:"p-1 rounded hover:bg-accent-hover transition-colors",onClick:()=>L(!q),onBlur:()=>L(!1),"data-testid":"button-info-tooltip",children:(0,t.jsx)(B.Info,{className:"w-3 h-3 text-muted-foreground"})})}),(0,t.jsx)(z.TooltipContent,{side:"top",className:"text-sm max-w-xs",children:(0,t.jsx)("p",{children:"Give us a sentence about your offer and we'll generate the email for you. It'll be awesome."})})]})}),(0,t.jsxs)(p.Button,{onClick:w,variant:"campaign"===S?"default":"yellow",disabled:C,className:(0,b.cn)("h-8 px-3 text-xs hover:scale-105 transition-all duration-300 ease-out","campaign"===S&&eu(k).buttonColor),"data-testid":"button-generate-email",children:[C?(0,t.jsx)(ej.Loader2,{className:"w-3 h-3 mr-1 animate-spin"}):(0,t.jsx)(H,{className:"w-3 h-3 mr-1"}),C?"Generating...":"campaign"===S?eu(k).buttonText:"Generate Email"]})]})]})}var eA=e.i(88511),eI=e.i(56909),eF=e.i(74886);let eq=[{value:"{{contact_company_name}}",label:"Target Company Name",description:"The company you're reaching out to"},{value:"{{sender_company_name}}",label:"Sender Company Name",description:"Your company name as the sender"},{value:"{{contact_role}}",label:"Target Contact Role",description:"Target contact's job title or position"},{value:"{{sender_full_name}}",label:"Sender Full Name",description:"Your full name as the sender"},{value:"{{sender_first_name}}",label:"Sender First Name",description:"Your first name"},{value:"{{first_name}}",label:"Target First Name",description:"Target contact's first name"},{value:"{{last_name}}",label:"Target Last Name",description:"Target contact's last name"},{value:"{{personal_intro}}",label:"Personal Intro",description:"Personal introduction message"},{value:"{{custom_proposal}}",label:"Custom Proposal",description:"Custom proposal or offer"},{value:"{{product1_name}}",label:"Product 1 Name",description:"First product or service name"},{value:"{{product1_description}}",label:"Product 1 Description",description:"First product description"},{value:"{{product2_name}}",label:"Product 2 Name",description:"Second product or service name"},{value:"{{product2_description}}",label:"Product 2 Description",description:"Second product description"},{value:"{{custom1}}",label:"Custom 1",description:"Custom field for specific needs"},{value:"{{custom2}}",label:"Custom 2",description:"Additional custom field"},{value:"{{customer_pain-point}}",label:"Customer Pain Point",description:"Specific problem or challenge the customer faces"}];function eL({open:e,onOpenChange:a,onMergeFieldInsert:s}){let[r,i]=(0,m.useState)(null),n=async e=>{try{await navigator.clipboard.writeText(e.value),i(e.value),setTimeout(()=>{i(null),a(!1)},800)}catch(t){try{let t=document.createElement("textarea");t.value=e.value,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),i(e.value),setTimeout(()=>{i(null),a(!1)},800)}catch(e){console.error("Failed to copy to clipboard:",e)}}};return(0,t.jsx)(A.Dialog,{open:e,onOpenChange:a,children:(0,t.jsxs)(A.DialogContent,{className:"w-[95vw] h-[90vh] max-w-[95vw] sm:w-auto sm:h-auto sm:max-w-lg sm:max-h-[80vh] overflow-y-auto p-4 sm:p-6",children:[(0,t.jsx)(A.DialogHeader,{children:(0,t.jsx)(A.DialogTitle,{children:"Select Merge Field"})}),(0,t.jsx)("div",{className:"space-y-1",children:eq.map(e=>(0,t.jsxs)("div",{onClick:()=>n(e),className:"flex items-center justify-between p-3 hover:bg-muted/50 rounded-lg transition-colors cursor-pointer",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"font-mono text-sm text-foreground",children:e.value}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.description})]}),(0,t.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>n(e),className:"ml-3 flex-shrink-0 h-8 w-8 p-0",disabled:r===e.value,children:r===e.value?(0,t.jsx)(eb.Check,{className:"w-4 h-4 text-green-600"}):(0,t.jsx)(eF.Copy,{className:"w-4 h-4"})})]},e.value))})]})})}var eO=e.i(86536);let e$=(0,n.default)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);function e_({isMergeViewMode:e=!1,onToggleMergeView:a,onMergeFieldClick:s,onSaveTemplateClick:r,className:i=""}){return(0,t.jsxs)("div",{className:`flex flex-wrap gap-2 ${i}`,children:[a&&(0,t.jsx)("button",{className:`flex items-center gap-1.5 px-2.5 py-1 text-xs transition-colors border rounded-md ${e?"bg-blue-50 border-blue-200 text-blue-800 hover:bg-blue-100":"text-muted-foreground hover:text-foreground border-border"}`,onClick:a,"data-testid":"button-merge-view",children:e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e$,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:"Normal View"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eO.Eye,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:"Merge View"})]})}),s&&(0,t.jsxs)("button",{className:"flex items-center gap-1.5 px-2.5 py-1 text-xs text-muted-foreground hover:text-foreground transition-colors border border-border rounded-md",onClick:s,"data-testid":"button-merge-field",children:[(0,t.jsx)($.Plus,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:"Merge Field"})]}),r&&(0,t.jsxs)("button",{onClick:r,className:"flex items-center gap-1.5 px-2.5 py-1 text-xs text-muted-foreground hover:text-foreground transition-colors border border-border rounded-md","data-testid":"button-save-template",children:[(0,t.jsx)(eI.Save,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:"Save as Template"})]})]})}function eR({templates:e,templatesLoading:a,onSelectTemplate:s,onSaveTemplate:r,onUpdateTemplate:i,onMergeFieldInsert:n,onEditTemplate:l,isEditMode:o,editingTemplateId:d,onExitEditMode:c,isMergeViewMode:h,onToggleMergeView:g,isSavingTemplate:f=!1}){let[b,j]=(0,m.useState)(),[y,v]=(0,m.useState)(!1),[N,w]=(0,m.useState)(!1),[C,S]=(0,m.useState)(!1),[k,T]=(0,m.useState)(!1),[D,P]=(0,m.useState)("");(0,eS.useQueryClient)();let E=()=>{D.trim()&&r&&(r(D.trim()),T(!1),P(""))};return(0,t.jsxs)("div",{className:"space-y-4 pt-6",children:[o&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-800 px-3 py-2 rounded-md text-sm mb-4",children:"Edit Template Mode"}),h&&!o&&(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 text-blue-800 px-3 py-2 rounded-md text-sm mb-4",children:"Merge View Mode - Showing technical merge fields"}),(0,t.jsx)("div",{className:"flex items-center justify-end gap-1.5 mb-4",children:(0,t.jsx)(e_,{isMergeViewMode:h,onToggleMergeView:g,onMergeFieldClick:()=>v(!0),onSaveTemplateClick:r?()=>{r&&(P(""),T(!0))}:void 0})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(q.Select,{value:b,onValueChange:j,children:[(0,t.jsx)(q.SelectTrigger,{className:"h-7 text-xs text-muted-foreground",children:(0,t.jsx)(q.SelectValue,{placeholder:a?"Loading templates...":"Select a Template"})}),(0,t.jsx)(q.SelectContent,{children:e.map(e=>(0,t.jsx)(q.SelectItem,{value:e.id.toString(),className:"pl-3 text-xs",children:e.name},e.id))})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-1.5",children:[(0,t.jsxs)(p.Button,{variant:"secondary",onClick:()=>{b&&S(!0)},disabled:!b,className:"h-7 px-2.5 text-xs text-muted-foreground hover:text-foreground mr-1 hover:scale-105 transition-all duration-300 ease-out",children:[(0,t.jsx)(ed.FileText,{className:"w-3 h-3 mr-0.5"}),"Insert Template"]}),(0,t.jsx)(p.Button,{variant:"secondary",onClick:o?()=>i?.():()=>{b&&w(!0)},disabled:!b||f,className:"h-7 px-2.5 text-xs text-muted-foreground hover:text-foreground mr-1 hover:scale-105 transition-all duration-300 ease-out",children:o?f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eI.Save,{className:"w-3 h-3 mr-0.5 animate-pulse"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eI.Save,{className:"w-3 h-3 mr-0.5"}),"Save Template"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eA.Edit,{className:"w-3 h-3 mr-0.5"}),"Edit Template"]})})]})]}),(0,t.jsx)(eL,{open:y,onOpenChange:v,onMergeFieldInsert:n}),(0,t.jsx)(x.AlertDialog,{open:N,onOpenChange:w,children:(0,t.jsxs)(x.AlertDialogContent,{children:[(0,t.jsxs)(x.AlertDialogHeader,{children:[(0,t.jsx)(x.AlertDialogTitle,{children:"Edit Template"}),(0,t.jsx)(x.AlertDialogDescription,{children:"Editing this template, will replace all content currently in fields on this page."})]}),(0,t.jsxs)(x.AlertDialogFooter,{children:[(0,t.jsx)(x.AlertDialogCancel,{onClick:()=>w(!1),children:"Cancel"}),(0,t.jsx)(x.AlertDialogAction,{onClick:()=>{let t=e.find(e=>e.id.toString()===b);t&&l&&(console.log("QuickTemplates - Loading template for editing:",{id:t.id,name:t.name}),l(t)),w(!1)},children:"Load the Template"})]})]})}),(0,t.jsx)(x.AlertDialog,{open:C,onOpenChange:S,children:(0,t.jsxs)(x.AlertDialogContent,{children:[(0,t.jsxs)(x.AlertDialogHeader,{children:[(0,t.jsx)(x.AlertDialogTitle,{children:"Load Template"}),(0,t.jsx)(x.AlertDialogDescription,{children:"Loading this template, will replace all content currently in fields on this page."})]}),(0,t.jsxs)(x.AlertDialogFooter,{children:[(0,t.jsx)(x.AlertDialogCancel,{onClick:()=>S(!1),children:"Cancel"}),(0,t.jsx)(x.AlertDialogAction,{onClick:()=>{let t=e.find(e=>e.id.toString()===b);t&&(console.log("QuickTemplates - Selected template:",{id:t.id,name:t.name}),s(t)),S(!1)},children:"Load the Template"})]})]})}),(0,t.jsx)(A.Dialog,{open:k,onOpenChange:T,children:(0,t.jsxs)(A.DialogContent,{children:[(0,t.jsxs)(A.DialogHeader,{children:[(0,t.jsx)(A.DialogTitle,{children:"Save as Template"}),(0,t.jsx)(A.DialogDescription,{children:"Enter name of new template:"})]}),(0,t.jsx)("div",{className:"py-4",children:(0,t.jsx)(u.Input,{placeholder:"Sales Genius 2027",value:D,onChange:e=>P(e.target.value),onKeyDown:e=>{"Enter"===e.key&&D.trim()&&E()},className:"w-full"})}),(0,t.jsxs)(A.DialogFooter,{children:[(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),(0,t.jsx)(p.Button,{onClick:E,disabled:!D.trim(),children:"Save Template"})]})]})})]})}function ez({templates:e,templatesLoading:a,onTemplateSelect:s,currentContent:r,currentSubject:i,emailPrompt:n,isEditMode:l,isMergeViewMode:o,onEditModeChange:d,onMergeViewToggle:c,onMergeFieldInsert:u,selectedContact:p,selectedCompany:x,user:h,editingTemplateId:g,editingTemplate:f}){let{toast:b}=(0,N.useToast)(),[j,w]=(0,m.useState)(!1),[C,S]=(0,m.useState)(l||!1),[k,T]=(0,m.useState)(g||null),[D,P]=(0,m.useState)(f||null),E=(0,y.useMutation)({mutationFn:async e=>{let t=await (0,v.apiRequest)("PUT",`/api/email-templates/${e.id}`,e);return await t.json()},onSuccess:()=>{v.queryClient.invalidateQueries({queryKey:["/api/email-templates"]}),b({title:"Template updated successfully!"})}}),M=async e=>{try{await (0,v.apiRequest)("POST","/api/email-templates",{name:e,subject:i,content:r,description:n}),v.queryClient.invalidateQueries({queryKey:["/api/email-templates"]}),b({title:"Template saved successfully!"})}catch(e){console.error("Save template error:",e),b({title:"Failed to save template",description:"Please try again.",variant:"destructive"})}},A=async()=>{k&&D&&E.mutate({...D,subject:i,content:r,description:n})};return(0,t.jsx)(eR,{templates:e,templatesLoading:a,onSelectTemplate:s,onSaveTemplate:M,onUpdateTemplate:A,onMergeFieldInsert:e=>{u(e)},onEditTemplate:e=>{S(!0),T(e.id),P(e),d?.(!0)},isEditMode:C,editingTemplateId:k,onExitEditMode:()=>{S(!1),T(null),P(null),d?.(!1)},isMergeViewMode:o,onToggleMergeView:c,isSavingTemplate:E.isPending})}let eG=(0,n.default)("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);var eH=e.i(21481),eB=e.i(14764),eK=e.i(9912),eQ=e.i(90639);function eV({recipients:e,listId:a,currentQuery:s,subject:r,body:i,onSchedule:n,onStartNow:l,onSaveDraft:o,isPending:d=!1,isSuccess:c=!1,className:u,disabled:x=!1}){let[g,f]=(0,m.useState)(!1),[j,y]=(0,m.useState)(!1),v=!!(e||a||s),N=!!(i?.trim()&&r?.trim()),w=x||d;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(z.TooltipProvider,{children:(0,t.jsxs)(z.Tooltip,{open:g,children:[(0,t.jsx)(z.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("div",{className:(0,b.cn)("inline-flex rounded-md shadow-sm",u),children:[(0,t.jsx)(p.Button,{onClick:()=>{if(!N){y(!0),f(!0),setTimeout(()=>{y(!1),f(!1)},2e3);return}n&&n()},disabled:w,variant:"outline",className:(0,b.cn)("h-8 px-3 text-xs border transition-all duration-300 ease-out",N?"bg-green-50 text-green-700 border-green-300 hover:bg-green-600 hover:text-white hover:border-green-600":"bg-white text-gray-400 border-gray-200 hover:bg-gray-100 hover:text-gray-600 hover:border-gray-300",c&&"bg-pink-500 hover:bg-pink-600 text-white border-pink-500","rounded-r-none border-r-0",j&&"shake-animation",x&&"opacity-50 cursor-not-allowed"),children:d?(0,t.jsx)(ej.Loader2,{className:"w-3 h-3 mr-1 animate-spin"}):c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eB.Send,{className:"w-3 h-3 mr-1"}),"Campaign Created"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eB.Send,{className:"w-3 h-3 mr-1"}),"Schedule Campaign"]})}),(0,t.jsxs)(eQ.DropdownMenu,{children:[(0,t.jsx)(eQ.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(p.Button,{disabled:w,variant:"outline",className:(0,b.cn)("h-8 px-2 text-xs border transition-all duration-300 ease-out",N?"bg-green-50 text-green-700 border-green-300 hover:bg-green-600 hover:text-white hover:border-green-600":"bg-white text-gray-400 border-gray-200 hover:bg-gray-100 hover:text-gray-600 hover:border-gray-300",c&&"bg-pink-500 hover:bg-pink-600 text-white border-pink-500","rounded-l-none border-l",x&&"opacity-50 cursor-not-allowed"),"aria-label":"More campaign options",children:(0,t.jsx)(h.ChevronDown,{className:"w-3 h-3"})})}),(0,t.jsxs)(eQ.DropdownMenuContent,{align:"end",className:"w-56",children:[(0,t.jsxs)(eQ.DropdownMenuItem,{onClick:l,className:"cursor-pointer",disabled:d||!v||!N,children:[(0,t.jsx)(eK.Rocket,{className:"mr-2 h-4 w-4 text-green-600"}),"Start Now"]}),(0,t.jsxs)(eQ.DropdownMenuItem,{onClick:o,className:"cursor-pointer",disabled:d||!v||!N,children:[(0,t.jsx)(ed.FileText,{className:"mr-2 h-4 w-4 text-blue-600"}),"Save as Draft"]})]})]})]})}),(0,t.jsx)(z.TooltipContent,{children:(0,t.jsx)("p",{children:v?"Please add content to email body and subject before creating campaign":"Please select campaign recipients"})})]})})})}function eU({drawerMode:e,toEmail:a,emailSubject:r,originalEmailSubject:i,emailContent:n,originalEmailContent:l,onSubjectChange:o,onContentChange:d,gmailStatus:c,gmailUserInfo:x,isGmailButtonHovered:h,onGmailButtonHover:g,onGmailConnect:f,sendEmailMutation:j,isSent:y,selectedContact:v,selectedCompany:N,onSendEmail:w,onManualSend:C,campaignRecipients:S,currentListId:k,currentQuery:T,onCreateCampaign:D,generationType:P,creatingCampaign:E,isMergeViewMode:M,getDisplayValue:A,isExpanded:I,isMobile:F}){let q=(0,m.useRef)(null),L=(0,m.useRef)(null),O=()=>{if(L.current){if(F)return;L.current.style.height="auto";let e=L.current.scrollHeight;L.current.style.height=Math.min(e,400)+"px"}};return(0,m.useEffect)(()=>{O()},[n]),(0,t.jsxs)("div",{className:F?"flex flex-col h-full":"",children:[(0,t.jsxs)("div",{className:"relative border-b md:border-b-0 md:mb-6 flex-none",style:{marginTop:"-1px"},children:[(0,t.jsx)(eG,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),(0,t.jsx)(u.Input,{ref:q,placeholder:"Email Subject",value:A(r,i),onChange:e=>o(e.target.value),className:"mobile-input mobile-input-text-fix pl-10 border-0 rounded-none md:border md:rounded-none focus-visible:ring-0 focus-visible:ring-offset-0 placeholder:text-muted-foreground/50","data-testid":"input-email-subject"})]}),(0,t.jsxs)("div",{className:`relative ${F?"flex-1 min-h-0 flex flex-col":""}`,style:{marginTop:"-1px"},children:[(0,t.jsx)(ex.Textarea,{ref:L,placeholder:"Enter or edit the generated email content...",value:A(n,l),onChange:e=>{d(e.target.value),O()},className:`mobile-input mobile-input-text-fix resize-none transition-all duration-200 border-0 rounded-none md:border md:rounded-b-md px-3 md:px-3 pb-12 focus-visible:ring-0 focus-visible:ring-offset-0 placeholder:text-muted-foreground/50 ${F?"flex-1 min-h-0":""}`,style:F?{minHeight:"150px"}:{minHeight:I?"400px":"160px",maxHeight:I?"600px":"400px"},"data-testid":"textarea-email-content"}),(0,t.jsxs)("div",{className:"absolute bottom-2 right-2 flex items-center gap-2",children:[(0,t.jsx)(z.TooltipProvider,{children:(0,t.jsxs)(z.Tooltip,{children:[(0,t.jsx)(z.TooltipTrigger,{asChild:!0,children:c?.authorized?(0,t.jsxs)(p.Button,{onClick:f,variant:"outline",size:"sm",className:"h-8 text-xs bg-green-50 text-green-700 border-green-300 hover:bg-green-100 hover:border-green-400 transition-all duration-300 group overflow-hidden",style:{width:"auto",minWidth:"32px",maxWidth:"32px",padding:"0 8px",transition:"max-width 0.3s ease-out, padding 0.3s ease-out"},onMouseEnter:e=>{let t=e.currentTarget;t.style.maxWidth="200px",t.style.padding="0 12px"},onMouseLeave:e=>{let t=e.currentTarget;t.style.maxWidth="32px",t.style.padding="0 8px"},"data-testid":"button-gmail-connected",children:[(0,t.jsx)(s.Mail,{className:"w-3 h-3 shrink-0"}),(0,t.jsx)("span",{className:"ml-1.5 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-300",style:{transitionDelay:"0.1s"},children:x?.email?x.email.length>20?`${x.email.substring(0,20)}...`:x.email:"Gmail Connected"})]}):(0,t.jsxs)(p.Button,{onClick:f,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),variant:"outline",size:"sm",className:(0,b.cn)("h-8 text-xs transition-all duration-300 ease-out overflow-hidden",h?"px-3 bg-blue-50 text-blue-700 border-blue-300 hover:bg-blue-100":"px-2 w-8 bg-muted text-muted-foreground border-border hover:bg-muted-hover"),"data-testid":"button-gmail-connect",children:[(0,t.jsx)(ek.Lock,{className:"w-3 h-3 shrink-0"}),h&&(0,t.jsx)("span",{className:"ml-1 whitespace-nowrap",children:"Gmail API BETA"})]})}),(0,t.jsx)(z.TooltipContent,{children:c?.authorized?(0,t.jsx)("p",{children:"Gmail connected. Click to reconnect or change account."}):(0,t.jsx)("p",{children:"Connect via Gmail API so that your emails send automatically when you click send here."})})]})}),"compose"===e?(0,t.jsx)(eH.EmailSendButton,{to:a,subject:r,body:n,contact:v??void 0,company:N??void 0,isGmailAuthenticated:c?.authorized,onSendViaGmail:w,onManualSend:C,isPending:j.isPending,isSuccess:y,className:"h-8 px-3 text-xs"}):(0,t.jsx)(eV,{recipients:S,listId:k,currentQuery:T,subject:r,body:n,onSchedule:()=>D("scheduled"),onStartNow:()=>D("immediate"),onSaveDraft:()=>D("draft"),isPending:E,isSuccess:!1,className:"h-8 px-3 text-xs"})]})]})]})}function eW({selectedContact:e,selectedCompany:r,onContactChange:i,onCompanyChange:n,drawerMode:l="compose",currentListId:o=null,currentQuery:d=null,isExpanded:c=!1,isMobile:E=!1,emailPrompt:M,setEmailPrompt:I,emailSubject:F,setEmailSubject:q,emailContent:L,setEmailContent:O,toEmail:$,setToEmail:R,selectedTone:z,setSelectedTone:G,selectedOfferStrategy:H,setSelectedOfferStrategy:B,selectedProduct:K,setSelectedProduct:Q,originalEmailPrompt:V,setOriginalEmailPrompt:U,originalEmailSubject:W,setOriginalEmailSubject:J,originalEmailContent:Y,setOriginalEmailContent:X}){var Z,ee,et;let{toast:es}=(0,N.useToast)(),{user:ei}=(0,P.useAuth)(),[en,el]=(0,m.useState)(""),[eo,ed]=(0,m.useState)(""),[ec,eu]=(0,m.useState)(""),[ep,ex]=(0,m.useState)(""),[eh,eg]=(0,m.useState)(""),[ef,eb]=(0,m.useState)(""),[ej,ey]=(0,m.useState)(""),[ev,eN]=(0,m.useState)(null),[ew,eC]=(0,m.useState)(null),[eS,ek]=(0,m.useState)("default"),[eT,eD]=(0,m.useState)("none"),eP=M??en,eE=I??el,eA=U??ed,eI=$??ec,eF=R??eu,eq=F??ep,eO=q??ex,e$=J??eg,eR=L??ef,eG=O??eb,eH=X??ey,eB=K??ev,eK=Q??eN,eQ=z??eS,eV=G??ek,eW=H??eT,eJ=B??eD,[eY,eX]=(0,m.useState)(!1),[eZ,e0]=(0,m.useState)(!1),[e1,e2]=(0,m.useState)(!1),[e3,e5]=(0,m.useState)(null),[e4,e6]=(0,m.useState)(!1),[e7,e8]=(0,m.useState)(!1),[e9,te]=(0,m.useState)(!1),[tt,ta]=(0,m.useState)(null),[ts,tr]=(0,m.useState)(!1),[ti,tn]=(0,m.useState)(!1),[tl,to]=(0,m.useState)({scheduleSend:!1,autopilot:!1,requiresHumanReview:!0,trackEmails:!0,unsubscribeLink:!1}),[td,tc]=(0,m.useState)("merge_field"),[tm,tu]=(0,m.useState)(!1),[tp,tx]=(0,m.useState)(!1),[th,tg]=(0,m.useState)(""),[tf,tb]=(0,m.useState)(""),[tj,ty]=(0,m.useState)(""),[tv,tN]=(0,m.useState)(""),[tw,tC]=(0,m.useState)(""),[tS,tk]=(0,m.useState)(""),[tT,tD]=(0,m.useState)(""),[tP,tE]=(0,m.useState)(""),[tM,tA]=(0,m.useState)(""),tI=(0,m.useRef)(null),tF=(0,m.useRef)(null),[tq,tL]=(0,m.useState)(null),[tO,t$]=(0,m.useState)(null),{data:t_=[]}=(0,j.useQuery)({queryKey:["/api/sender-profiles"],queryFn:async()=>{let e=await (0,v.apiRequest)("GET","/api/sender-profiles");if(!e.ok)throw Error("Failed to fetch sender profiles");return e.json()},staleTime:0,gcTime:3e5}),tR=(0,m.useMemo)(()=>({isOpen:!0,drawerMode:l,emailPrompt:eP,emailSubject:eq,emailContent:eR,toEmail:eI,templateSubject:tf,templateContent:tv,aiSubject:tS,aiContent:tP,selectedProduct:eB,selectedTone:eQ,selectedOfferStrategy:eW,selectedSenderProfileId:tO,generationMode:td,campaignSettings:tl,campaignRecipients:tt}),[l,eP,eq,eR,eI,tf,tv,tS,tP,eB,eQ,eW,tO,td,tl,tt]),{data:tz=[]}=(0,j.useQuery)({queryKey:["/api/strategic-profiles"]}),{restoreState:tG,clearState:tH}=er(tR);(0,m.useEffect)(()=>{let e=tG();if(e){if(void 0!==e.emailPrompt&&(eE(e.emailPrompt),eA(e.emailPrompt)),void 0!==e.emailSubject&&eO(e.emailSubject),void 0!==e.emailContent&&eG(e.emailContent),void 0!==e.toEmail&&eF(e.toEmail),void 0!==e.templateSubject&&tb(e.templateSubject),void 0!==e.templateContent&&tN(e.templateContent),void 0!==e.aiSubject&&tk(e.aiSubject),void 0!==e.aiContent&&tE(e.aiContent),void 0!==e.selectedProduct&&(eK(e.selectedProduct),tz&&tz.length>0)){let t=tz.find(t=>t.id===e.selectedProduct);t&&eC(t)}void 0!==e.selectedTone&&eV(e.selectedTone),void 0!==e.selectedOfferStrategy&&eJ(e.selectedOfferStrategy),void 0!==e.selectedSenderProfileId&&t$(e.selectedSenderProfileId),void 0!==e.generationMode&&tc(e.generationMode),void 0!==e.campaignSettings&&to(e.campaignSettings),void 0!==e.campaignRecipients&&ta(e.campaignRecipients),console.log("Restored email composer state from localStorage")}},[]),(0,m.useEffect)(()=>{if(eB&&tz&&tz.length>0&&!ew){let e=tz.find(e=>e.id===eB);e&&(eC(e),console.log("Synced product data from saved product ID:",e))}},[tz,eB]);let tB=()=>"campaign"===l?"merge_field"===td?tj||tf:tS:eq,tK=()=>"campaign"===l?"merge_field"===td?tw||tv:tP:eR,tQ=e=>{"campaign"===l?"merge_field"===td?tb(e):tk(e):eO(e)},tV=e=>{"campaign"===l?"merge_field"===td?ty(e):tD(e):e$(e)},tU=e=>{"campaign"===l?"merge_field"===td?tN(e):tE(e):eG(e)},tW=e=>{"campaign"===l?"merge_field"===td?tC(e):tA(e):eH(e)},tJ=function(e){if(!e)return{firstName:"User",fullName:"User"};let t=e.email?.split("@")[0]||"";if(e.username&&e.username!==t&&""!==e.username.trim()){let t=e.username.trim();return{firstName:t.split(" ")[0]||t,fullName:t}}return{firstName:t,fullName:t}}(ei),tY=(Z=tJ.fullName,ee=tJ.firstName,et=tq?.companyName||void 0,{contact:e?{name:e.name,role:e.role||void 0,email:e.email||void 0}:null,company:r?{name:r.name}:null,sender:{name:Z||"User",firstName:ee||Z?.split(" ")[0]||"User",companyName:et}}),tX=ew?{productService:ew.productService||void 0,customerFeedback:ew.customerFeedback||void 0,website:ew.website||void 0,reportSalesContextGuidance:ew.reportSalesContextGuidance||void 0}:void 0,tZ=tq?{displayName:tq.displayName||"",email:tq.email||"",firstName:tq.firstName||void 0,lastName:tq.lastName||void 0,title:tq.title||void 0,companyPosition:tq.companyPosition||void 0,companyName:tq.companyName||void 0,companyWebsite:tq.companyWebsite||void 0}:void 0,t0=tt?.type==="current"?tt.query:tt?.type==="multiple"?tt.targetAudienceQuery:void 0,{generateEmail:t1,isGenerating:t2}=(e=>{let{toast:t}=(0,N.useToast)(),{selectedContact:a,selectedCompany:s,emailPrompt:r,emailSubject:i,emailContent:n,toEmail:l,tone:o="default",offerStrategy:d="none",generateTemplate:c=!1,mergeFieldContext:m,productContext:u,senderProfile:p,targetAudienceQuery:x,setEmailSubject:h,setOriginalEmailSubject:g,setToEmail:f,setEmailContent:b,setOriginalEmailContent:j}=e,v=(0,y.useMutation)({mutationFn:async()=>{let e=r;c&&m&&(e=r+function(e){let t=function(e){let t=[],{contact:a,company:s,sender:r}=e;return r?.name&&t.push("{{sender_full_name}}"),r?.firstName&&t.push("{{sender_first_name}}"),r?.companyName&&t.push("{{sender_company_name}}"),a?.name&&(t.push("{{contact_name}}"),t.push("{{first_name}}"),t.push("{{last_name}}")),a?.role&&t.push("{{contact_role}}"),a?.email&&t.push("{{contact_email}}"),s?.name&&t.push("{{contact_company_name}}"),t}(e);if(0===t.length)return"";let a=t.filter(e=>e.includes("contact")||"{{first_name}}"===e||"{{last_name}}"===e),s=t.filter(e=>e.includes("sender")),r=t.filter(e=>e.includes("company")&&!e.includes("sender")),i="\n\nAvailable merge fields to personalize this email:";return s.length>0&&(i+="\nSender fields: "+s.join(", ")),a.length>0&&(i+="\nContact fields: "+a.join(", ")),r.length>0&&(i+="\nCompany fields: "+r.join(", ")),i+="\n\nUse these merge fields naturally in the email to personalize it."}(m));let t={emailPrompt:e,contact:a,company:s||{name:"your company"},tone:o,offerStrategy:d,toEmail:l,emailSubject:i,generateTemplate:c,productContext:u,senderProfile:p,targetAudienceQuery:x};return w(t)},onSuccess:e=>{let r=e.subject,i=e.content;if(c)f("");else{let t=function(e,t,a,s){let r=t,i=0,n=0,l=a?.name?.split(" ")[0];l&&r.includes(l)&&(i=T(r=C(r,l,"{{first_name}}",2,i),"{{first_name}}")),s?.name&&r.includes(s.name)&&(n=T(r=C(r,s.name,"{{contact_company_name}}",2,n),"{{contact_company_name}}"));let o=e.split("\n"),d=-1,c=-1;for(let e=0;e<o.length;e++)if(o[e].trim()){d=e;break}let m=0;for(let e=d;e<o.length;e++)if(o[e].trim())m=0;else if(++m>=2){c=e-1;break}-1===c&&(c=Math.min(d+3,o.length-1));for(let e=0;e<o.length;e++)if(e===d||e>d&&e<=c){let t=o[e];if(l&&i<2&&t.includes(l)&&!S(t,l)){k(t,l);let e=k(t=C(t,l,"{{first_name}}",2-i,0),"{{first_name}}");i+=e}if(s?.name&&n<2&&t.includes(s.name)&&!S(t,s.name)){k(t,s.name);let e=k(t=C(t,s.name,"{{contact_company_name}}",2-n,0),"{{contact_company_name}}");n+=e}o[e]=t}return{content:o.join("\n"),subject:r}}(e.content,e.subject,a,s);r=t.subject,i=t.content,a?.email?f(a.email):f("")}h(r),g(r);let n=i;b(n),j(n),t({title:c?"Template Generated":"Email Generated",description:c?"Template with merge fields has been created for your campaign.":"AI generated content has replaced all email fields."})},onError:e=>{t({title:"Generation Failed",description:e.message||"Failed to generate email content",variant:"destructive"})}});return{generateEmail:()=>{console.log("[handleGenerateEmail] Starting generation:",{generateTemplate:c,hasCompany:!!s,companyName:s?.name});let e=r&&""!==r.trim(),a=u&&(u.productService||u.customerFeedback||u.website||u.reportSalesContextGuidance);e||a?v.mutate():t({title:"No Prompt Provided",description:"Please enter an email creation prompt or select a product",variant:"destructive"})},isGenerating:v.isPending,generationError:v.error}})({selectedContact:e,selectedCompany:r,emailPrompt:eP,emailSubject:tB(),emailContent:tK(),toEmail:eI,tone:eQ,offerStrategy:eW,generateTemplate:"campaign"===l&&"merge_field"===td,mergeFieldContext:tY,productContext:tX,senderProfile:tZ,targetAudienceQuery:t0,setEmailSubject:tQ,setOriginalEmailSubject:tV,setToEmail:eF,setEmailContent:tU,setOriginalEmailContent:tW}),{data:t3=[],isLoading:t5}=(0,j.useQuery)({queryKey:["/api/email-templates"],staleTime:3e5,gcTime:6e5,retry:1,refetchOnMount:!1}),{data:t4}=(0,j.useQuery)({queryKey:["/api/gmail/auth-status"],refetchInterval:5e3}),{data:t6}=(0,j.useQuery)({queryKey:["/api/gmail/user"],enabled:!!t4?.authorized}),t7=(0,y.useMutation)({mutationFn:async e=>{let t=await (0,v.apiRequest)("POST","/api/send-gmail",e);return await t.json()},onSuccess:()=>{tH(),eX(!0),eE(""),eO(""),eG(""),eF(""),tb(""),tN(""),tk(""),tE(""),es({title:"Email sent successfully!",description:"Your email has been sent via Gmail."}),setTimeout(()=>eX(!1),3e3)},onError:e=>{console.error("Send email error:",e),es({title:"Failed to send email",description:e.message||"Please try again or send manually.",variant:"destructive"})}}),t8=(0,y.useMutation)({mutationFn:async e=>{let t,a=tt;if(!a&&o&&d&&(a={type:"current",listId:o,query:d}),!a)throw console.error("No recipients available:",{campaignRecipients:tt,currentListId:o,currentQuery:d,drawerMode:l}),Error("No recipients available. Please run a search first or select recipients for your campaign");if("existing"===a.type)t=a.contactListId;else{let e={};"current"===a.type?(e.currentListId=a.listId,e.currentQuery=a.query):"multiple"===a.type&&(e.searchListIds=a.searchListIds);let s=await (0,v.apiRequest)("POST","/api/contact-lists/from-search",e);t=(await s.json()).id}let s={name:tB()||"Untitled Campaign",subject:tB(),body:tK(),prompt:eP,contactListId:t,status:"scheduled"===e?"scheduled":"immediate"===e?"active":"draft",tone:eQ,offerType:eW,generationType:td,start_date:"immediate"===e?new Date().toISOString():tl.scheduleSend&&tl.scheduleDate?new Date(tl.scheduleDate).toISOString():an().toISOString(),sendTimePreference:e,scheduleDate:tl.scheduleSend&&tl.scheduleDate?tl.scheduleDate:void 0,scheduleTime:tl.scheduleSend&&tl.scheduleTime?tl.scheduleTime:void 0,timezone:"America/New_York",autopilotEnabled:tl.autopilot,autopilotSettings:tl.autopilotSettings,maxEmailsPerDay:tl.autopilotSettings?.maxEmailsPerDay||20,delayBetweenEmails:tl.autopilotSettings?.delayBetweenEmails||30,trackEmails:tl.trackEmails,unsubscribeLink:tl.unsubscribeLink,requiresHumanReview:tl.requiresHumanReview,senderProfileId:tO};eB&&(s.productId=eB,s.strategicProfileId=eB);let r=await (0,v.apiRequest)("POST","/api/campaigns",s);return await r.json()},onSuccess:(e,t)=>{let a="Campaign Created!",s=`Your campaign "${e.name}" has been created successfully.`;"immediate"===t?(a="Campaign Started!",s=`Your campaign "${e.name}" has started and emails are being sent.`):"draft"===t?(a="Campaign Saved as Draft!",s=`Your campaign "${e.name}" has been saved as a draft for later.`):"scheduled"===t&&(a="Campaign Scheduled!",s=`Your campaign "${e.name}" has been scheduled and will start at the configured time.`),es({title:a,description:s}),tH(),eE(""),eO(""),eG(""),tb(""),tN(""),tk(""),tE(""),ta(null),v.queryClient.invalidateQueries({queryKey:["/api/campaigns"]})},onError:e=>{es({title:"Campaign Creation Failed",description:e instanceof Error?e.message:"Failed to create campaign",variant:"destructive"})}});(0,m.useEffect)(()=>{if(t_.length>0&&!tO){let e=t_.find(e=>e.isDefault)||t_[0];e&&(tL(e),t$(e.id))}},[t_]),(0,m.useEffect)(()=>{console.log("EmailComposer useEffect - campaign recipients check:",{drawerMode:l,currentListId:o,currentQuery:d,hasCampaignRecipients:!!tt,selectedContactEmail:e?.email}),"compose"===l&&e?.email?eF(e.email):"campaign"===l&&o&&d&&!tt?(console.log("Auto-setting campaign recipients with current search:",{type:"current",listId:o,query:d}),ta({type:"current",listId:o,query:d})):"campaign"!==l||o&&d||console.warn("Cannot auto-set recipients - missing search data:",{currentListId:o,currentQuery:d})},[e,l,o,d]),(0,m.useEffect)(()=>{t9()},[eP]);let t9=()=>{if(tI.current){tI.current.style.height="auto";let e=Math.min(Math.max(tI.current.scrollHeight,32),120);tI.current.style.height=`${e}px`}},ae=(e,t)=>e4?t||e:(0,D.resolveAllMergeFields)(t||e,tY),at=e=>{e?(eK(e.id),eC(e)):(eK(null),eC(null),eE(""),eA(""))},aa=e=>{let t=tK()+e;tU(t),tW(t)},as=()=>{e6(!e4)},ar=async()=>{if(th.trim())try{await (0,v.apiRequest)("POST","/api/email-templates",{name:th,subject:tB(),content:tK(),description:eP}),v.queryClient.invalidateQueries({queryKey:["/api/email-templates"]}),es({title:"Template saved successfully!"}),tx(!1),tg("")}catch(e){console.error("Save template error:",e),es({title:"Failed to save template",description:"Please try again.",variant:"destructive"})}},ai=()=>tt?"current"===tt.type?tt.query:"multiple"===tt.type?`${tt.searchListIds.length} search lists selected`:"existing"===tt.type?tt.contactListName:"Select recipients":"Select recipients",an=()=>{let e=new Date,t=e.getHours(),a=e.getDay();if(0===a||6===a){let t=new Date(e);return t.setDate(e.getDate()+(8-a)%7),t.setHours(9,0,0,0),t}if(t<9){let t=new Date(e);return t.setHours(9,0,0,0),t}if(t>=17){let t=new Date(e);return 5===a?t.setDate(e.getDate()+3):t.setDate(e.getDate()+1),t.setHours(9,0,0,0),t}let s=new Date(e);if(s.setHours(t+1,0,0,0),s.getHours()>=17){let t=new Date(e);return 5===a?t.setDate(e.getDate()+3):t.setDate(e.getDate()+1),t.setHours(9,0,0,0),t}return s};return(0,t.jsxs)("div",{className:E?"flex flex-col h-full overflow-y-auto":"campaign"===l?"space-y-0":"space-y-0 md:space-y-4",children:[(0,t.jsxs)("div",{className:"campaign"===l?"relative":"",children:["campaign"===l&&(0,t.jsx)("div",{className:"relative z-20",children:(0,t.jsx)(em,{selectedMode:td,onModeChange:tc,className:""})}),(0,t.jsx)(eM,{selectedProduct:eB,selectedProductData:ew,onProductSelect:e=>{eP&&ew&&e.id!==ew.id?(e5(e),e2(!0)):at(e)},onProductClear:()=>{eP&&ew?(e5(null),e2(!0)):(eK(null),eC(null),eE(""),eA(""))},selectedTone:eQ,onToneSelect:eV,selectedOfferStrategy:eW,onOfferStrategySelect:eJ,products:tz,emailPrompt:eP,originalEmailPrompt:V??eo,onPromptChange:e=>{eE(e),eA(e)},onPromptResize:t9,promptTextareaRef:tI,getDisplayValue:ae,onGenerate:()=>{ew||eP&&""!==eP.trim()?eR||eq?e0(!0):t1():es({title:"No Context Provided",description:"Please select a product or provide details about your offering.",variant:"destructive"})},isGenerating:t2,drawerMode:l,generationMode:td,selectedSenderProfile:tO,onSenderProfileSelect:e=>{t$(e);let t=t_.find(t=>t.id===e);t&&tL(t)},senderProfiles:t_,isExpanded:c,isMobile:E})]}),(0,t.jsx)("div",{className:"relative border-b md:border-b-0 md:mb-6",style:{marginBottom:"-1px"},children:"compose"===l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.Mail,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),(0,t.jsx)(u.Input,{ref:tF,placeholder:"Recipient Email",value:ae(eI),onChange:e=>eF(e.target.value),type:"email",className:"mobile-input mobile-input-text-fix pl-10 border-0 rounded-none md:border md:rounded-t-md focus-visible:ring-0 focus-visible:ring-offset-0 placeholder:text-muted-foreground/50"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.Users,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),(0,t.jsxs)("div",{onClick:()=>te(!0),className:"mobile-input mobile-input-text-fix pl-10 pr-3 py-2 border-0 rounded-none md:border md:rounded-t-md cursor-pointer transition-colors hover:bg-muted/50 flex items-center justify-between",children:[tt?(0,t.jsxs)("span",{className:"group inline-flex items-center px-2.5 py-1 rounded bg-muted/50 hover:bg-primary/10 text-muted-foreground hover:text-primary text-sm font-normal truncate max-w-full transition-colors relative",children:[(0,t.jsx)("span",{className:"truncate",children:ai()}),(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),ta(null)},className:"ml-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:text-destructive","aria-label":"Remove recipients",children:(0,t.jsx)(a.X,{className:"h-3 w-3"})})]}):(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:ai()}),(0,t.jsx)(h.ChevronDown,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsx)(_,{open:e9,onOpenChange:te,currentListId:o,currentQuery:d,onSelect:e=>{ta(e),te(!1)}})]})}),(0,t.jsx)("div",{className:E?"flex-1 min-h-0 flex flex-col":"",children:(0,t.jsx)(eU,{drawerMode:l,toEmail:eI,emailSubject:tB(),originalEmailSubject:"campaign"===l?"merge_field"===td?tj:tT:W??eh,emailContent:tK(),originalEmailContent:"campaign"===l?"merge_field"===td?tw:tM:Y??ej,onSubjectChange:e=>{tQ(e),("compose"===l||e4)&&tV(e)},onContentChange:e=>{tU(e),("compose"===l||e4)&&tW(e)},gmailStatus:t4,gmailUserInfo:t6,isGmailButtonHovered:e7,onGmailButtonHover:e8,onGmailConnect:()=>{ei?.id?window.open(`/api/gmail/auth?userId=${ei.id}`,"_blank"):es({title:"Not authenticated",description:"Please log in to connect Gmail.",variant:"destructive"})},sendEmailMutation:t7,isSent:eY,selectedContact:e,selectedCompany:r,onSendEmail:()=>{eI&&eq&&eR?t7.mutate({to:eI,subject:eq,body:eR}):es({title:"Missing fields",description:"Please fill in all email fields.",variant:"destructive"})},onManualSend:()=>{console.log("Email opened in default client")},campaignRecipients:tt||void 0,currentListId:o,currentQuery:d,onCreateCampaign:(e="scheduled")=>{o||tt?tK()?(!tt&&o&&d&&ta({type:"current",listId:o,query:d}),to(t=>({...t,scheduleSend:"scheduled"===e})),t8.mutate(e)):es({title:"No Email Content",description:"Please add email content for your campaign",variant:"destructive"}):es({title:"No Recipients Available",description:"Please run a search first or select recipients for your campaign",variant:"destructive"})},generationType:td,creatingCampaign:t8.isPending,isMergeViewMode:e4,getDisplayValue:ae,isExpanded:c,isMobile:E})}),"campaign"===l&&"merge_field"===td&&(0,t.jsxs)(t.Fragment,{children:[e4&&(0,t.jsx)("div",{className:"mt-8 mb-3 bg-blue-50 border border-blue-200 text-blue-800 px-3 py-2 rounded-md text-sm",children:"Merge View Mode - Showing technical merge fields"}),(0,t.jsx)("div",{className:"mt-4 pt-2 flex justify-end",children:(0,t.jsx)(e_,{isMergeViewMode:e4,onToggleMergeView:as,onMergeFieldClick:()=>tu(!0),onSaveTemplateClick:()=>{tg(""),tx(!0)}})})]}),(0,t.jsxs)("div",{className:"mt-2 pt-1",children:[(0,t.jsxs)("div",{className:"flex justify-start gap-2",children:["campaign"===l&&(0,t.jsxs)("button",{onClick:()=>tr(!ts),className:"flex items-center gap-1.5 px-2.5 py-1 text-xs text-muted-foreground hover:text-foreground transition-colors border border-border rounded-md",children:[(0,t.jsx)("span",{children:"Campaign Settings"}),ts?(0,t.jsx)(g.ChevronUp,{className:"w-3.5 h-3.5"}):(0,t.jsx)(h.ChevronDown,{className:"w-3.5 h-3.5"})]}),(0,t.jsxs)("button",{onClick:()=>tn(!ti),className:"flex items-center gap-1.5 px-2.5 py-1 text-xs text-muted-foreground hover:text-foreground transition-colors border border-border rounded-md","data-testid":"button-templates-toggle",children:[(0,t.jsx)("span",{children:"Templates"}),ti?(0,t.jsx)(g.ChevronUp,{className:"w-3.5 h-3.5"}):(0,t.jsx)(h.ChevronDown,{className:"w-3.5 h-3.5"})]})]}),"campaign"===l&&(0,t.jsx)("div",{className:(0,b.cn)("overflow-hidden transition-all duration-300 ease-in-out",ts?"max-h-[500px] opacity-100 mt-2":"max-h-0 opacity-0"),children:(0,t.jsx)(ea,{open:!0,onOpenChange:()=>{},settings:tl,onSettingsChange:to,totalRecipients:tt?100:50,className:""})}),(0,t.jsx)("div",{className:(0,b.cn)("overflow-hidden transition-all duration-300 ease-in-out",ti?"max-h-[500px] opacity-100 mt-2":"max-h-0 opacity-0"),children:(0,t.jsx)(ez,{templates:t3,templatesLoading:t5,onTemplateSelect:e=>{eE(e.description||""),tU(e.content),tQ(e.subject||""),eA(e.description||""),tW(e.content),tV(e.subject||"")},currentContent:tK(),currentSubject:tB(),emailPrompt:eP,isMergeViewMode:e4,onMergeViewToggle:as,onMergeFieldInsert:aa,selectedContact:e,selectedCompany:r,user:ei,editingTemplateId:null,editingTemplate:null})})]}),(0,t.jsx)(x.AlertDialog,{open:eZ,onOpenChange:e0,children:(0,t.jsxs)(x.AlertDialogContent,{children:[(0,t.jsxs)(x.AlertDialogHeader,{children:[(0,t.jsx)(x.AlertDialogTitle,{children:"Generate AI Email"}),(0,t.jsx)(x.AlertDialogDescription,{children:"This will replace all content in email subject and body fields."})]}),(0,t.jsxs)(x.AlertDialogFooter,{children:[(0,t.jsx)(x.AlertDialogCancel,{onClick:()=>e0(!1),children:"Cancel"}),(0,t.jsx)(x.AlertDialogAction,{onClick:()=>{e0(!1),t1()},children:"Generate Email"})]})]})}),(0,t.jsx)(x.AlertDialog,{open:e1,onOpenChange:e2,children:(0,t.jsxs)(x.AlertDialogContent,{children:[(0,t.jsxs)(x.AlertDialogHeader,{children:[(0,t.jsx)(x.AlertDialogTitle,{children:"Change Product"}),(0,t.jsx)(x.AlertDialogDescription,{children:"This will replace the current email prompt with the new product details. Continue?"})]}),(0,t.jsxs)(x.AlertDialogFooter,{children:[(0,t.jsx)(x.AlertDialogCancel,{onClick:()=>{e2(!1),e5(null)},children:"Cancel"}),(0,t.jsx)(x.AlertDialogAction,{onClick:()=>{at(e3),e2(!1),e5(null)},children:"OK"})]})]})}),(0,t.jsx)(eL,{open:tm,onOpenChange:tu,onMergeFieldInsert:aa}),(0,t.jsx)(A.Dialog,{open:tp,onOpenChange:tx,children:(0,t.jsxs)(A.DialogContent,{children:[(0,t.jsxs)(A.DialogHeader,{children:[(0,t.jsx)(A.DialogTitle,{children:"Save as Template"}),(0,t.jsx)(A.DialogDescription,{children:"Enter name of new template:"})]}),(0,t.jsx)("div",{className:"py-4",children:(0,t.jsx)(u.Input,{placeholder:"Sales Genius 2027",value:th,onChange:e=>tg(e.target.value),onKeyDown:e=>{"Enter"===e.key&&th.trim()&&ar()},className:"w-full"})}),(0,t.jsxs)(A.DialogFooter,{children:[(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>tx(!1),children:"Cancel"}),(0,t.jsx)(p.Button,{onClick:ar,disabled:!th.trim(),children:"Save Template"})]})]})})]})}function eJ({open:e,mode:n,viewState:m,selectedContact:u,selectedCompany:p,selectedCompanyContacts:x,width:h,isResizing:g,currentListId:f,currentQuery:b,emailSubject:j,onClose:y,onModeChange:v,onContactChange:N,onResizeStart:w,onMinimize:C,onExpand:S,onRestore:k}){if(!e)return null;let T=()=>{let e=x.findIndex(e=>e.id===u?.id),t=e>0?e-1:x.length-1;N(x[t])},D=()=>{let e=x.findIndex(e=>e.id===u?.id),t=e<x.length-1?e+1:0;N(x[t])},P=()=>(0,t.jsxs)("div",{className:"sticky top-0 bg-panel-background px-4 py-1.5 z-10",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{onClick:()=>v("compose"),className:`flex items-center gap-1 px-2 py-1 rounded text-xs font-medium transition-colors group ${"compose"===n?"bg-muted/30 text-muted-foreground hover:bg-primary/10 hover:text-primary":"text-muted-foreground/60 hover:text-foreground hover:bg-muted"}`,"data-testid":"button-compose-tab",children:[(0,t.jsx)(s.Mail,{className:`h-3.5 w-3.5 transition-colors ${"compose"===n?"text-muted-foreground group-hover:text-primary":""}`}),"Compose"]}),(0,t.jsxs)("button",{onClick:()=>v("campaign"),className:`flex items-center gap-1 px-2 py-1 rounded text-xs font-medium transition-colors group ${"campaign"===n?"bg-muted/30 text-muted-foreground hover:bg-primary/10 hover:text-primary":"text-muted-foreground/60 hover:text-foreground hover:bg-muted"}`,"data-testid":"button-campaign-tab",children:[(0,t.jsx)(l,{className:`h-3.5 w-3.5 transition-colors ${"campaign"===n?"text-muted-foreground group-hover:text-primary":""}`}),"Campaign"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,t.jsx)("button",{onClick:C,className:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Minimize","data-testid":"button-minimize-drawer",children:(0,t.jsx)(o,{className:"h-3.5 w-3.5 text-gray-500 dark:text-gray-400"})}),(0,t.jsx)("button",{onClick:"expanded"===m?k:S,className:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"expanded"===m?"Restore":"Expand","data-testid":"button-expand-drawer",children:"expanded"===m?(0,t.jsx)(c.Minimize2,{className:"h-3.5 w-3.5 text-gray-500 dark:text-gray-400"}):(0,t.jsx)(d.Maximize2,{className:"h-3.5 w-3.5 text-gray-500 dark:text-gray-400"})}),(0,t.jsx)("button",{onClick:y,className:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Close email panel","data-testid":"button-close-drawer",children:(0,t.jsx)(a.X,{className:"h-3.5 w-3.5 text-gray-500 dark:text-gray-400"})})]})]}),"compose"===n&&u&&(0,t.jsxs)("div",{className:"flex items-center justify-between mt-0.5",children:[(0,t.jsxs)("p",{className:"text-sm truncate flex-1 min-w-0","data-testid":"text-contact-info",children:[(0,t.jsx)("span",{className:"font-medium",children:u.name}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[" â€¢ ",p?.name]})]}),x.length>1&&(0,t.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0 ml-2",children:[(0,t.jsx)("button",{onClick:T,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800","data-testid":"button-prev-contact",children:(0,t.jsx)(r.ChevronLeft,{className:"h-4 w-4"})}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground","data-testid":"text-contact-count",children:[x.findIndex(e=>e.id===u?.id)+1," / ",x.length]}),(0,t.jsx)("button",{onClick:D,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800","data-testid":"button-next-contact",children:(0,t.jsx)(i.ChevronRight,{className:"h-4 w-4"})})]})]})]});return"minimized"===m?(0,t.jsx)("div",{className:"fixed bottom-0 right-16 z-50 bg-panel-background border border-b-0 rounded-t-lg shadow-lg cursor-pointer hover:shadow-xl transition-shadow",onClick:k,"data-testid":"minimized-drawer-bar",children:(0,t.jsxs)("div",{className:"flex items-center justify-between min-w-[280px] px-3 py-1.5",children:[(0,t.jsx)("span",{className:"text-sm font-medium truncate max-w-[200px] text-foreground",children:"campaign"===n?"New Campaign":j&&j.trim()?j.length>30?j.substring(0,30)+"...":j:"New Message"}),(0,t.jsxs)("div",{className:"flex items-center gap-0.5 ml-3",children:[(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),k()},className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Restore","data-testid":"button-restore-minimized",children:(0,t.jsx)(d.Maximize2,{className:"h-3.5 w-3.5 text-gray-500 dark:text-gray-400"})}),(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),y()},className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Close","data-testid":"button-close-minimized",children:(0,t.jsx)(a.X,{className:"h-3.5 w-3.5 text-gray-500 dark:text-gray-400"})})]})]})}):"expanded"===m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-40 bg-black/50",onClick:k,"data-testid":"expanded-drawer-backdrop"}),(0,t.jsx)("div",{className:"fixed top-[5%] left-1/2 -translate-x-1/2 z-50 w-full max-w-3xl h-[90vh] bg-panel-background border rounded-lg shadow-2xl overflow-hidden","data-testid":"expanded-drawer",children:(0,t.jsxs)("div",{className:"h-full overflow-y-auto pb-2",children:[P(),(0,t.jsx)("div",{className:"px-4 pt-4 pb-2",children:(0,t.jsx)(eW,{selectedContact:u,selectedCompany:p,onContactChange:N,drawerMode:n,currentListId:f,currentQuery:b,isExpanded:!0})})]})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:`duplicate-full-height-drawer-to-keep-column-aligned ${e?"hidden md:block md:relative md:h-full":"hidden md:block md:relative w-0"}`,style:{...e&&window.innerWidth>=768?{width:`${h}px`}:{}},children:(0,t.jsxs)("div",{className:`${!g?"email-drawer-transition":""} ${e?"fixed md:absolute top-[2.5rem] md:top-0 right-0 bottom-auto max-h-[calc(100vh-2.5rem)] md:max-h-screen w-[90%] sm:w-[400px] z-50":"fixed md:absolute w-0 right-0 top-0"} overflow-hidden border-l border-t border-b rounded-tl-lg rounded-bl-lg bg-panel-background shadow-xl`,style:{...e&&window.innerWidth>=768?{width:`${h}px`}:{},...g?{transition:"none"}:{}},"data-testid":"drawer-email",children:[e&&(0,t.jsx)("div",{onMouseDown:w,className:"hidden md:block absolute -left-1.5 top-0 bottom-0 w-3 cursor-col-resize z-10 group","data-testid":"handle-resize",children:(0,t.jsx)("div",{className:"absolute left-1 top-1/2 -translate-y-1/2 w-2 h-12 bg-muted-foreground/40 rounded-full opacity-0 group-hover:opacity-100 transition-opacity"})}),(0,t.jsxs)("div",{className:"overflow-y-auto max-h-[calc(100vh-2.5rem)] md:max-h-screen pb-2",style:{minWidth:e?"320px":"0"},children:[P(),(0,t.jsx)("div",{className:"px-4 pt-4 pb-2",children:(0,t.jsx)(eW,{selectedContact:u,selectedCompany:p,onContactChange:N,drawerMode:n,currentListId:f,currentQuery:b})})]})]})}),(0,t.jsx)("div",{className:`md:hidden email-drawer-transition ${e?"fixed bottom-0 right-0 h-[98vh] w-full z-50":"fixed w-0 right-0 bottom-0"} overflow-hidden border-t rounded-t-lg bg-background shadow-xl flex flex-col`,children:e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex-none",children:P()}),(0,t.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden px-2 py-3",children:(0,t.jsx)(eW,{selectedContact:u,selectedCompany:p,onContactChange:N,drawerMode:n,currentListId:f,currentQuery:b,isMobile:!0})})]})})]})}function eY(e={}){let t=ei(),[a,s]=(0,m.useState)(t.isOpen||!1),[r,i]=(0,m.useState)(t.drawerMode||"compose"),[n,l]=(0,m.useState)("normal"),[o,d]=(0,m.useState)(null),[c,u]=(0,m.useState)(null),[p,x]=(0,m.useState)([]),[h,g]=(0,m.useState)(480),[f,b]=(0,m.useState)(!1);(0,m.useEffect)(()=>{let e=e=>{f&&g(Math.max(320,Math.min(720,window.innerWidth-e.clientX)))},t=()=>{b(!1)};return f&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),document.body.style.userSelect="none",document.body.style.cursor="col-resize"),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t),document.body.style.userSelect="",document.body.style.cursor=""}},[f]);let j=(0,m.useCallback)((t,a,r)=>{d(t),u(a),x(r),s(!0),l("normal"),e.onOpen?.(t,a)},[e]),y=(0,m.useCallback)(()=>{s(!1),en(!1),i("compose"),l("normal"),d(null),u(null),x([]),e.onClose?.()},[e]),v=(0,m.useCallback)(()=>{i("compose"),d(null),u(null),x([]),s(!0),l("normal")},[]),N=(0,m.useCallback)(e=>{e.preventDefault(),b(!0)},[]),w=(0,m.useCallback)(()=>{l("minimized")},[]);return{isOpen:a,mode:r,viewState:n,selectedContact:o,selectedCompany:c,selectedCompanyContacts:p,drawerWidth:h,isResizing:f,openDrawer:j,openCompose:v,closeDrawer:y,setMode:i,setSelectedContact:d,setIsResizing:b,handleMouseDown:N,minimize:w,expand:(0,m.useCallback)(()=>{l("expanded")},[]),restore:(0,m.useCallback)(()=>{l("normal")},[])}}e.s(["EmailDrawer",()=>eJ],36308),e.s(["useEmailDrawer",()=>eY],37931),e.s([],17484)}]);