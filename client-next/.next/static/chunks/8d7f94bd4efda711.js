(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,56758,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(54616),r=e.i(12598),o=e.i(42023),n=e.i(6625),l=e.i(22956),i=e.i(47492),c=e.i(4766),d=e.i(37014);function u({phase:e,completed:s,total:a,isVisible:r}){if(!r)return null;let o=a>0?Math.round(s/a*100):0,n=o<100&&o>0;return(0,t.jsxs)("div",{className:"mt-3 mb-1 w-full",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,t.jsx)("span",{className:"text-xs font-medium",children:e}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[o,"%"]})]}),(0,t.jsx)(d.Progress,{value:o,className:"h-1.5",showShimmer:n})]})}function m(){return(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"border rounded-lg",children:[(0,t.jsxs)("div",{className:"h-12 bg-slate-100 dark:bg-slate-800 rounded-t-lg flex items-center px-4",children:[(0,t.jsx)("div",{className:"h-4 bg-slate-300 dark:bg-slate-600 rounded w-20 animate-pulse"}),(0,t.jsx)("div",{className:"h-4 bg-slate-300 dark:bg-slate-600 rounded w-32 ml-8 animate-pulse"}),(0,t.jsx)("div",{className:"h-4 bg-slate-300 dark:bg-slate-600 rounded w-24 ml-8 animate-pulse"}),(0,t.jsx)("div",{className:"h-4 bg-slate-300 dark:bg-slate-600 rounded w-16 ml-auto animate-pulse"})]}),Array.from({length:5}).map((e,s)=>(0,t.jsxs)("div",{className:"h-16 border-t flex items-center px-4 space-x-8",children:[(0,t.jsx)("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-24 animate-pulse"}),(0,t.jsx)("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-48 animate-pulse"}),(0,t.jsx)("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-32 animate-pulse"}),(0,t.jsx)("div",{className:"h-8 bg-slate-200 dark:bg-slate-700 rounded w-20 ml-auto animate-pulse"})]},s))]})})}e.i(77296);var h=e.i(91589),p=e.i(90250),g=e.i(84923),f=e.i(58260),x=e.i(31278),S=e.i(55436),y=e.i(43553),b=e.i(42920),v=e.i(61911),C=e.i(20278),w=e.i(39616),j=e.i(52044);e.i(67073);var T=e.i(31648);class N{static SESSION_PREFIX="searchSession_";static MAX_SESSION_AGE=18e5;static createSession(e,t,s){let a=`search_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r={id:a,query:e,status:"pending",startTime:Date.now(),lastChecked:Date.now(),strategyId:t,contactSearchConfig:s};return this.saveSession(r),console.log("Created search session:",a,"for query:",e),this.cleanupActiveSessions().catch(e=>console.warn("[Session Cleanup] Background cleanup failed:",e)),r}static updateSessionWithJob(e,t){let s=this.getSession(e);s&&(s.jobId=t,s.lastChecked=Date.now(),this.saveSession(s),console.log("Updated session with job ID:",e,t))}static updateWithQuickResults(e,t){let s=this.getSession(e);s&&(s.status="companies_found",s.quickResults=t,s.lastChecked=Date.now(),this.saveSession(s),console.log("Updated session with quick results:",e,t.length,"companies"))}static updateWithFullResults(e,t){let s=this.getSession(e);s&&(s.status="contacts_complete",s.fullResults=t,s.lastChecked=Date.now(),this.saveSession(s),console.log("Updated session with full results:",e,t.length,"companies with contacts"))}static markSessionFailed(e){let t=this.getSession(e);t&&(t.status="failed",t.lastChecked=Date.now(),this.saveSession(t),console.log("Marked session as failed:",e))}static markEmailSearchStarted(e){let t=this.getSession(e);t&&(t.emailSearchStatus="running",t.lastChecked=Date.now(),this.saveSession(t),console.log("Marked email search as started for session:",e))}static markEmailSearchCompleted(e){let t=this.getSession(e);t&&(t.emailSearchStatus="completed",t.emailSearchCompleted=Date.now(),t.lastChecked=Date.now(),this.saveSession(t),console.log("Marked email search as completed for session:",e))}static markQuickResultsComplete(e){let t=this.getSession(e);t&&t.quickResults&&(t.status="companies_complete",t.lastChecked=Date.now(),this.saveSession(t),console.log(`Marked quick results as complete for session: ${e}`))}static getActiveSessions(){return this.getAllSessions().filter(e=>"pending"===e.status||"companies_found"===e.status)}static getMostRecentCompleteSession(){return this.getAllSessions().filter(e=>"contacts_complete"===e.status||"companies_complete"===e.status).sort((e,t)=>t.startTime-e.startTime)[0]||null}static getSession(e){try{let t=localStorage.getItem(`${this.SESSION_PREFIX}${e}`);if(t)return JSON.parse(t)}catch(e){console.error("Error loading search session:",e)}return null}static saveSession(e){try{localStorage.setItem(`${this.SESSION_PREFIX}${e.id}`,JSON.stringify(e))}catch(e){console.error("Error saving search session:",e)}}static getAllSessions(){let e=[];for(let t=0;t<localStorage.length;t++){let s=localStorage.key(t);if(s&&s.startsWith(this.SESSION_PREFIX))try{let t=localStorage.getItem(s);if(t){let a=JSON.parse(t);Date.now()-a.startTime<this.MAX_SESSION_AGE?e.push(a):localStorage.removeItem(s)}}catch(e){console.error("Error parsing session:",e),localStorage.removeItem(s)}}return e.sort((e,t)=>t.startTime-e.startTime)}static cleanupOldSessions(){let e=Date.now()-864e5;for(let t=0;t<localStorage.length;t++){let s=localStorage.key(t);if(s&&s.startsWith(this.SESSION_PREFIX))try{let t=localStorage.getItem(s);if(t){let a=JSON.parse(t);a.startTime<e&&("contacts_complete"===a.status||"failed"===a.status)&&(localStorage.removeItem(s),console.log("Cleaned up old session:",a.id))}}catch(e){localStorage.removeItem(s)}}}static cleanupSession(e){try{localStorage.removeItem(`${this.SESSION_PREFIX}${e}`),console.log("Cleaned up session:",e)}catch(e){console.error("Error cleaning up session:",e)}}static clearAllSessions(){let e=[];for(let t=0;t<localStorage.length;t++){let s=localStorage.key(t);s&&s.startsWith(this.SESSION_PREFIX)&&e.push(s)}e.forEach(e=>localStorage.removeItem(e)),console.log("Cleared all search sessions")}static async cleanupActiveSessions(){try{let e=this.getActiveSessions();if(e.length>0){for(let t of(console.log(`[Session Cleanup] Found ${e.length} active sessions, terminating...`),e)){try{(await fetch(`/api/search-sessions/${t.id}`,{method:"DELETE"})).ok&&console.log(`[Session Cleanup] Backend session terminated: ${t.id}`)}catch(e){console.warn(`[Session Cleanup] Failed to terminate backend session ${t.id}:`,e)}this.cleanupSession(t.id)}console.log(`[Session Cleanup] Completed cleanup of ${e.length} sessions`)}}catch(e){console.error("[Session Cleanup] Error during active session cleanup:",e)}}static async terminateSession(e){try{(await fetch(`/api/search-sessions/${e}`,{method:"DELETE"})).ok&&console.log(`[Session Cleanup] Backend session terminated: ${e}`),this.cleanupSession(e)}catch(t){console.error(`[Session Cleanup] Error terminating session ${e}:`,t),this.cleanupSession(e)}}static async bulkCleanupCompletedSessions(){try{let e=await fetch("/api/search-sessions",{method:"DELETE"});if(e.ok){let t=await e.json();console.log(`[Bulk Cleanup] ${t.message}`);let s=this.getAllSessions(),a=0;for(let e of s){let t=Date.now()-e.startTime>36e5,s="completed"===e.emailSearchStatus;(t||s)&&(this.cleanupSession(e.id),a++)}console.log(`[Bulk Cleanup] Cleaned ${a} local sessions`)}}catch(e){console.error("[Bulk Cleanup] Error during bulk cleanup:",e)}}}e.i(51402);var k=e.i(15762);let E="searchState",I=()=>{try{let e=sessionStorage.getItem(E);if(e){let t=JSON.parse(e);if(t.currentQuery||t.currentResults&&t.currentResults.length>0)return t}}catch(e){console.error("Error loading search session state:",e)}return null},R=e=>{try{if(!e.currentQuery&&(!e.currentResults||0===e.currentResults.length))return;sessionStorage.setItem(E,JSON.stringify(e))}catch(e){console.error("Error saving search session state:",e)}},$=()=>{sessionStorage.removeItem(E)};var F=e.i(94318),D=e.i(10704),P=e.i(62156),O=e.i(37880),q=e.i(43531),L=e.i(7233),M=e.i(37727),A=e.i(56909),Q=e.i(92930),_=e.i(24487);let B=s.default.memo(function({config:e,onConfigChange:a,disabled:r=!1,isSearching:o=!1,hasSearchResults:n=!1,inputHasChanged:l=!1}){let[i,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[m,h]=(0,s.useState)(""),[p,g]=(0,s.useState)(""),[f,x]=(0,s.useState)(""),[S,w]=(0,s.useState)(!1),j=(0,s.useRef)(null),[T,N]=(0,s.useState)(()=>{if(e)return e;let t=localStorage.getItem("contactSearchConfig");if(t)try{let e=JSON.parse(t);return{enableCoreLeadership:!0,enableDepartmentHeads:!1,enableMiddleManagement:!1,enableCustomSearch:!1,customSearchTarget:"",enableCustomSearch2:!1,customSearchTarget2:"",...e}}catch(e){console.error("Error loading saved contact search config:",e)}return{enableCoreLeadership:!0,enableDepartmentHeads:!1,enableMiddleManagement:!1,enableCustomSearch:!1,customSearchTarget:"",enableCustomSearch2:!1,customSearchTarget2:""}});(0,s.useEffect)(()=>{e&&(N(e),h(e.customSearchTarget||""),g(e.customSearchTarget2||""))},[e]),(0,s.useEffect)(()=>{localStorage.setItem("contactSearchConfig",JSON.stringify(T))},[T]),(0,s.useEffect)(()=>()=>{j.current&&clearTimeout(j.current)},[]);let k=e=>{N(t=>{let s={...t,...e};return a(s),s})},E=e=>{window.innerWidth<768?S?e():(w(!0),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{w(!1)},5e3)):e()},I=()=>{let e=m.trim();k({customSearchTarget:e,enableCustomSearch:!!e&&T.enableCustomSearch}),c(!1),e||h("")},R=()=>{c(!0),h(T.customSearchTarget)},$=()=>{T.customSearchTarget.trim()?T.enableCustomSearch?k({enableCustomSearch:!1}):k({enableCoreLeadership:!1,enableDepartmentHeads:!1,enableMiddleManagement:!1,enableCustomSearch:!0,enableCustomSearch2:!1}):c(!0)},F=()=>{let e=p.trim();k({customSearchTarget2:e,enableCustomSearch2:!!e&&T.enableCustomSearch2}),u(!1),e||g("")},D=()=>{i&&I(),u(!0),g(T.customSearchTarget2)},P=()=>{T.customSearchTarget2.trim()?T.enableCustomSearch2?k({enableCustomSearch2:!1}):k({enableCoreLeadership:!1,enableDepartmentHeads:!1,enableMiddleManagement:!1,enableCustomSearch:!1,enableCustomSearch2:!0}):u(!0)};return(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 mt-3",children:[(0,t.jsx)(_.TooltipProvider,{children:(0,t.jsxs)(_.Tooltip,{children:[(0,t.jsx)(_.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("button",{onClick:()=>E(()=>k({enableCoreLeadership:!T.enableCoreLeadership,enableDepartmentHeads:!1,enableMiddleManagement:!1,enableCustomSearch:!1,enableCustomSearch2:!1})),disabled:r,className:`
                flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200
                md:gap-2 gap-1 md:px-3 px-2
                ${!S?`max-md:justify-center ${T.enableCoreLeadership?"max-md:min-w-16 max-md:px-2":"max-md:w-10 max-md:h-10 max-md:px-0"}`:""}
                ${T.enableCoreLeadership?"bg-secondary text-secondary-foreground hover:bg-secondary-hover":"bg-muted text-muted-foreground hover:bg-muted-hover"}
                ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
              `,children:[T.enableCoreLeadership&&(0,t.jsx)(q.Check,{className:"h-3 w-3"}),(0,t.jsx)(y.Crown,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:`text-sm font-medium ${!S?"max-md:hidden":""}`,children:"Leadership"})]})}),(0,t.jsx)(_.TooltipContent,{children:(0,t.jsx)("p",{children:"CEO, CTO, Founders, C-level executives"})})]})}),(0,t.jsx)(_.TooltipProvider,{children:(0,t.jsxs)(_.Tooltip,{children:[(0,t.jsx)(_.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("button",{onClick:()=>E(()=>k({enableCoreLeadership:!1,enableDepartmentHeads:!T.enableDepartmentHeads,enableMiddleManagement:!1,enableCustomSearch:!1,enableCustomSearch2:!1})),disabled:r,className:`
                flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200
                md:gap-2 gap-1 md:px-3 px-2
                ${!S?`max-md:justify-center ${T.enableDepartmentHeads?"max-md:min-w-16 max-md:px-2":"max-md:w-10 max-md:h-10 max-md:px-0"}`:""}
                ${T.enableDepartmentHeads?"bg-secondary text-secondary-foreground hover:bg-secondary-hover":"bg-muted text-muted-foreground hover:bg-muted-hover"}
                ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
              `,children:[T.enableDepartmentHeads&&(0,t.jsx)(q.Check,{className:"h-3 w-3"}),(0,t.jsx)(b.Building,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:`text-sm font-medium ${!S?"max-md:hidden":""}`,children:"Marketing"})]})}),(0,t.jsx)(_.TooltipContent,{children:(0,t.jsx)("p",{children:"CMO, VP Marketing, Marketing Directors, Growth Leaders"})})]})}),(0,t.jsx)(_.TooltipProvider,{children:(0,t.jsxs)(_.Tooltip,{children:[(0,t.jsx)(_.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("button",{onClick:()=>E(()=>k({enableCoreLeadership:!1,enableDepartmentHeads:!1,enableMiddleManagement:!T.enableMiddleManagement,enableCustomSearch:!1,enableCustomSearch2:!1})),disabled:r,className:`
                flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200
                md:gap-2 gap-1 md:px-3 px-2
                ${!S?`max-md:justify-center ${T.enableMiddleManagement?"max-md:min-w-16 max-md:px-2":"max-md:w-10 max-md:h-10 max-md:px-0"}`:""}
                ${T.enableMiddleManagement?"bg-secondary text-secondary-foreground hover:bg-secondary-hover":"bg-muted text-muted-foreground hover:bg-muted-hover"}
                ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
              `,children:[T.enableMiddleManagement&&(0,t.jsx)(q.Check,{className:"h-3 w-3"}),(0,t.jsx)(v.Users,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:`text-sm font-medium ${!S?"max-md:hidden":""}`,children:"CTO"})]})}),(0,t.jsx)(_.TooltipContent,{children:(0,t.jsx)("p",{children:"Chief Technology Officer, VP Engineering, Technical Leaders"})})]})}),!i&&!T.customSearchTarget.trim()&&(0,t.jsx)("button",{onClick:()=>E(R),disabled:r,className:`
            flex items-center justify-center px-3 py-2 rounded-lg border border-dashed border-border 
            text-muted-foreground hover:bg-muted-hover transition-all duration-200 min-w-[40px]
            max-md:w-10 max-md:h-10 max-md:px-0
            ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
          `,children:(0,t.jsx)(L.Plus,{className:"h-4 w-4"})}),i&&(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border border-border bg-secondary",children:[(0,t.jsx)(C.Target,{className:"h-3 w-3 text-secondary-foreground"}),(0,t.jsx)(O.Input,{value:m,onChange:e=>h(e.target.value.slice(0,22)),placeholder:"e.g., Marketing Manager",disabled:r,maxLength:22,className:"h-6 text-sm border-none bg-transparent p-0 focus:ring-0 focus:outline-none min-w-[200px]",onKeyDown:e=>{"Enter"===e.key&&I(),"Escape"===e.key&&(c(!1),h(T.customSearchTarget))},onBlur:()=>{m.trim()||(c(!1),h(T.customSearchTarget))},autoFocus:!0}),(0,t.jsx)("button",{onClick:I,disabled:r,className:"text-secondary-foreground hover:text-foreground",children:(0,t.jsx)(A.Save,{className:"h-3 w-3"})}),(0,t.jsx)("button",{onClick:()=>{k({customSearchTarget:"",enableCustomSearch:!1}),c(!1),h("")},disabled:r,className:"text-destructive hover:text-destructive/80",children:(0,t.jsx)(M.X,{className:"h-3 w-3"})})]}),T.customSearchTarget.trim()&&!i&&(0,t.jsx)(_.TooltipProvider,{children:(0,t.jsxs)(_.Tooltip,{children:[(0,t.jsx)(_.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("button",{onClick:()=>E($),disabled:r,className:`
                  flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200
                  md:gap-2 gap-1 md:px-3 px-2
                  ${!S?`max-md:justify-center ${T.customSearchTarget.trim()?"max-md:min-w-16 max-md:px-2":"max-md:w-10 max-md:h-10 max-md:px-0"}`:""}
                  ${T.enableCustomSearch?"bg-secondary text-secondary-foreground hover:bg-secondary-hover":"bg-muted text-muted-foreground hover:bg-muted-hover"}
                  ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                `,children:[T.enableCustomSearch&&(0,t.jsx)(q.Check,{className:"h-3 w-3"}),(0,t.jsx)(C.Target,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:`text-sm font-medium ${!S?"max-md:hidden":""}`,children:T.customSearchTarget}),(0,t.jsx)("span",{onClick:e=>{e.stopPropagation(),R()},className:"ml-1 text-muted-foreground/60 hover:text-muted-foreground cursor-pointer",role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),e.stopPropagation(),R())},children:(0,t.jsx)(Q.Edit2,{className:"h-3 w-3"})})]})}),(0,t.jsx)(_.TooltipContent,{children:(0,t.jsxs)("p",{children:["Boost scores for ",T.customSearchTarget," roles"]})})]})}),!d&&!T.customSearchTarget2.trim()&&T.customSearchTarget.trim()&&(0,t.jsx)("button",{onClick:()=>E(D),disabled:r,className:`
            flex items-center justify-center px-3 py-2 rounded-lg border border-dashed border-border 
            text-muted-foreground hover:bg-muted-hover transition-all duration-200 min-w-[40px]
            max-md:w-10 max-md:h-10 max-md:px-0
            ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
          `,children:(0,t.jsx)(L.Plus,{className:"h-4 w-4"})}),d&&(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border border-border bg-secondary",children:[(0,t.jsx)("input",{type:"text",value:p,onChange:e=>g(e.target.value.slice(0,22)),placeholder:"e.g., Sales Director",disabled:r,maxLength:22,className:"h-6 text-sm border-none bg-transparent p-0 focus:ring-0 focus:outline-none min-w-[200px]",onKeyDown:e=>{"Enter"===e.key&&F(),"Escape"===e.key&&(u(!1),g(T.customSearchTarget2))},onBlur:()=>{p.trim()||(u(!1),g(T.customSearchTarget2))},autoFocus:!0}),(0,t.jsx)("button",{onClick:F,disabled:r,className:"text-secondary-foreground hover:text-foreground",children:(0,t.jsx)(A.Save,{className:"h-3 w-3"})}),(0,t.jsx)("button",{onClick:()=>{k({customSearchTarget2:"",enableCustomSearch2:!1}),u(!1),g("")},disabled:r,className:"text-destructive hover:text-destructive/80",children:(0,t.jsx)(M.X,{className:"h-3 w-3"})})]}),T.customSearchTarget2.trim()&&!d&&(0,t.jsx)(_.TooltipProvider,{children:(0,t.jsxs)(_.Tooltip,{children:[(0,t.jsx)(_.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("button",{onClick:()=>E(P),disabled:r,className:`
                  flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200
                  md:gap-2 gap-1 md:px-3 px-2
                  ${!S?`max-md:justify-center ${T.customSearchTarget2.trim()?"max-md:min-w-16 max-md:px-2":"max-md:w-10 max-md:h-10 max-md:px-0"}`:""}
                  ${T.enableCustomSearch2?"bg-secondary text-secondary-foreground hover:bg-secondary-hover":"bg-muted text-muted-foreground hover:bg-muted-hover"}
                  ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                `,children:[T.enableCustomSearch2&&(0,t.jsx)(q.Check,{className:"h-3 w-3"}),(0,t.jsx)(C.Target,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:`text-sm font-medium ${!S?"max-md:hidden":""}`,children:T.customSearchTarget2}),(0,t.jsx)("span",{onClick:e=>{e.stopPropagation(),D()},className:"ml-1 text-muted-foreground/60 hover:text-muted-foreground cursor-pointer",role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),e.stopPropagation(),D())},children:(0,t.jsx)(Q.Edit2,{className:"h-3 w-3"})})]})}),(0,t.jsx)(_.TooltipContent,{children:(0,t.jsxs)("p",{children:["Boost scores for ",T.customSearchTarget2," roles"]})})]})})]})});var z=e.i(7486),U=e.i(63488),K=e.i(64659),H=e.i(39172),J=e.i(83086),V=e.i(84589);let W=[{type:"companies",label:"Only Companies",icons:[(0,t.jsx)(z.Building2,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"},"company")],estimatedTime:"7 seconds",creditCost:10},{type:"contacts",label:"+ Contacts",icons:[(0,t.jsx)(z.Building2,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"},"company"),(0,t.jsx)(v.Users,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"},"contacts")],estimatedTime:"12 seconds",creditCost:70},{type:"emails",label:"+ Emails",icons:[(0,t.jsx)(z.Building2,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"},"company"),(0,t.jsx)(v.Users,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"},"contacts"),(0,t.jsx)(U.Mail,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"},"emails")],estimatedTime:"22 seconds",creditCost:160},{type:"individual_search",label:"Find Individual",icons:[(0,t.jsx)(H.UserSearch,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"},"individual-search")],estimatedTime:"18 seconds",creditCost:100},{type:"super_search_fast",label:"Super Search (Fast)",icons:[(0,t.jsx)(J.Sparkles,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"},"super-search-fast")],estimatedTime:"30 seconds",creditCost:250},{type:"super_search_deep",label:"Super Search (Deep)",icons:[(0,t.jsx)(J.Sparkles,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"},"super-search-deep")],estimatedTime:"90 seconds",creditCost:250},{type:"super_search_query_first",label:"Super Search (Query-First)",icons:[(0,t.jsx)(J.Sparkles,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"},"super-search-query-first")],estimatedTime:"60 seconds",creditCost:250}],G=function({selectedType:e,onTypeChange:a,disabled:r=!1}){let[o,n]=(0,s.useState)(!1),l=W.find(t=>t.type===e)||W[2];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{"data-testid":"search-options-button",className:`flex items-center gap-1 px-2 py-1 cursor-pointer hover:bg-muted-hover rounded transition-colors ${r?"opacity-50 cursor-not-allowed":""}`,onClick:()=>!r&&n(!0),children:[l.icons.map((e,s)=>(0,t.jsx)("div",{className:"text-muted-foreground",children:e},s)),(0,t.jsx)(K.ChevronDown,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px] text-muted-foreground"})]}),(0,t.jsx)(V.Dialog,{open:o,onOpenChange:n,children:(0,t.jsxs)(V.DialogContent,{className:"sm:max-w-md rounded-2xl",children:[(0,t.jsx)(V.DialogHeader,{children:(0,t.jsx)(V.DialogTitle,{children:"Select Your Search Type"})}),(0,t.jsx)("div",{className:"space-y-3",children:W.map(s=>(0,t.jsxs)("div",{"data-testid":`search-type-option-${s.type}`,className:`flex items-center justify-between py-2 px-3 rounded-lg border cursor-pointer transition-all ${e===s.type?"border-accent/30 bg-accent-hover hover:bg-accent-active":"border-border bg-muted hover:bg-muted-hover"}`,onClick:()=>{a(s.type),n(!1)},children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"flex items-center gap-1",children:s.icons.map((a,r)=>(0,t.jsx)("div",{className:`${e===s.type?"text-accent":"text-muted-foreground"}`,children:a},r))}),(0,t.jsx)("span",{className:`text-base font-medium ${e===s.type?"text-accent":"text-foreground"}`,children:s.label})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("span",{className:"text-xs text-muted-foreground font-mono",children:["~",s.estimatedTime]}),(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground/70",children:[s.creditCost," credits"]})]})]},s.type))})]})})]})};var X=e.i(53145),Y=e.i(94814),Z=e.i(50270),ee=e.i(8402);let et=Z.z.object({fullName:Z.z.string().min(2,"Full name is required (at least 2 characters)"),location:Z.z.string().optional(),role:Z.z.string().optional(),company:Z.z.string().optional(),otherContext:Z.z.string().optional(),knownEmail:Z.z.string().email("Please enter a valid email").optional().or(Z.z.literal(""))}),es=function({isOpen:e,onClose:s,onSearch:a,isSearching:r=!1}){let o=(0,X.useForm)({resolver:(0,Y.zodResolver)(et),defaultValues:{fullName:"",location:"",role:"",company:"",otherContext:"",knownEmail:""}}),l=()=>{r||(o.reset(),s())};return(0,t.jsx)(V.Dialog,{open:e,onOpenChange:l,children:(0,t.jsxs)(V.DialogContent,{className:"sm:max-w-lg",children:[(0,t.jsx)(V.DialogHeader,{children:(0,t.jsxs)(V.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(H.UserSearch,{className:"h-5 w-5 text-blue-600"}),"Find Individual"]})}),(0,t.jsx)(ee.Form,{...o,children:(0,t.jsxs)("form",{onSubmit:o.handleSubmit(e=>{a(e)}),className:"space-y-4",children:[(0,t.jsx)(ee.FormField,{control:o.control,name:"fullName",render:({field:e})=>(0,t.jsxs)(ee.FormItem,{children:[(0,t.jsxs)(ee.FormLabel,{className:"flex items-center gap-1",children:["Full Name ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(ee.FormControl,{children:(0,t.jsx)(O.Input,{placeholder:"Jonathan Novotny","data-testid":"input-full-name",...e})}),(0,t.jsx)(ee.FormMessage,{})]})}),(0,t.jsx)(ee.FormField,{control:o.control,name:"location",render:({field:e})=>(0,t.jsxs)(ee.FormItem,{children:[(0,t.jsx)(ee.FormLabel,{className:"text-gray-600",children:"Location (city, state, or country)"}),(0,t.jsx)(ee.FormControl,{children:(0,t.jsx)(O.Input,{placeholder:"New York, USA","data-testid":"input-location",...e})}),(0,t.jsx)(ee.FormMessage,{})]})}),(0,t.jsx)(ee.FormField,{control:o.control,name:"role",render:({field:e})=>(0,t.jsxs)(ee.FormItem,{children:[(0,t.jsx)(ee.FormLabel,{className:"text-gray-600",children:"Role or Title"}),(0,t.jsx)(ee.FormControl,{children:(0,t.jsx)(O.Input,{placeholder:"VP of Engineering","data-testid":"input-role",...e})}),(0,t.jsx)(ee.FormMessage,{})]})}),(0,t.jsx)(ee.FormField,{control:o.control,name:"company",render:({field:e})=>(0,t.jsxs)(ee.FormItem,{children:[(0,t.jsx)(ee.FormLabel,{className:"text-gray-600",children:"Company"}),(0,t.jsx)(ee.FormControl,{children:(0,t.jsx)(O.Input,{placeholder:"Acme Corp","data-testid":"input-company",...e})}),(0,t.jsx)(ee.FormMessage,{})]})}),(0,t.jsx)(ee.FormField,{control:o.control,name:"otherContext",render:({field:e})=>(0,t.jsxs)(ee.FormItem,{children:[(0,t.jsx)(ee.FormLabel,{className:"text-gray-600",children:"Other Context"}),(0,t.jsx)(ee.FormControl,{children:(0,t.jsx)(O.Input,{placeholder:"Previously worked at Google","data-testid":"input-other-context",...e})}),(0,t.jsx)(ee.FormMessage,{})]})}),(0,t.jsx)(ee.FormField,{control:o.control,name:"knownEmail",render:({field:e})=>(0,t.jsxs)(ee.FormItem,{children:[(0,t.jsx)(ee.FormLabel,{className:"text-gray-600",children:"Known Email (helps verify identity)"}),(0,t.jsx)(ee.FormControl,{children:(0,t.jsx)(O.Input,{type:"email",placeholder:"jnovotny@oldcompany.com","data-testid":"input-known-email",...e})}),(0,t.jsx)(ee.FormMessage,{})]})}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,t.jsx)(n.Button,{type:"button",variant:"outline",onClick:l,disabled:r,"data-testid":"button-cancel",children:"Cancel"}),(0,t.jsx)(n.Button,{type:"submit",disabled:r,className:"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600","data-testid":"button-search",children:r?"Searching...":"Search"})]})]})})]})})};function ea({onAnalyze:e,onComplete:o,onSearchResults:l,onCompaniesReceived:i,isAnalyzing:c,value:d,onChange:u,isFromLandingPage:m=!1,onDismissLandingHint:h,lastExecutedQuery:E=null,onSearchSuccess:$,hasSearchResults:O=!1,onSessionIdChange:q,hideRoleButtons:L=!1,onSearchMetricsUpdate:M,onOpenSearchDrawer:A,onProgressUpdate:Q,onCacheHit:z,superSearch:U,onSuperSearchActive:K}){let H,{toast:J}=(0,f.useToast)(),V=(0,r.useQueryClient)(),{fireCelebrateConfetti:W}=(0,T.useConfetti)(),[X,Y]=(0,s.useState)({phase:"",completed:0,total:5}),[Z,ee]=(0,s.useState)(!1),[et,ea]=(0,s.useState)({query:"",totalCompanies:0,totalContacts:0,totalEmails:0,searchDuration:0,startTime:0,companies:[]}),{user:er}=(0,F.useAuth)(),{openForProtectedRoute:eo}=(0,D.useRegistrationModal)(),[en,el]=(0,s.useState)(!1),[ei,ec]=(0,s.useState)(()=>{let e=localStorage.getItem("contactSearchConfig");if(e)try{return JSON.parse(e)}catch(e){console.error("Error loading saved contact search config:",e)}return{enableCoreLeadership:!0,enableDepartmentHeads:!1,enableMiddleManagement:!1,enableCustomSearch:!1,customSearchTarget:"",enableCustomSearch2:!1,customSearchTarget2:""}}),[ed,eu]=(0,s.useState)(!1),em=(0,s.useRef)(null),[eh,ep]=(0,s.useState)(()=>localStorage.getItem("searchType")||"contacts"),[eg,ef]=(0,s.useState)(!1),[ex,eS]=(0,s.useState)(!1);U?.status==="streaming"||U?.status==="connecting"||U?.status,(0,s.useEffect)(()=>{let e=localStorage.getItem("searchType"),t=!localStorage.getItem("hasEverBeenRegistered");er&&t?(localStorage.setItem("hasEverBeenRegistered","true"),ep("emails")):e||ep(er?"emails":"contacts")},[er]),(0,s.useEffect)(()=>{localStorage.setItem("searchType",eh)},[eh]);let[ey,eb]=(0,s.useState)(null),[ev,eC]=(0,s.useState)(!1),[ew,ej]=(0,s.useState)(!1),eT=(0,s.useRef)(null),eN=(0,s.useRef)(!1),ek=(0,s.useRef)(null),eE=(0,s.useRef)(null),eI=(0,s.useRef)(!1),eR=(0,s.useRef)(l),e$=(0,s.useRef)(i),eF=(0,s.useRef)($),eD=(0,s.useRef)(J);(0,s.useEffect)(()=>{eR.current=l,e$.current=i,eF.current=$,eD.current=J});let eP=async e=>{try{let t=I();if(!t)return;let s=t.currentResults;if(!s||0===s.length)return;console.log("[Email Refresh] Starting database sync for",s.length,"companies"),console.log("[Email Refresh] Invalidating React Query cache..."),s.forEach(e=>{V.invalidateQueries({queryKey:[`/api/companies/${e.id}/contacts`]})}),await new Promise(e=>setTimeout(e,50)),console.log("[Email Refresh] Fetching fresh contact data from database...");let a=await Promise.all(s.map(async e=>{try{let t=await fetch(`/api/companies/${e.id}/contacts`);if(!t.ok)return console.error(`Failed to refresh contacts for company ${e.id}:`,t.status),e;{let s=await t.json();return{...e,contacts:s}}}catch(t){return console.error(`Failed to refresh contacts for company ${e.id}:`,t),e}}));R({currentQuery:e.query,currentResults:a,currentListId:null,lastExecutedQuery:e.query}),eR.current(e.query,a),console.log("[Email Refresh] Database sync completed - all emails reflected"),eD.current({title:"Email Search Complete",description:"Contact data updated with fresh email discoveries"})}catch(e){console.error("[Email Refresh] Database sync failed:",e)}};(0,s.useEffect)(()=>{if(!ey||!ev||eN.current)return;eN.current=!0;let e=async()=>{if(eN.current)try{let e=await fetch(`/api/search-sessions/${ey}/status`);if(e.ok){let t=e.headers.get("content-type");if(!t||!t.includes("application/json"))return void console.warn("Session polling response is not JSON, skipping...");let s=await e.json();if(!s.success||!s.session)return void console.warn("Invalid session response structure:",s);let a=s.session;if("completed"===a.emailSearchStatus&&a.emailSearchCompleted){console.log("Email search completed, refreshing contact data");let e=localStorage.getItem("lastCacheUpdate")?parseInt(localStorage.getItem("lastCacheUpdate")||"0"):0;a.emailSearchCompleted>e&&(console.log("Email search newer than cache, refreshing data"),eP(a),localStorage.setItem("lastCacheUpdate",a.emailSearchCompleted.toString()))}"contacts_complete"===a.status&&a.fullResults?(console.log("Session completed, restoring results:",a),eN.current=!1,eC(!1),eT.current&&(clearInterval(eT.current),eT.current=null),N.cleanupSession(a.id),eR.current(a.query,a.fullResults),eF.current?.(),eD.current({title:"Search completed!",description:`Found results for "${a.query}"`})):"failed"===a.status&&(console.log("Session failed:",a),eN.current=!1,eC(!1),eT.current&&(clearInterval(eT.current),eT.current=null),N.cleanupSession(a.id),eD.current({title:"Search failed",description:a.error||"An error occurred during search",variant:"destructive"}))}}catch(e){console.error("Error polling session:",e),eN.current&&(eN.current=!1,eC(!1),eT.current&&(clearInterval(eT.current),eT.current=null))}};return eT.current=setInterval(e,3e3),()=>{eN.current=!1,eT.current&&(clearInterval(eT.current),eT.current=null)}},[ey,ev]),(0,s.useEffect)(()=>()=>{eT.current&&clearInterval(eT.current),ek.current&&clearTimeout(ek.current),em.current&&clearTimeout(em.current),eN.current=!1},[]),(0,s.useEffect)(()=>{(console.log("[SESSION-RESTORE] Effect triggered",{hasRestoredSession:ew,currentSessionId:ey,isPolling:ev}),ew)?console.log("[SESSION-RESTORE] Skipping - already restored"):(async()=>{console.log("[SESSION-RESTORE] handleSessionRestore starting");let e=N.getActiveSessions(),t=N.getMostRecentCompleteSession();if(e.length>0){if(e.length>1){console.log(`[Session Conflict] Found ${e.length} active sessions, cleaning up older ones...`);let t=e[0],s=e.slice(1);for(let e of s)await N.terminateSession(e.id);console.log(`[Session Conflict] Terminated ${s.length} older sessions, keeping ${t.id}`)}let t=e[0];console.log("Resuming active session:",t),console.log("[SESSION-RESTORE] Resuming session, setting isPolling=true"),eb(t.id),eC(!0),ej(!0),q?.(t.id),t.quickResults&&t.quickResults.length>0&&(e$.current(t.query,t.quickResults),u(t.query)),eD.current({title:"Search in progress",description:`Continuing search for "${t.query}"`})}else if(t){let e=!!t.fullResults&&!!Array.isArray(t.fullResults)&&t.fullResults.some(e=>e.contacts&&Array.isArray(e.contacts)&&e.contacts.length>0);console.log("Restoring recent complete session:",t),console.log("Session has complete contact data:",e),u(t.query),t.fullResults&&e?(console.log("Using complete session data with contacts"),eR.current(t.query,t.fullResults),ej(!0)):console.log("Session has incomplete data - allowing localStorage fallback")}})()},[ew]);let eO=(0,s.useCallback)(()=>{let e=!ed;eu(e),em.current&&(clearTimeout(em.current),em.current=null),e&&(em.current=setTimeout(()=>{eu(!1),em.current=null},6e3))},[ed]),eq=(0,s.useCallback)(e=>{console.log("PromptEditor received config update:",e),ec(e),em.current&&(clearTimeout(em.current),em.current=null),em.current=setTimeout(()=>{eu(!1),em.current=null},600)},[]);(0,s.useEffect)(()=>{null!==E&&d!==E&&el(!0)},[d,E]);let[eL,eM]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(m){eM(!0);let e=setTimeout(()=>{eM(!1)},3e3);return()=>clearTimeout(e)}},[m]);let eA=(0,a.useMutation)({mutationFn:async e=>{console.log("Initiating company search process..."),console.log("Sending request to company discovery API..."),console.log("[Session Management] Cleaning up active sessions before starting new search..."),await N.cleanupActiveSessions();let t=N.createSession(e,void 0,ei).id;return eb(t),ej(!0),console.log(`Created session ${t} for query: ${e}`),console.log("Quick search initiated"),(await (0,g.apiRequest)("POST","/api/companies/quick-search",{query:e,strategyId:void 0,contactSearchConfig:ei,sessionId:t,searchType:eh})).json()},onSuccess:e=>{if(console.log(`Job created with ID: ${e.jobId}`),eE.current=e.jobId,eI.current){console.log("Cache hit already occurred, terminating new job"),(0,g.apiRequest)("POST",`/api/search-jobs/${e.jobId}/terminate`).catch(()=>{}),eN.current=!1,eC(!1);return}el(!1),ey&&(N.updateSessionWithJob(ey,e.jobId),eC(!0),console.log(`Started polling for job ${e.jobId} completion`));let t=async()=>{if(eN.current)try{let s=await (0,g.apiRequest)("GET",`/api/search-jobs/${e.jobId}`);if(s.ok){let a=await s.json();if(("processing"===a.status||"completed"===a.status)&&a.results){let e=a.results?.companies||[],t=e.reduce((e,t)=>e+(t.contacts?.length||0),0);e.length>0&&(ey&&("companies"===eh?(N.updateWithQuickResults(ey,e),i(d,e)):(N.updateWithFullResults(ey,e),l(d,e))),console.log(`Progressive update: ${e.length} companies, ${t} contacts`))}if("completed"===a.status){console.log(`Job ${e.jobId} completed`),console.log("[POLLING] Job completed - setting isPolling=false, isPollingRef=false"),eN.current=!1,eC(!1);let t=a.results?.companies||[],s=t.reduce((e,t)=>e+(t.contacts?.length||0),0);if(console.log(`Final results: ${t.length} companies with ${s} contacts`),ey&&"companies"===eh&&N.markQuickResultsComplete(ey),"companies"===eh)J({title:"Search Complete",description:`Found ${t.length} companies.`}),Y(e=>({...e,phase:"Search Complete",completed:5,total:5}));else{let e=Math.round((Date.now()-et.startTime)/1e3),r=t.reduce((e,t)=>t.contacts?e+t.contacts.filter(e=>e.email&&e.email.length>5).length:e,0),o={...et,totalCompanies:t.length,totalContacts:s,totalEmails:r,searchDuration:e,companies:t,searchType:eh,sourceBreakdown:a.results?.sourceBreakdown};ea(o),M&&setTimeout(()=>{M(o,!0),setTimeout(()=>{M(o,!1)},15e3)},1e3),W()}er&&V.invalidateQueries({queryKey:["/api/credits"]}),console.log("[SESSION] Clearing currentSessionId on job completion"),eb(null),o()}else if("failed"===a.status){console.error(`Job ${e.jobId} failed:`,a.error),eN.current=!1,eC(!1),Y(e=>({...e,phase:"",completed:0,total:5}));let t=a.error||"An error occurred during search";if(t.toLowerCase().includes("insufficient credits"))(0,P.triggerInsufficientCreditsGlobally)();else try{J({title:"Search Failed",description:t,variant:"destructive"})}catch(e){console.error("Failed to show toast:",e)}er&&V.invalidateQueries({queryKey:["/api/credits"]}),eb(null),o()}else{let s=a.progress?.phase||"",r=s.toLowerCase().includes("error")||s.toLowerCase().includes("insufficient"),n=a.progress?.message||a.error||"";r?(console.error(`Job ${e.jobId} has error phase:`,s,n),eN.current=!1,eC(!1),Y(e=>({...e,phase:"",completed:0,total:5})),s.toLowerCase().includes("insufficient")||n.toLowerCase().includes("insufficient credits")?(0,P.triggerInsufficientCreditsGlobally)():J({title:"Search Failed",description:n||"An error occurred during search",variant:"destructive"}),er&&V.invalidateQueries({queryKey:["/api/credits"]}),eb(null),o()):(a.progress&&Y(e=>({...e,phase:s||"Processing",completed:a.progress.completed||0,total:a.progress.total||5})),setTimeout(t,500))}}}catch(e){console.error("Polling error:",e),eN.current&&setTimeout(t,1e3)}};eN.current=!0,eC(!0),t()},onError:e=>{Y(e=>({...e,phase:"",completed:0,total:5}));let t=e.message||"Search failed";if(t.includes("402:")||t.toLowerCase().includes("insufficient credits"))(0,P.triggerInsufficientCreditsGlobally)();else try{J({title:"Search Failed",description:t,variant:"destructive"})}catch(e){console.error("Failed to show toast:",e)}er&&V.invalidateQueries({queryKey:["/api/credits"]}),o()}}),eQ=(0,a.useMutation)({mutationFn:async e=>{console.log("Initiating structured individual search..."),await N.cleanupActiveSessions();let t=[e.fullName,e.role,e.company?`at ${e.company}`:null,e.location?`in ${e.location}`:null].filter(Boolean).join(" "),s=N.createSession(t).id;return eb(s),(await (0,g.apiRequest)("POST","/api/companies/quick-search",{query:t,searchType:"individual_search",sessionId:s,structuredSearch:{fullName:e.fullName,location:e.location||void 0,role:e.role||void 0,company:e.company||void 0,otherContext:e.otherContext||void 0,knownEmail:e.knownEmail||void 0}})).json()},onSuccess:e=>{console.log(`Individual search job created with ID: ${e.jobId}`),ef(!1),el(!1),ey&&(N.updateSessionWithJob(ey,e.jobId),eC(!0));let t=async()=>{if(eN.current)try{let s=await (0,g.apiRequest)("GET",`/api/search-jobs/${e.jobId}`);if(s.ok){let a=await s.json();if(("processing"===a.status||"completed"===a.status)&&a.results){let e=a.results?.companies||[],t=e.reduce((e,t)=>e+(t.contacts?.length||0),0);e.length>0&&(ey&&(N.updateWithFullResults(ey,e),l(d,e)),console.log(`Individual search update: ${e.length} companies, ${t} contacts`))}if("completed"===a.status){console.log(`Individual search job ${e.jobId} completed`),eN.current=!1,eC(!1),eS(!1),eb(null);let t=(a.results?.companies||[]).reduce((e,t)=>e+(t.contacts?.length||0),0);o(),$?.(),V.invalidateQueries({queryKey:["/api/credits"]}),J({title:"Individual Search Complete",description:`Found ${t} candidate(s)`})}else if("failed"===a.status){eN.current=!1,eC(!1),eS(!1),eb(null),Y(e=>({...e,phase:"",completed:0,total:5}));let e=a.error||"Individual search failed",t=e.toLowerCase().includes("insufficient credits");try{J({title:t?"Insufficient Credits":"Search Failed",description:e,variant:"destructive"})}catch(e){console.error("Failed to show toast:",e)}V.invalidateQueries({queryKey:["/api/credits"]}),o()}else{let s=a.progress?.phase||"",r=s.toLowerCase().includes("error")||s.toLowerCase().includes("insufficient"),n=a.progress?.message||a.error||"";if(r){console.error(`Individual search job ${e.jobId} has error phase:`,s,n),eN.current=!1,eC(!1),eS(!1),eb(null),Y(e=>({...e,phase:"",completed:0,total:5}));let t=s.toLowerCase().includes("insufficient")||n.toLowerCase().includes("insufficient credits");J({title:t?"Insufficient Credits":"Search Failed",description:t?"You don't have enough credits for this search. Please add more credits to continue.":n||"An error occurred during search",variant:"destructive"}),V.invalidateQueries({queryKey:["/api/credits"]}),o()}else setTimeout(t,500)}}}catch(e){console.error("Individual search polling error:",e),eN.current&&setTimeout(t,1e3)}};eN.current=!0,eC(!0),t()},onError:e=>{eS(!1),Y(e=>({...e,phase:"",completed:0,total:5}));let t=e.message||"Search failed";if(t.includes("402:")||t.toLowerCase().includes("insufficient credits"))(0,P.triggerInsufficientCreditsGlobally)();else try{J({title:"Search Failed",description:t,variant:"destructive"})}catch(e){console.error("Failed to show toast:",e)}V.invalidateQueries({queryKey:["/api/credits"]}),o()}});(0,s.useEffect)(()=>{if(Q){let e=eA.isPending||ev||eQ.isPending;Q({phase:X.phase,completed:X.completed,total:X.total,isVisible:e})}},[X.phase,X.completed,X.total,eA.isPending,ev,eQ.isPending,Q]);let e_=async()=>{if(!d.trim())return void J({title:"Empty Query",description:"Please enter a search query.",variant:"destructive"});let t=d.trim().toLowerCase();if("5ducks"===t||"free palestine"===t||"he is risen"===t)try{let e=await (0,g.apiRequest)("POST","/api/credits/easter-egg",{query:d.trim()}),t=await e.json();J({title:`${t.easterEgg.emoji} Easter Egg Found!`,description:`${t.easterEgg.description} - +${t.easterEgg.reward} credits added!`}),V.invalidateQueries({queryKey:["/api/credits"]}),o();return}catch(t){let e=await t.response?.json();J({title:"Easter Egg",description:e?.message||"Already claimed!",variant:"destructive"}),o();return}m&&h&&h(),Y({phase:"Starting search",completed:0,total:5}),ea({query:d,totalCompanies:0,totalContacts:0,totalEmails:0,searchDuration:0,startTime:Date.now(),companies:[]}),window.dataLayer?.push({event:"search_performed"}),(0,k.logConversionEvent)("search_performed").catch(()=>{}),console.log("Analyzing search query...");let s="super_search_fast"===eh||"super_search_deep"===eh||"super_search_query_first"===eh;if(console.log(`Preparing to search for ${"companies"===eh?"companies only":"contacts"===eh?"companies and contacts":"individual_search"===eh?"specific individual":s?"AI-powered super search":"companies, contacts, and emails"}...`),e(),s){let e="super_search_fast"===eh?"v1_perplexity_one-shot":"super_search_deep"===eh?"v2_anthropic_multi-step":"v3_anthropic_query-first";U&&K&&(K(!0),U.startSearch(d,void 0,e));return}eA.mutate(d),er||setTimeout(()=>{eo()},35e3),eI.current=!1;let a="true"===sessionStorage.getItem("forceBypassCache");a&&(sessionStorage.removeItem("forceBypassCache"),console.log("ðŸ”„ Bypass cache flag detected - skipping cache check for fresh results")),(async()=>{if(a)return console.log("ðŸ”„ Cache bypass active - fetching fresh results");try{let e=await fetch(`/api/lists/by-prompt?prompt=${encodeURIComponent(d)}`),t=await e.json();if(t&&t.listId&&!eI.current){if(console.log(`ðŸŽ¯ Cache hit! Found cached search (listId: ${t.listId})`),eI.current=!0,eE.current)try{await (0,g.apiRequest)("POST",`/api/search-jobs/${eE.current}/terminate`),console.log(`Terminated job ${eE.current} due to cache hit`)}catch(e){console.log("Job termination skipped (may have already completed)")}eN.current=!1,eC(!1),eb(null),z&&z(t),J({title:"Loaded cached results",description:`Found ${t.resultCount} companies from a previous search.`})}}catch(e){console.log("Cache check failed, continuing with fresh search")}})()},eB=(0,s.useRef)(()=>{});(0,s.useEffect)(()=>{eB.current=e_}),(0,s.useEffect)(()=>{let e=()=>{console.log("ðŸ”„ Fresh search triggered via event"),eB.current()};return window.addEventListener("triggerFreshSearch",e),()=>{window.removeEventListener("triggerFreshSearch",e)}},[]);let ez=async()=>{if(console.log("User requested search stop"),eN.current=!1,eC(!1),eE.current)try{await (0,g.apiRequest)("POST",`/api/search-jobs/${eE.current}/terminate`),console.log(`Terminated job ${eE.current}`),J({title:"Search stopped",description:"The search has been cancelled."})}catch(e){console.log("Job termination failed")}eE.current=null,eb(null),o()};return(0,t.jsxs)("div",{className:"pl-0 pr-1 pt-1 pb-1 shadow-none",children:[" ",(0,t.jsxs)("div",{className:"flex flex-col gap-0 md:gap-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(p.Textarea,{value:d,onChange:e=>{u(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||c||eA.isPending||(e.preventDefault(),e_())},placeholder:"Recently exited startups in Miami ",rows:2,className:`md:rounded-md rounded-md resize-none pb-12 text-base md:text-lg text-foreground placeholder:text-muted-foreground/50 hover:border-border md:focus-visible:border-border ${m?"racing-light-effect":""} ${eL?"gradient-text-input":""}`,"data-testid":"search-input"}),(0,t.jsxs)("div",{className:"absolute bottom-2 left-2 right-2 flex items-end justify-between pointer-events-none",children:[(0,t.jsxs)("div",{className:"pointer-events-auto flex items-center gap-2",children:[(0,t.jsx)(G,{selectedType:eh,onTypeChange:e=>{"individual_search"===e&&ef(!0),ep(e)},disabled:c||eA.isPending||eQ.isPending}),(()=>{if(ei.enableCoreLeadership)return(0,t.jsxs)("button",{onClick:eO,className:"flex items-center gap-1 px-2 py-1 rounded text-muted-foreground text-sm hover:bg-muted-hover transition-colors cursor-pointer",children:[(0,t.jsx)(y.Crown,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"}),(0,t.jsx)("span",{className:"font-medium",children:"Leadership"})]});if(ei.enableDepartmentHeads)return(0,t.jsxs)("button",{onClick:eO,className:"flex items-center gap-1 px-2 py-1 rounded text-muted-foreground text-sm hover:bg-muted-hover transition-colors cursor-pointer",children:[(0,t.jsx)(b.Building,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"}),(0,t.jsx)("span",{className:"font-medium",children:"Marketing"})]});if(ei.enableMiddleManagement)return(0,t.jsxs)("button",{onClick:eO,className:"flex items-center gap-1 px-2 py-1 rounded text-muted-foreground text-sm hover:bg-muted-hover transition-colors cursor-pointer",children:[(0,t.jsx)(v.Users,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"}),(0,t.jsx)("span",{className:"font-medium",children:"CTO"})]});if(ei.enableCustomSearch&&ei.customSearchTarget)return(0,t.jsxs)("button",{onClick:eO,className:"flex items-center gap-1 px-2 py-1 rounded text-muted-foreground text-sm hover:bg-muted-hover transition-colors cursor-pointer",children:[(0,t.jsx)(C.Target,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"}),(0,t.jsx)("span",{className:"font-medium",children:ei.customSearchTarget})]});if(ei.enableCustomSearch2&&ei.customSearchTarget2)return(0,t.jsxs)("button",{onClick:eO,className:"flex items-center gap-1 px-2 py-1 rounded text-muted-foreground text-sm hover:bg-muted-hover transition-colors cursor-pointer",children:[(0,t.jsx)(C.Target,{className:"h-3 w-3 md:h-[14px] md:w-[14px] lg:h-[18px] lg:w-[18px]"}),(0,t.jsx)("span",{className:"font-medium",children:ei.customSearchTarget2})]});return null})(),er?.isAdmin&&(0,t.jsx)(_.TooltipProvider,{children:(0,t.jsxs)(_.Tooltip,{children:[(0,t.jsx)(_.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("button",{onClick:A,className:"flex items-center justify-center p-2 rounded-full text-muted-foreground hover:bg-muted-hover hover:text-foreground transition-colors cursor-pointer","aria-label":"Search Management","data-testid":"button-search-management",children:(0,t.jsx)(w.Settings,{className:"h-4 w-4"})})}),(0,t.jsx)(_.TooltipContent,{children:(0,t.jsx)("p",{children:"Manage Search Queue"})})]})})]}),(0,t.jsx)("div",{className:"pointer-events-auto",children:(H=c||eA.isPending||ev,console.log("[STATE] isSearchActive:",{isAnalyzing:c,isPending:eA.isPending,isPolling:ev,result:H}),(0,t.jsx)(n.Button,{type:H?"button":"submit",onClick:H?ez:e_,disabled:!H&&(c||eA.isPending),className:`
                      rounded-md group
                      transition-all duration-300 flex items-center gap-2
                      ${!d?.trim()||E&&!en&&!H?"bg-secondary hover:bg-secondary-hover shadow-md hover:shadow-lg text-muted-foreground":"bg-gradient-to-r from-accent-light to-accent hover:from-accent hover:to-accent-dark text-white shadow-md hover:shadow-lg"}
                    `,"aria-label":H?"Stop Search":"Search","data-testid":H?"stop-search-button":"search-button",children:H?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.Loader2,{className:"h-4 w-4 animate-spin hidden md:block md:group-hover:hidden"}),(0,t.jsx)("span",{className:"hidden md:block md:group-hover:hidden",children:"Searching"}),(0,t.jsx)(j.Square,{className:"h-4 w-4 block md:hidden md:group-hover:block"}),(0,t.jsx)("span",{className:"block md:hidden md:group-hover:block",children:"Stop"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.Search,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Search"})]})}))})]})]}),!L&&ed&&(0,t.jsx)("div",{className:"md:hidden",children:(0,t.jsx)(B,{config:ei,onConfigChange:eq,disabled:c||eA.isPending,isSearching:eA.isPending,hasSearchResults:O,inputHasChanged:O&&d!==E})}),!L&&ed&&(0,t.jsx)("div",{className:"hidden md:block",children:(0,t.jsx)(B,{config:ei,onConfigChange:eq,disabled:c||eA.isPending,isSearching:eA.isPending,hasSearchResults:O,inputHasChanged:O&&d!==E})})]}),(0,t.jsx)(es,{isOpen:eg,onClose:()=>ef(!1),onSearch:t=>{eS(!0),e();let s=[t.fullName,t.role,t.company?`at ${t.company}`:null,t.location?`in ${t.location}`:null].filter(Boolean).join(" ");u(s),Y({phase:"Starting search",completed:0,total:5}),ea({query:s,totalCompanies:0,totalContacts:0,totalEmails:0,searchDuration:0,startTime:Date.now(),companies:[]}),eQ.mutate(t)},isSearching:ex})]})}e.i(17484);var er=e.i(37931);e.i(20730);var eo=e.i(71400),en=e.i(93823);let el=[{id:0,type:"welcome",trigger:"registration_complete",title:"Congrats Hatchling Level Unlocked!",description:"You have unlocked **Email Search**.\n\nRun a NEW search now to see complete results including emails of ~2 Key Contacts per company.",badge:"Hatchling",emoji:"ðŸ¦†",buttonText:"Chirp"}],ei="5ducks_shown_badges";function ec(){try{let e=localStorage.getItem(ei);return e?JSON.parse(e):[]}catch{return[]}}var ed=e.i(38785);function eu({notificationState:e,onClose:s}){let a;if(!e||!e.isOpen||!e.notification&&!e.badge)return null;let r=e.badge||e.notification;return(0,t.jsx)(V.Dialog,{open:e.isOpen,onOpenChange:s,children:(0,t.jsxs)(V.DialogContent,{className:"sm:max-w-md rounded-lg border-2 shadow-xl border-blue-200 bg-white",children:[(0,t.jsxs)(V.DialogHeader,{className:"text-center space-y-4",children:[r.badge&&(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsxs)(ed.Badge,{variant:"outline",className:"rounded-full px-4 py-2 text-sm font-medium border-2 bg-blue-100 text-blue-800 border-blue-200",children:[r.emoji&&(0,t.jsx)("span",{className:"mr-2",children:r.emoji}),r.badge]})}),(0,t.jsx)(V.DialogTitle,{className:"text-xl font-bold text-gray-900 leading-tight",children:r.title}),(0,t.jsx)(V.DialogDescription,{className:"text-gray-700 leading-relaxed text-base",children:(a=r.description).split("\n").map((e,s)=>(0,t.jsxs)("span",{children:[e.split("**").map((e,s)=>s%2==1?(0,t.jsx)("strong",{children:e},s):e),s<a.split("\n").length-1&&(0,t.jsx)("br",{})]},s))})]}),(0,t.jsx)(V.DialogFooter,{className:"mt-6",children:(0,t.jsx)(n.Button,{onClick:s,className:"w-full rounded-md bg-gray-900 text-white hover:bg-gray-800 transition-colors font-medium",children:r.buttonText||"OK"})})]})})}var em=e.i(55900),eh=e.i(16715);let ep={dancing1:"animate-disco-bounce",dancing2:"animate-salsa-spin",dancing3:"animate-breakdance"};function eg(){let[e,a]=(0,s.useState)("egg"),[r,o]=(0,s.useState)(1);(0,s.useEffect)(()=>{let e=setTimeout(()=>{a("hatching")},7e3),t=setTimeout(()=>{a("chick")},1e4),s=setTimeout(()=>{a("settled")},15e3);return()=>{clearTimeout(e),clearTimeout(t),clearTimeout(s)}},[]),(0,s.useEffect)(()=>{if("settled"===e){let e=setInterval(()=>{a(`dancing${r}`),setTimeout(()=>{a("settled"),o(e=>e%3+1)},5e3)},18e4);return()=>clearInterval(e)}},[e,r]);let n="egg"===e?"animate-egg-shake":"hatching"===e?"animate-hatching-wobble":"chick"===e?"animate-chick-bounce":e.startsWith("dancing")?ep[e]:"";return(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("span",{className:`text-4xl transform transition-transform duration-300 ${n}`,children:"egg"===e?"ðŸ¥š":"hatching"===e?"ðŸ£":"ðŸ¥"})})}e.i(93806);var ef=e.i(21261);let ex=(0,s.lazy)(()=>e.A(85275)),eS=(0,s.lazy)(()=>e.A(93657).then(e=>({default:e.SuperSearchResults}))),ey=(0,s.lazy)(()=>e.A(14179).then(e=>({default:e.EmailDrawer}))),eb=(0,s.lazy)(()=>e.A(53655).then(e=>({default:e.SearchManagementDrawer}))),ev=(0,s.lazy)(()=>e.A(91506).then(e=>({default:e.SearchReportModal}))),eC=(0,s.lazy)(()=>e.A(19143).then(e=>({default:e.OnboardingFlowOrchestrator}))),ew=(0,s.lazy)(()=>e.A(62596).then(e=>({default:e.FeedbackModal}))),ej=(0,s.lazy)(()=>e.A(21601).then(e=>({default:e.TopProspectsCard}))),eT=(0,s.lazy)(()=>e.A(92676).then(e=>({default:e.SelectionToolbar})));function eN({isNewSearch:e=!1}){let d,p,x,y,b,v,C,w,[j,T]=(0,s.useState)(!1),[E,P]=(0,s.useState)(""),[O,q]=(0,s.useState)(null),[L,M]=(0,s.useState)(!1),[A,Q]=(0,s.useState)(null),B=e=>{console.log("ðŸŸ¢ LIST ID CHANGED:",{from:A,to:e,timestamp:new Date().toISOString(),stackTrace:Error().stack?.split("\n").slice(2,5).join("\n")}),Q(e)},[z,U]=(0,s.useState)("scroll"),[H,J]=(0,s.useState)(new Set),[V,W]=(0,s.useState)(new Set),[G,X]=(0,s.useState)(!1),[Y,Z]=(0,s.useState)(!1),[ee,et]=(0,s.useState)(!1),[es,ed]=(0,s.useState)(null),[ep,eN]=(0,s.useState)(!1),[ek,eE]=(0,s.useState)(null),[eI,eR]=(0,s.useState)({isCached:!1,cachedDate:null,query:null}),e$=(0,er.useEmailDrawer)({onClose:()=>{eP(!1)}}),eF=(0,eo.useSearchManagementDrawer)(),[eD,eP]=(0,s.useState)(()=>{if(localStorage.getItem("pendingSearchQuery"))return!1;if(window.location.pathname.match(/^\/search\/[^/]+\/\d+/))return!0;let e=I();return!!e?.currentResults&&!!(e.currentResults.length>0)}),[eO,eq]=(0,s.useState)({phase:"",completed:0,total:5,isVisible:!1}),eL=(0,h.useSuperSearch)(),[eM,eA]=(0,s.useState)(!1),[eQ,e_]=(0,s.useState)(!1);(0,s.useEffect)(()=>{sessionStorage.getItem("hasTrackedAppPageView")||((0,k.logConversionEvent)("app_page_view").catch(()=>{}),sessionStorage.setItem("hasTrackedAppPageView","true"))},[]);let[eB,ez]=(0,s.useState)(!1),[eU,eK]=(0,s.useState)(""),[eH,eJ]=(0,s.useState)([]),[eV,eW]=(0,s.useState)({isOpen:!1,contactId:null,contactName:"",feedbackType:"excellent"}),{toast:eG}=(0,f.useToast)(),eX=(0,r.useQueryClient)(),eY=useRouter(),[eZ,e0]=(0,o.useRoute)("/search/:slug/:listId"),e1=(0,D.useRegistrationModal)(),e2=(0,F.useAuth)(),{notificationState:e3,triggerNotification:e4,closeNotification:e5}=function(){let[e,t]=(0,s.useState)({isOpen:!1,badge:null}),a=(0,s.useCallback)(e=>{if(ec().includes(e))return console.log("Badge already shown for trigger:",e),!1;let s=el.find(t=>t.trigger===e);return s?(t({isOpen:!0,badge:s}),!0):(console.log("No badge found for trigger:",e),!1)},[]),r=(0,s.useCallback)(()=>{e.badge&&function(e){try{let t=ec();t.includes(e)||(t.push(e),localStorage.setItem(ei,JSON.stringify(t)))}catch(e){console.error("Failed to save badge state:",e)}}(e.badge.trigger),t({isOpen:!1,badge:null})},[e.badge]);return{notificationState:e,triggerNotification:a,closeNotification:r}}();(0,s.useEffect)(()=>{e$.isOpen&&O&&O.length>0||O&&O.length>0?eP(!0):window.location.pathname.match(/^\/search\/[^/]+\/\d+/)||eP(!1)},[e$.isOpen,O]);let{handleComprehensiveEmailSearch:e6,pendingSearchIds:e8}=(0,ef.useComprehensiveEmailSearch)({onContactUpdate:e=>{q(t=>{if(!t)return null;let s=t.map(t=>({...t,contacts:t.contacts?.map(s=>s.id===e.id?{...e,companyName:t.name,companyId:t.id}:s)}));return R({currentQuery:es||E,currentResults:s,currentListId:A,lastExecutedQuery:es}),s})}}),{loadSearchState:e7,persistSearchState:e9,refreshContactDataFromDatabase:te,refreshAndUpdateResults:tt,isMountedRef:ts,isInitializedRef:ta,hasSessionRestoredDataRef:tr,refreshVersionRef:to}=(d=(0,s.useRef)(!0),p=(0,s.useRef)(!1),x=(0,s.useRef)(!1),y=(0,s.useRef)(0),b=(0,s.useCallback)(()=>I(),[]),v=(0,s.useCallback)((e,t)=>{let s=t.lastExecutedQuery||t.currentQuery;R({currentQuery:s,currentResults:e.currentResults,currentListId:t.currentListId,lastExecutedQuery:t.lastExecutedQuery||s,...void 0!==e.emailSearchCompleted&&{emailSearchCompleted:e.emailSearchCompleted},...void 0!==e.emailSearchTimestamp&&{emailSearchTimestamp:e.emailSearchTimestamp??void 0},...void 0!==e.navigationRefreshTimestamp&&{navigationRefreshTimestamp:e.navigationRefreshTimestamp}}),console.log("Persisted search state to session storage:",{companyCount:e.currentResults.length,emailCount:e.currentResults.reduce((e,t)=>e+(t.contacts?.filter(e=>e.email&&e.email.length>0).length||0),0),hasListId:!!t.currentListId})},[]),C=(0,s.useCallback)(async(e,t)=>{try{console.log("Refreshing contact data from database...");let t=await Promise.all(e.map(async e=>{try{let t=await (0,g.apiRequest)("GET",`/api/companies/${e.id}/contacts`),s=await t.json();return{...e,contacts:s}}catch(t){return console.error(`Failed to refresh contacts for company ${e.id}:`,t),e}}));return console.log("Contact data refresh completed from database"),t}catch(t){return console.error("Database refresh failed:",t),e}},[]),w=(0,s.useCallback)(async(e,t,s={})=>{try{let a=++y.current,r=await C(e,{forceFresh:s.forceFresh});if(a!==y.current)return console.log("Skipping stale refresh result from version",a),e;let o=[...r].sort((e,t)=>{let s=e.contacts?.length||0;return(t.contacts?.length||0)-s});return s.forceUiReset?(q([]),setTimeout(()=>{a===y.current&&q(o)},100)):q(o),v({currentResults:o,...s.additionalStateFields},t),s.clearEmailSearchTimestamp&&(sessionStorage.removeItem("lastEmailSearchTimestamp"),console.log("Cleared lastEmailSearchTimestamp")),console.log("Refreshed and updated results:",{companyCount:o.length,companiesWithContacts:o.filter(e=>e.contacts&&e.contacts.length>0).length}),o}catch(t){return console.error("Failed to refresh and update results:",t),e}},[C,v,q]),{loadSearchState:b,persistSearchState:v,refreshContactDataFromDatabase:C,refreshAndUpdateResults:w,isMountedRef:d,isInitializedRef:p,hasSessionRestoredDataRef:x,refreshVersionRef:y}),tn=(0,s.useRef)(null),tl=(0,s.useRef)(!1),ti=(0,s.useRef)(null),tc=(0,s.useRef)(!1),td=(0,s.useRef)(!1),tu=(0,s.useRef)(null),tm=async e=>{try{let t=sessionStorage.getItem("lastEmailSearchTimestamp");if(t&&Date.now()-parseInt(t)<12e4){console.log("Recent email search detected, refreshing contact data...");let t=await tt(e,{currentQuery:E,currentListId:A,lastExecutedQuery:es},{clearEmailSearchTimestamp:!0});return console.log("Contact data refresh completed"),t}}catch(e){console.error("Auto-refresh failed:",e)}return e};(0,s.useEffect)(()=>{console.log("ðŸŸ£ COMPONENT MOUNT - Home page mounting");let t=localStorage.getItem("pendingSearchQuery");if(t)console.log("Found pending search query:",t),P(t),et(!0),localStorage.removeItem("pendingSearchQuery"),$(),B(null),M(!1);else if(!eZ&&!e){let e=e7();if(e&&e.currentResults&&!tr.current){tr.current=!0,console.log("Restoring from session storage:",{query:e.currentQuery,resultsCount:e.currentResults?.length,listId:e.currentListId});let t=e.currentQuery||"",s=e.currentListId;P(t),B(s),q(e.currentResults),ed(e.lastExecutedQuery||e.currentQuery),eN(!1),s&&M(!0)}else console.log("No saved search state found or session data already restored")}let s=async()=>{if(!tc.current){tc.current=!0,console.log("Registration success detected, triggering welcome notification");try{let e=e7(),t={originalQuery:e?.currentQuery||null};console.log("Extracted guest data:",t),$(),localStorage.removeItem("contactSearchConfig"),sessionStorage.removeItem("lastEmailSearchTimestamp"),localStorage.removeItem("pendingSearchQuery"),localStorage.removeItem("fluffy-guidance-progress"),Object.keys(localStorage).forEach(e=>{e.startsWith("fluffy-quest-triggered-")&&localStorage.removeItem(e)}),q(null),B(null),M(!1),Z(!1),ed(null),eN(!1),eX.invalidateQueries({queryKey:["/api/lists"]}),console.log("Guest data cleared successfully"),t.originalQuery&&(P(t.originalQuery),console.log("Restored guest query to input:",t.originalQuery)),e4("registration_complete")}catch(e){console.error("Failed to handle registration success:",e)}}};return ta.current||e1.setRegistrationSuccessCallback(s),ta.current=!0,()=>{e1.setRegistrationSuccessCallback(()=>{}),ts.current=!1}},[]),(0,s.useEffect)(()=>{let e=e=>{tb(e.detail)},t=()=>{tv()},s=()=>{e$.openCompose()};return window.addEventListener("loadSavedSearch",e),window.addEventListener("startNewSearch",t),window.addEventListener("openEmailCompose",s),()=>{window.removeEventListener("loadSavedSearch",e),window.removeEventListener("startNewSearch",t),window.removeEventListener("openEmailCompose",s)}},[e$.openCompose]),(0,s.useEffect)(()=>(tn.current&&clearTimeout(tn.current),tn.current=setTimeout(()=>{ts.current&&ta.current&&(E||O&&O.length>0)&&R({currentQuery:es||E,currentResults:O,currentListId:A,lastExecutedQuery:es})},1e3),()=>{tn.current&&clearTimeout(tn.current)}),[E,O,A,es]);let th=(0,a.useMutation)({mutationFn:async({query:e,companies:t})=>{if(console.log("ðŸ”´ LIST CREATION - Starting auto-create mutation:",{query:e,companiesCount:t?.length,timestamp:new Date().toISOString()}),!e||!t)return;let s=localStorage.getItem("contactSearchConfig"),a=null;if(s)try{a=JSON.parse(s)}catch(e){console.error("Error parsing contact search config:",e)}let r=await (0,g.apiRequest)("POST","/api/lists",{companies:t,prompt:e,contactSearchConfig:a}),o=await r.json();return console.log("ðŸ”´ [AUTO-CREATE LIST] Backend response from POST /api/lists:",o),console.log("ðŸ”´ [AUTO-CREATE LIST] Response fields:",Object.keys(o)),o},onSuccess:e=>{console.log("Backend returned data from list creation:",e),eX.invalidateQueries({queryKey:["/api/lists"]});let t=e.listId;if(B(t),M(!0),tl.current=!1,console.log("List created successfully with listId:",t),e9({currentResults:O||[]},{currentQuery:E,currentListId:t,lastExecutedQuery:es}),console.log("Persisted new listId to localStorage:",t),tu.current&&t){let e=tu.current;(0,g.apiRequest)("PATCH",`/api/lists/${t}/metrics`,e).then(()=>{console.log(`Persisted pending search metrics to newly created list ${t}`),tu.current=null}).catch(e=>{console.error("Failed to persist pending search metrics:",e)})}},onError:e=>{console.error("Auto list creation failed:",e),tl.current=!1}}),tp=(0,a.useMutation)({mutationFn:async({query:e,companies:t,listId:s})=>{if(console.log("ðŸŸ¡ LIST UPDATE - Starting update mutation:",{listId:s,query:e,companiesCount:t?.length,timestamp:new Date().toISOString()}),!e||!t||!s)throw console.error("Update list validation failed:",{hasQuery:!!e,hasResults:!!t,hasListId:!!s,listId:s}),Error("Missing required data for list update");console.log("Starting list update:",{listId:s,query:e,companyCount:t.length,companyIds:t.map(e=>e.id)});let a=localStorage.getItem("contactSearchConfig"),r=null;if(a)try{r=JSON.parse(a)}catch(e){console.error("Error parsing contact search config:",e)}return(await (0,g.apiRequest)("PUT",`/api/lists/${s}`,{companies:t,prompt:e,contactSearchConfig:r})).json()},onSuccess:e=>{console.log("List update successful:",e),eX.invalidateQueries({queryKey:["/api/lists"]}),tl.current=!1},onError:e=>{console.error("List update failed:",e),tl.current=!1}}),tg=function({currentResults:e,currentQuery:t,currentListId:a,lastExecutedQuery:o,currentSessionId:n,setCurrentResults:l,refreshContactDataIfNeeded:i,refreshAndUpdateResults:c,updateListMutation:d,isAutomatedSearchRef:u}){let{toast:m}=(0,f.useToast)(),h=(0,r.useQueryClient)(),[p,x]=(0,s.useState)(!1),[S,y]=(0,s.useState)({phase:"",completed:0,total:0,isVisible:!1}),[b,v]=(0,s.useState)(!1),[C,w]=(0,s.useState)(0),[j,T]=(0,s.useState)(void 0),k=(0,s.useCallback)((e,t)=>e.contacts&&0!==e.contacts.length?[...e.contacts].sort((e,t)=>(t.probability||0)-(e.probability||0)).slice(0,t):[],[]),E=(0,s.useCallback)(()=>e?.filter(e=>!k(e,3).some(e=>e.email&&e.email.length>5))||[],[e,k]),I=(0,s.useCallback)(async()=>{if(e&&0!==e.length){x(!0),u.current=!0,v(!1),y({phase:"Starting email search",completed:0,total:5,isVisible:!0});try{let s=(await i(e)).filter(e=>!k(e,3).some(e=>e.email&&e.email.length>5));if(0===s.length){console.log("No companies need email searches - all companies have sufficient emails"),x(!1),v(!0);return}let r=s.map(e=>e.id);console.log(`Starting backend email orchestration for ${r.length} companies`),n&&N.markEmailSearchStarted(n);let p=await (0,g.apiRequest)("POST","/api/search-jobs",{query:"email-search-bulk",searchType:"emails",metadata:{companyIds:r,sessionId:n,isBulkEmailSearch:!0},priority:0});if(!p.ok)throw Error(`Job creation failed: ${p.status}`);let{jobId:f}=await p.json(),S=!1,b=0,C={summary:{emailsFound:0,contactsProcessed:0,companiesProcessed:r.length}};for(;!S&&b<60;){await new Promise(e=>setTimeout(e,2e3));let e=await (0,g.apiRequest)("GET",`/api/search-jobs/${f}`),t=await e.json();if(t.progress&&y({phase:t.progress.phase||"Processing",completed:t.progress.completed||0,total:t.progress.total||5,isVisible:!0}),"completed"===t.status)S=!0,C=t.results||C,console.log("Backend orchestration completed:",C);else if("failed"===t.status)throw Error(`Email search job failed: ${t.error}`);b++}if(!S)throw Error("Email search job timed out");let j=C.metadata||C.summary||{emailsFound:0,contactsEnriched:0,companiesSearched:0};console.log("Backend orchestration completed with metadata:",j),n&&N.markEmailSearchCompleted(n),w(j.emailsFound||0),T(j.sourceBreakdown||{});let E=j.contactsEnriched||j.contactsProcessed||0,I=j.companiesSearched||j.companiesProcessed||0;if(m({title:"Email Search Complete",description:`Found ${j.emailsFound||0} emails for ${E} contacts across ${I} companies`}),await h.invalidateQueries({queryKey:["/api/credits"]}),console.log("EMAIL SEARCH COMPLETE: Updating results with email data"),C.companies&&Array.isArray(C.companies)){console.log(`Merging emails from ${C.companies.length} companies into current results`);let s=new Map;C.companies.forEach(e=>{e.contacts&&Array.isArray(e.contacts)&&s.set(e.id,e.contacts)});let r=e.map(e=>{let t=s.get(e.id);if(t){let s=e.contacts?.map(e=>{let s=t.find(t=>t.id===e.id);return s?{...e,...s}:e})||t;return{...e,contacts:s}}return e});l(r),R({currentQuery:t,currentResults:r,currentListId:a,lastExecutedQuery:o,emailSearchCompleted:!0});let n=r.reduce((e,t)=>e+(t.contacts?.filter(e=>e.email&&e.email.length>0).length||0),0);console.log(`Email merge completed with ${n} emails found`)}else{console.log("EMAIL SEARCH COMPLETE: Falling back to database reload"),await new Promise(e=>setTimeout(e,1e3));let s=(await c(e,{currentQuery:t,currentListId:a,lastExecutedQuery:o},{forceFresh:!0,additionalStateFields:{emailSearchCompleted:!0,emailSearchTimestamp:Date.now()}})).reduce((e,t)=>e+(t.contacts?.filter(e=>e.email&&e.email.length>0).length||0),0);console.log(`Database reload completed with ${s} emails found`)}a&&t&&e&&(console.log("Updating existing list after email search completion:",a),d.mutate({query:t,companies:e,listId:a})),x(!1),u.current=!1,v(!0),y(e=>({...e,isVisible:!1}))}catch(e){console.error("Backend email orchestration error:",e),m({title:"Search Failed",description:e instanceof Error?e.message:"Failed to complete email search",variant:"destructive"}),x(!1),u.current=!1,y(e=>({...e,isVisible:!1}))}}},[e,t,a,o,n,l,i,c,d,u,m,h,k]);return{isSearching:p,searchProgress:S,summaryVisible:b,lastEmailSearchCount:C,lastSourceBreakdown:j,runEmailSearch:I,getCurrentCompaniesWithoutEmails:E,getTopContacts:k,updateEmailSearchMetrics:(0,s.useCallback)((e,t)=>{w(e),t&&T(t),v(!0)},[]),closeSummary:(0,s.useCallback)(()=>{v(!1)},[])}}({currentResults:O,currentQuery:E,currentListId:A,lastExecutedQuery:es,currentSessionId:ek,setCurrentResults:q,refreshContactDataIfNeeded:tm,refreshAndUpdateResults:tt,updateListMutation:tp,isAutomatedSearchRef:(0,s.useRef)(!1)});(0,a.useMutation)({mutationFn:async()=>{if(!E||!O)return null;let e=localStorage.getItem("contactSearchConfig"),t=null;if(e)try{t=JSON.parse(e)}catch(e){console.error("Error parsing contact search config:",e)}return(await (0,g.apiRequest)("POST","/api/lists",{companies:O,prompt:E,contactSearchConfig:t})).json()},onSuccess:e=>{eX.invalidateQueries({queryKey:["/api/lists"]}),eG({title:"List Saved",description:"Your search results have been saved. Click on any contact to compose an email."}),M(!0),e&&e.listId&&B(e.listId)},onError:e=>{eG({title:"Save Failed",description:e.message,variant:"destructive"})}});let tf=e=>[...e].sort((e,t)=>{let s=e.contacts?.length||0;return(t.contacts?.length||0)-s}),tx=(e,t)=>{console.log("=== PARENT COMPONENT: handleSearchResults called ==="),console.log("Received query:",e),console.log("Received results count:",t.length),console.log("Current component state - query:",E),console.log("Current component state - results count:",O?.length||0),console.log("Complete results received with contacts:",t.length);let s=E!==e;t.length>0&&(eK(e),eJ(t)),s&&(console.log("New search detected - clearing stale session data and list ID"),$(),B(null),M(!1)),tr.current=!0;let a=tf(t);if(console.log("Companies reordered by contact count:",a.map(e=>({name:e.name,contacts:e.contacts?.length||0}))),P(e),q(a),M(!1),X(!1),console.log("=== PARENT COMPONENT: State updated ==="),console.log("New state - query:",e),console.log("New state - results count:",a.length),console.log("handleSearchResults completed"),Z(!0),ed(e),eN(!1),console.log("Companies with contacts:",t.filter(e=>e.contacts&&e.contacts.length>0).length,"of",t.length),ti.current&&clearTimeout(ti.current),a.length>0){let t=s?null:A;ti.current=setTimeout(()=>{(console.log("ðŸ”µ LIST DECISION - Timer fired after 1.5s:",{listIdAtTimeOfResults:t,queryAtTimeOfResults:e,resultsCount:a.length,mutationInProgress:tl.current,timestamp:new Date().toISOString()}),tl.current)?console.log("ðŸ”µ LIST DECISION - List mutation already in progress, skipping duplicate call"):t?(console.log("ðŸ”µ LIST DECISION - Updating existing list:",t),tl.current=!0,tp.mutate({query:e,companies:a,listId:t})):(console.log("ðŸ”µ LIST DECISION - Creating new list for search results (new search or no existing list)"),tl.current=!0,th.mutate({query:e,companies:a}))},1500)}},tS=(0,s.useMemo)(()=>{if(!O)return[];let e=[];return O.forEach(t=>{t.contacts&&e.push(...t.contacts)}),function(e,t={maxPerCompany:3,minProbability:50}){let s=[...e.filter(e=>e.name&&e.probability&&e.probability>=(t.minProbability??50))].sort((e,t)=>(t.probability||0)-(e.probability||0)),a=[],r=new Set,o={};for(let e of s)if(!(e.email&&r.has(e.email.toLowerCase()))){if(e.companyId&&(o[e.companyId]=o[e.companyId]||0,o[e.companyId]>=(t.maxPerCompany??3)))continue;a.push(e),e.email&&r.add(e.email.toLowerCase()),e.companyId&&o[e.companyId]++}return a}(e,{maxPerCompany:3,minProbability:50})},[O]),ty=(0,a.useMutation)({mutationFn:async({contactId:e,feedbackType:t,ispContext:s})=>(await (0,g.apiRequest)("POST",`/api/contacts/${e}/feedback`,{feedbackType:t,ispContext:s})).json(),onSuccess:e=>{q(t=>t?t.map(t=>({...t,contacts:t.contacts?.map(t=>t.id===e.contactId?{...t,feedbackType:e.feedbackType,ispContext:e.ispContext,feedbackAt:e.feedbackAt}:t)})):null),eG({title:"Feedback Recorded",description:"Thank you for helping us find your ideal customer!"}),eW(e=>({...e,isOpen:!1}))},onError:e=>{eG({title:"Feedback Failed",description:e instanceof Error?e.message:"Failed to record feedback",variant:"destructive"})}}),tb=async e=>{if(console.log("Loading saved search:",{searchName:e.prompt,listId:e.listId,resultCount:e.resultCount,searchType:e.searchType}),"super"===e.searchType&&e.superSearchData){let t=e.superSearchData;eL.loadFromSaved(t.plan,t.results),P(e.prompt),ed(e.prompt),eA(!0),e_(!0),q(null),console.log("Super Search loaded:",{query:e.prompt,resultCount:t.results.length});return}try{await eX.refetchQueries({queryKey:[`/api/lists/${e.listId}/companies`],type:"all",exact:!0});let t=await eX.fetchQuery({queryKey:[`/api/lists/${e.listId}/companies`]});console.log("Fetched companies from database:",{listId:e.listId,count:t.length,expectedCount:e.resultCount});let s=await Promise.all(t.map(async e=>{try{await eX.refetchQueries({queryKey:[`/api/companies/${e.id}/contacts`],type:"all",exact:!0});let t=(await eX.fetchQuery({queryKey:[`/api/companies/${e.id}/contacts`]})).map(t=>({...t,companyName:e.name,companyId:e.id}));return{...e,contacts:t}}catch(t){return console.error(`Failed to load contacts for company ${e.id}:`,t),{...e,contacts:[]}}}));P(e.prompt),ed(e.prompt),q(s),B(e.listId),M(!0),console.log("Saved search loaded successfully:",{query:e.prompt,listId:e.listId,companiesLoaded:s.length,totalContacts:s.reduce((e,t)=>e+(t.contacts?.length||0),0)}),setTimeout(()=>{eN(!1)},0),s.reduce((e,t)=>e+(t.contacts?.length||0),0),(null!==e.totalContacts||null!==e.totalEmails||null!==e.searchDurationSeconds)&&(tT({query:e.prompt,totalCompanies:s.length,totalContacts:e.totalContacts??0,totalEmails:e.totalEmails??0,searchDuration:e.searchDurationSeconds?1e3*e.searchDurationSeconds:0,companies:s,sourceBreakdown:e.sourceBreakdown??{Perplexity:0,Apollo:0,Hunter:0}}),console.log("Loaded persisted search metrics:",{totalContacts:e.totalContacts,totalEmails:e.totalEmails,searchDurationSeconds:e.searchDurationSeconds,sourceBreakdown:e.sourceBreakdown}))}catch(e){eG({title:"Failed to load search",description:"Could not load the selected search.",variant:"destructive"})}},tv=()=>{e$.closeDrawer(),P(""),q(null),B(null),ed(null),M(!1),eN(!1),W(new Set),Z(!1),eP(!1),$(),localStorage.removeItem("emailComposerState")};(0,s.useEffect)(()=>{e&&setTimeout(()=>tv(),0)},[e]),(0,s.useEffect)(()=>{if(!td.current&&eZ&&e0?.listId){let e=parseInt(e0.listId,10);if(!isNaN(e)){if(A===e){console.log("Search already loaded, skipping fetch:",{listId:e}),td.current=!0;return}if(!e2.authReady)return void console.log("Waiting for auth to be ready before loading search:",{listId:e});td.current=!0,console.log("Loading search from URL (one-time):",{listId:e,slug:e0.slug}),(async()=>{try{let t=await eX.fetchQuery({queryKey:["/api/lists",e]});t?tb(t):(console.warn("Search not found for listId:",e),eG({title:"Search not found",description:"The search you're looking for could not be found.",variant:"destructive"}))}catch(e){console.error("Failed to load search by listId:",e),eG({title:"Search not found",description:"The search you're looking for could not be found.",variant:"destructive"})}})()}}},[eZ,e0?.listId,A,e2.authReady,e2.user]);let[tC,tw]=(0,s.useState)(!1),[tj,tT]=(0,s.useState)({query:"",totalCompanies:0,totalContacts:0,totalEmails:0,searchDuration:0,companies:[],sourceBreakdown:void 0}),tN=async e=>{let t=O?.flatMap(e=>e.contacts||[]).find(t=>t.id===e);if(!t)return;let s=O?.find(t=>t.contacts?.some(t=>t.id===e));await e6(e,t,{companyName:s?.name,companyWebsite:s?.website||void 0,companyDescription:s?.description||void 0})},[tk,tE]=(0,s.useState)(new Set),tI=async e=>{tE(t=>new Set(t).add(e));try{let t=await fetch(`/api/contacts/${e}/find-mobile-phone`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"}),s=await t.json();if(!t.ok)return void eG({title:"Phone lookup failed",description:s.error||"Could not initiate phone lookup",variant:"destructive"});eG({title:"Phone lookup started",description:s.message||"Results will arrive in 5-15 minutes"}),A&&eX.invalidateQueries({queryKey:[`/api/lists/${A}/companies`]}),eX.invalidateQueries({queryKey:["/api/lists"]})}catch(e){console.error("Error finding mobile phone:",e),eG({title:"Error",description:"Failed to initiate phone lookup",variant:"destructive"})}finally{tE(t=>{let s=new Set(t);return s.delete(e),s})}},tR=e=>{let t=e.contacts?.filter(e=>e.email)||[];if(0===t.length)return"unchecked";let s=t.filter(e=>V.has(e.id)).length;return 0===s?"unchecked":s===t.length?"checked":"indeterminate"},t$=(0,s.useMemo)(()=>{if(!eZ||!E||!A)return null;let e=e0?.slug||(0,i.slugify)(E),t=O?.length??0,s=`https://5ducks.ai/search/${e}/${A}`;return{title:`${E} | 5Ducks`,description:`${t} companies found for "${E}". Discover verified contacts and leads for your B2B outreach.`,canonicalUrl:s,jsonLd:{"@context":"https://schema.org","@type":"CollectionPage",name:E,description:`${t} companies matching: ${E}`,url:s,numberOfItems:t,provider:{"@type":"Organization",name:"5Ducks",url:"https://5ducks.ai"}}}},[eZ,E,A,O?.length,e0?.slug]);return(0,t.jsxs)(t.Fragment,{children:[t$&&(0,t.jsx)(l.SEOHead,{title:t$.title,description:t$.description,canonicalUrl:t$.canonicalUrl,jsonLd:t$.jsonLd}),tC&&(0,t.jsx)(s.Suspense,{fallback:null,children:(0,t.jsx)(ev,{metrics:{query:tj.query,totalCompanies:tj.totalCompanies,totalContacts:tj.totalContacts,totalEmails:tj.totalEmails,searchDuration:tj.searchDuration,companies:tj.companies,sourceBreakdown:tj.sourceBreakdown},isVisible:tC,onClose:()=>tw(!1),cachedInfo:eI,onRefresh:()=>{let e=eI.query||es||E;e?.trim()&&(sessionStorage.setItem("forceBypassCache","true"),P(e),eP(!1),eG({title:"Refreshing search",description:"Getting fresh results..."}),requestAnimationFrame(()=>{setTimeout(()=>{window.dispatchEvent(new CustomEvent("triggerFreshSearch",{detail:{query:e}}))},50)}))}})}),(0,t.jsxs)("div",{className:"flex h-[calc(100vh-3.5rem)] overflow-hidden relative",children:[e$.isOpen&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:()=>{e$.closeDrawer()}}),(0,t.jsxs)("div",{className:`flex-1 overflow-y-auto main-content-compressed ${e$.isOpen&&O&&O.length>0?"compressed-view":""}`,children:[(0,t.jsx)("div",{className:"container mx-auto py-6 px-0 md:px-6 max-w-4xl",children:(0,t.jsx)("div",{className:"grid grid-cols-12 gap-3 md:gap-6",children:(0,t.jsxs)("div",{className:"col-span-12 space-y-2 md:space-y-4 mt-[-10px]",children:[eO.isVisible&&(0,t.jsx)("div",{className:"px-3 md:px-6",children:(0,t.jsx)(u,{phase:eO.phase,completed:eO.completed,total:eO.total,isVisible:eO.isVisible})}),(0,t.jsxs)("div",{className:"relative transition-all duration-300 ease-in-out",children:[eD&&(0,t.jsxs)("div",{className:"w-full px-3 md:px-6 py-2 bg-background border rounded-lg flex items-center justify-between mb-2",children:[(0,t.jsxs)("button",{onClick:()=>eP(!1),className:"flex-1 flex items-center gap-2 hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors rounded-l-lg group","data-testid":"button-expand-search",children:[(0,t.jsx)(S.Search,{className:"h-4 w-4 text-muted-foreground"}),E&&(0,t.jsx)("span",{className:"text-sm text-muted-foreground truncate max-w-[200px] md:max-w-[400px]",children:E})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[eI.isCached&&(0,t.jsx)(_.TooltipProvider,{children:(0,t.jsxs)(_.Tooltip,{children:[(0,t.jsx)(_.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("button",{onClick:e=>{e.stopPropagation();let t=eI.query||es||E;t?.trim()?(sessionStorage.setItem("forceBypassCache","true"),P(t),eP(!1),eG({title:"Refreshing search",description:"Getting fresh results..."}),requestAnimationFrame(()=>{setTimeout(()=>{window.dispatchEvent(new CustomEvent("triggerFreshSearch",{detail:{query:t}}))},50)})):eG({title:"Unable to refresh",description:"No search query available",variant:"destructive"})},className:"flex items-center gap-1.5 px-2 py-1 rounded text-xs text-muted-foreground hover:text-foreground hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","data-testid":"button-refresh-search",children:[(0,t.jsxs)("span",{className:"hidden md:inline text-[10px] opacity-70",children:["Search results from ",eI.cachedDate&&new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(eI.cachedDate)]}),(0,t.jsx)(eh.RefreshCw,{className:"h-3.5 w-3.5"})]})}),(0,t.jsx)(_.TooltipContent,{side:"bottom",children:(0,t.jsxs)("p",{children:["Results from ",eI.cachedDate?new Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(eI.cachedDate):"cache",". Click to search fresh."]})})]})}),(0,t.jsx)("button",{onClick:()=>eP(!1),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors group",children:(0,t.jsx)(K.ChevronDown,{className:"h-4 w-4 text-muted-foreground group-hover:text-foreground transition-colors"})})]})]}),(0,t.jsx)("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${eD?"max-h-0 opacity-0 pointer-events-none":"max-h-[500px] opacity-100"}`,children:(0,t.jsxs)("div",{className:"px-3 md:px-6 py-1",children:[" ",!eD&&O&&O.length>0&&(0,t.jsx)("button",{onClick:()=>eP(!0),className:"absolute right-3 md:right-6 top-2 z-10 p-1.5 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors group","data-testid":"button-collapse-search",title:"Minimize search",children:(0,t.jsx)(em.ChevronUp,{className:"h-4 w-4 text-muted-foreground group-hover:text-foreground"})}),!O&&!j&&(0,t.jsx)("div",{className:"flex flex-col-reverse md:flex-row items-center gap-4 mb-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(eg,{}),(0,t.jsxs)("h2",{className:"text-2xl sm:text-3xl md:text-4xl mt-2 md:mt-0 font-serif text-accent dark:text-accent",children:["Find your ideal ",(0,t.jsx)("em",{children:"business"})," customers"]})]})}),(0,t.jsx)(ea,{onAnalyze:()=>{T(!0),eR({isCached:!1,cachedDate:null,query:null}),E&&E!==es&&(console.log("Starting new search - clearing list ID and results for query:",E),B(null),M(!1),q(null),W(new Set))},onComplete:()=>{T(!1)},onSearchResults:tx,onCompaniesReceived:(e,t)=>{console.log("Companies received:",t.length),tr.current=!0,P(e),q(tf(t.map(e=>({...e,contacts:[]})))),M(!1),X(!0),Z(!1)},isAnalyzing:j,value:E||"",onChange:e=>{P(e),eN(e!==es)},isFromLandingPage:ee,onDismissLandingHint:()=>et(!1),lastExecutedQuery:es,onSearchSuccess:()=>{"emails"===(localStorage.getItem("searchType")||"contacts")&&setTimeout(()=>tg.runEmailSearch(),500)},hasSearchResults:!!O&&O.length>0,onSessionIdChange:eE,hideRoleButtons:!!(eD&&O&&O.length>0&&!ep),onSearchMetricsUpdate:async(e,t)=>{tT({...e,sourceBreakdown:e.sourceBreakdown}),tw(t);let s=e.companies?.map(e=>({id:e.id,name:e.name,contacts:e.contacts?.map(e=>({id:e.id,name:e.name,role:e.role,email:e.email,probability:e.probability}))}))??null,a={totalContacts:e.totalContacts??null,totalEmails:e.totalEmails??null,searchDurationSeconds:e.searchDuration??null,sourceBreakdown:e.sourceBreakdown??null,reportCompanies:s};if(A&&e)try{await (0,g.apiRequest)("PATCH",`/api/lists/${A}/metrics`,a),console.log(`Persisted search metrics to list ${A}`)}catch(e){console.error("Failed to persist search metrics:",e)}else e&&(tu.current=a,console.log("Stored pending metrics for later persistence"))},onOpenSearchDrawer:()=>eF.openDrawer(),onProgressUpdate:eq,superSearch:{startSearch:eL.startSearch,reset:eL.reset,status:eL.status},onSuperSearchActive:e=>{eA(e),e&&e_(!1)},onCacheHit:async e=>{console.log(`ðŸŽ¯ Cache hit detected, loading list ${e.listId}`),T(!1),eR({isCached:!0,cachedDate:e.createdAt?new Date(e.createdAt):null,query:e.prompt||E});try{let t=await eX.fetchQuery({queryKey:[`/api/lists/${e.listId}`]});t&&(await tb(t),tw(!0))}catch(e){console.error("Failed to load cached list:",e)}}}),!O&&!j&&(0,t.jsxs)("div",{className:"mt-4 text-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:"Or select one of the suggestions below:"}),(0,t.jsx)("div",{className:"flex flex-wrap justify-center gap-2",children:["Recently exited startups in Miami","Real-estate lawyers in Salt Lake City","Stationary suppliers in Scranton","Health-tech SaaS in Brooklyn"].map(e=>(0,t.jsx)("button",{onClick:()=>{P(e),eN(!0)},className:"px-3 py-1.5 text-sm bg-transparent border border-secondary-foreground/60 hover:border-secondary-foreground text-secondary-foreground/60 hover:text-secondary-foreground rounded-lg transition-colors","data-testid":`button-suggestion-${e.toLowerCase().replace(/\s+/g,"-").slice(0,30)}`,children:e},e))})]}),!O&&j&&!eM&&(0,t.jsx)("div",{className:"mt-8 text-center",children:(0,t.jsx)("p",{className:"text-lg text-muted-foreground",children:"â³ Your amazing list of companies will show up here."})})]})})]}),O&&O.length>0?(0,t.jsxs)(c.Card,{className:`w-full rounded-none md:rounded-lg border-0 transition-all duration-300 bg-background ${e$.isOpen?"shadow-none":""}`,"data-testid":"search-results-card",children:[tg.isSearching&&(0,t.jsx)("div",{className:"px-0 md:px-4 pt-0 pb-3",children:(0,t.jsx)(u,{phase:tg.searchProgress.phase,completed:tg.searchProgress.completed,total:tg.searchProgress.total,isVisible:tg.isSearching})}),(0,t.jsx)(c.CardContent,{className:"p-0",children:(0,t.jsx)("div",{className:"px-0 md:px-4 pb-4",children:(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)(m,{}),children:(0,t.jsx)(ex,{companies:O||[],handleCompanyView:e=>{let t=e.slug||e.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50);eY.push(`/company/${t}/${e.id}`)},handleComprehensiveEmailSearch:tN,handleFindMobilePhone:tI,pendingContactIds:H,pendingComprehensiveSearchIds:e8,pendingPhoneRevealIds:tk,onContactClick:(e,t)=>{let s=O?.find(e=>e.id===t.id)?.contacts||[];e$.openDrawer(e,t,s),e.email||(e.completedSearches?.includes("comprehensive_search")?eG({title:"No email available",description:`All search methods have been exhausted for ${e.name}. Consider selecting another contact.`,variant:"default"}):eG({title:"No email found",description:'Click the "Find email" button to search for it.',variant:"default"})),eP(!0)},onViewModeChange:U,selectedEmailContact:e$.selectedContact,selectedContacts:V,onContactSelectionChange:e=>{W(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},getCompanySelectionState:tR,onCompanySelectionChange:e=>{let t=e.contacts?.filter(e=>e.email)||[];if(0===t.length)return;let s=tR(e);W(e=>{let a=new Set(e);return"checked"===s||"indeterminate"===s?t.forEach(e=>{a.delete(e.id)}):t.forEach(e=>{a.add(e.id)}),a})},topActionsTrailing:V.size>0?(0,t.jsx)(s.Suspense,{fallback:null,children:(0,t.jsx)(eT,{selectedCount:V.size,onClear:()=>W(new Set),selectedContactIds:Array.from(V)})}):void 0,onShowReport:()=>tw(!0),onFindKeyEmails:tg.runEmailSearch,isFindingEmails:tg.isSearching,query:E,onExtendSearch:tx,isAuthenticated:!!e2.user,onLoginRequired:()=>e1.openModal()})})})})]}):null,O&&O.length>0&&"slides"!==z&&(0,t.jsx)(s.Suspense,{fallback:null,children:(0,t.jsx)(ej,{prospects:tS,pendingComprehensiveSearchIds:e8,isVisible:!0,onContactView:e=>{let t=e.slug||e.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50);eY.push(`/p/${t}/${e.id}`)},onContactFeedback:(e,t)=>{let s=O?.flatMap(e=>e.contacts||[])?.find(t=>t.id===e);s?s.feedbackType?eG({title:"Feedback Already Given",description:"You have already provided feedback for this contact."}):eW({isOpen:!0,contactId:e,contactName:s.name,feedbackType:t}):eG({title:"Error",description:"Contact not found",variant:"destructive"})},handleComprehensiveEmailSearch:tN})})]})})}),eM&&(0,t.jsx)("div",{className:"container mx-auto py-4 px-0 md:px-6 max-w-7xl",children:(0,t.jsx)(c.Card,{className:"w-full rounded-none md:rounded-lg border-0 bg-background",children:(0,t.jsxs)(c.CardContent,{className:"p-4 md:p-6",children:[(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)(m,{}),children:(0,t.jsx)(eS,{state:eL,query:E||void 0,alreadySaved:eQ,onSaved:e=>{console.log(`Super Search saved with list ID: ${e}`),e_(!0)}})}),"complete"===eL.status&&(0,t.jsx)("div",{className:"mt-4 flex justify-end",children:(0,t.jsx)(n.Button,{variant:"outline",onClick:()=>{eA(!1),eL.reset(),T(!1)},children:"Close Results"})})]})})})]}),e$.isOpen&&(0,t.jsx)(s.Suspense,{fallback:null,children:(0,t.jsx)(ey,{open:e$.isOpen,mode:e$.mode,viewState:e$.viewState,selectedContact:e$.selectedContact,selectedCompany:e$.selectedCompany,selectedCompanyContacts:e$.selectedCompanyContacts,width:e$.drawerWidth,isResizing:e$.isResizing,currentListId:A,currentQuery:E,emailSubject:"minimized"===e$.viewState?(0,en.getPersistedEmailSubject)():void 0,onClose:e$.closeDrawer,onModeChange:e$.setMode,onContactChange:e=>{e$.setSelectedContact(e)},onResizeStart:e$.handleMouseDown,onMinimize:e$.minimize,onExpand:e$.expand,onRestore:e$.restore})}),eF.isOpen&&(0,t.jsx)(s.Suspense,{fallback:null,children:(0,t.jsx)(eb,{open:eF.isOpen,width:eF.drawerWidth,isResizing:eF.isResizing,onClose:eF.closeDrawer,onResizeStart:eF.handleMouseDown,onTrainAI:()=>ez(!0),hasSearchResults:eH&&eH.length>0})}),(0,t.jsx)(eu,{notificationState:e3,onClose:e5}),eB&&(0,t.jsx)(s.Suspense,{fallback:null,children:(0,t.jsx)(eC,{searchQuery:eU,searchResults:eH,onComplete:()=>{ez(!1),localStorage.setItem("hasCompletedOnboarding","true"),eG({title:"Setup complete!",description:"Your campaign is now active and ready to start generating leads."})},onClose:()=>{ez(!1)}})}),eV.isOpen&&(0,t.jsx)(s.Suspense,{fallback:null,children:(0,t.jsx)(ew,{isOpen:eV.isOpen,onClose:()=>{eW(e=>({...e,isOpen:!1}))},onSubmit:(e,t)=>{eV.contactId&&ty.mutate({contactId:eV.contactId,feedbackType:e,ispContext:t})},feedbackType:eV.feedbackType,contactName:eV.contactName,isPending:ty.isPending})})]})]})}e.s(["default",()=>eN],56758)},21546,e=>{e.n(e.i(56758))}]);