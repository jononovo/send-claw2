(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31278,e=>{"use strict";let t=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},73884,e=>{"use strict";let t=(0,e.i(75254).default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],73884)},56539,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(18566),i=e.i(69604),s=e.i(58260);e.i(51402);var o=e.i(15762),l=e.i(84923),n=e.i(69638),c=e.i(31278),d=e.i(73884),u=e.i(6625);e.i(56813);var h=e.i(64040);function m(){let m=(0,r.useRouter)(),[w,g]=(0,a.useState)("loading"),[p,x]=(0,a.useState)(""),[f,b]=(0,a.useState)(""),[v,y]=(0,a.useState)(""),[j,N]=(0,a.useState)(!1),{toast:k}=(0,s.useToast)();(0,a.useEffect)(()=>{S()},[]);let S=async()=>{try{let{auth:t}=await (0,i.loadFirebase)(),{isSignInWithEmailLink:a,signInWithEmailLink:r,checkActionCode:s}=await e.A(3975);if(!a(t,window.location.href)){g("error"),x("Invalid or expired link. Please request a new one.");return}let n=new URL(window.location.href).searchParams.get("oobCode"),c=null;if(n)try{let e=await s(t,n);"EMAIL_SIGNIN"===e.operation&&e.data.email&&(c=e.data.email,console.log("Email extracted from magic link via checkActionCode"))}catch(e){console.warn("checkActionCode failed, will try localStorage fallback:",e?.code||e)}if(!c&&(c=localStorage.getItem("emailForSignIn"))&&console.log("Using localStorage fallback for email retrieval"),!c){g("error"),x("We couldn't verify your email. If you opened this link on a different device, please try again from the original device or request a new link.");return}let d=localStorage.getItem("nameForSignIn"),u=await r(t,c,window.location.href);if(await u.user.reload(),localStorage.removeItem("emailForSignIn"),localStorage.removeItem("nameForSignIn"),u.user){if(d){let{updateProfile:t}=await e.A(3975);await t(u.user,{displayName:d})}let t=await u.user.getIdToken(!0);(0,i.setAuthToken)(t);let a=await fetch("/api/google-auth",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include",body:JSON.stringify({email:u.user.email,username:d||u.user.displayName||u.user.email?.split("@")[0],firebaseUid:u.user.uid})});if(a.ok){let e=await a.json();l.queryClient.setQueryData(["/api/user"],e)}window.dataLayer?.push({event:"registration_complete"}),(0,o.sendAttributionToServer)().catch(()=>{}),(0,o.logConversionEvent)("registration_complete").catch(()=>{}),g("set-password")}}catch(e){console.error("Email link sign-in error:",e),g("error"),"auth/invalid-action-code"===e.code?x("This link has expired or already been used. Please request a new one."):"auth/invalid-email"===e.code?x("The email address is invalid."):x(e.message||"Failed to complete sign-in. Please try again.")}},C=async()=>{if(f.length<8)return void k({title:"Password Too Short",description:"Password must be at least 8 characters",variant:"destructive"});if(f!==v)return void k({title:"Passwords Don't Match",description:"Please make sure your passwords match",variant:"destructive"});N(!0);try{let{auth:t}=await (0,i.loadFirebase)(),{updatePassword:a}=await e.A(3975);t.currentUser&&(await a(t.currentUser,f),(0,h.setNeedsPasswordSetup)(!1),k({title:"Password Set!",description:"You can now log in with your email and password"})),g("success"),setTimeout(()=>{m.push("/app")},2e3)}catch(e){console.error("Set password error:",e),k({title:"Failed to Set Password",description:e.message||"Please try again later",variant:"destructive"}),g("success"),setTimeout(()=>{m.push("/app")},2e3)}finally{N(!1)}};return(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-900 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-black/50 border border-white/10 rounded-xl p-8 max-w-md w-full text-center",children:["loading"===w&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Loader2,{className:"h-12 w-12 text-blue-400 animate-spin mx-auto mb-4"}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:"Verifying..."}),(0,t.jsx)("p",{className:"text-gray-400",children:"Please wait while we complete your sign-in"})]}),"success"===w&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)(n.CheckCircle,{className:"h-8 w-8 text-green-400"})}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:"You're In!"}),(0,t.jsx)("p",{className:"text-gray-400 mb-4",children:"Redirecting you to the app..."}),(0,t.jsx)(c.Loader2,{className:"h-6 w-6 text-blue-400 animate-spin mx-auto"})]}),"set-password"===w&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)(n.CheckCircle,{className:"h-8 w-8 text-blue-400"})}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:"Welcome!"}),(0,t.jsx)("p",{className:"text-gray-400 mb-6",children:"Would you like to set a password for faster logins?"}),(0,t.jsxs)("div",{className:"space-y-4 text-left",children:[(0,t.jsx)("input",{type:"password",placeholder:"New Password (min 8 characters)",className:"w-full p-4 bg-white/10 border border-white/20 rounded-md text-white placeholder-gray-400 focus:outline-none focus:border-blue-300",value:f,onChange:e=>b(e.target.value)}),(0,t.jsx)("input",{type:"password",placeholder:"Confirm Password",className:"w-full p-4 bg-white/10 border border-white/20 rounded-md text-white placeholder-gray-400 focus:outline-none focus:border-blue-300",value:v,onChange:e=>y(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),C())}}),(0,t.jsx)(u.Button,{className:"w-full bg-gradient-to-r from-blue-800 via-indigo-800 to-purple-800 hover:from-blue-700 hover:via-indigo-700 hover:to-purple-700 text-white border-0",onClick:C,disabled:j,children:j?"Setting Password...":"Set Password"}),(0,t.jsx)("button",{onClick:()=>{(0,h.setNeedsPasswordSetup)(!0),g("success"),setTimeout(()=>{m.push("/app")},1500)},className:"w-full text-white/80 hover:text-white text-base font-medium transition-colors py-3 border border-white/20 rounded-md hover:border-white/40 hover:bg-white/5",children:"Skip for now - I'll use magic links"})]})]}),"error"===w&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)(d.XCircle,{className:"h-8 w-8 text-red-400"})}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:"Something Went Wrong"}),(0,t.jsx)("p",{className:"text-gray-400 mb-6",children:p}),(0,t.jsx)(u.Button,{className:"w-full bg-gradient-to-r from-blue-800 via-indigo-800 to-purple-800 hover:from-blue-700 hover:via-indigo-700 hover:to-purple-700 text-white border-0",onClick:()=>m.push("/"),children:"Back to Home"})]})]})})}e.s(["default",()=>m])},27680,e=>{e.n(e.i(56539))}]);