(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,35325,e=>{"use strict";var t=e.i(43476),n=e.i(6625),a=e.i(84589),i=e.i(71645),s=e.i(66027),o=e.i(54616),l=e.i(84923),c=e.i(58260),r=e.i(90639),d=e.i(64659);function u({onAddToPipeline:e,onSelectList:a,onSelectCampaign:i,isPipelineLoading:s=!1}){return(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(n.Button,{variant:"outline",size:"sm",className:"h-6 px-2 text-[11px] font-medium text-gray-600 rounded-r-none border-r-0 hover:bg-gray-50 hover:text-gray-700",onClick:e,disabled:s,title:"Add selected to Pipeline","data-testid":"button-add-to-pipeline",children:s?"Adding...":"Add to Pipeline"}),(0,t.jsxs)(r.DropdownMenu,{children:[(0,t.jsx)(r.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(n.Button,{variant:"outline",size:"sm",className:"h-6 px-1.5 text-[11px] font-medium text-gray-600 rounded-l-none",title:"More add options","data-testid":"dropdown-add-options",children:(0,t.jsx)(d.ChevronDown,{className:"h-3 w-3"})})}),(0,t.jsxs)(r.DropdownMenuContent,{children:[(0,t.jsx)(r.DropdownMenuItem,{onClick:()=>{console.log('[SelectionToolbar] "Contact List" clicked, showing selector'),a()},"data-testid":"menu-item-contact-list",children:"Contact List"}),(0,t.jsx)(r.DropdownMenuItem,{onClick:()=>{console.log('[SelectionToolbar] "Campaign" clicked, showing selector'),i()},"data-testid":"menu-item-campaign",children:"Campaign"})]})]})]})}var m=e.i(67244),x=e.i(20278);function g({value:e,open:n,contactLists:a,onValueChange:i,onOpenChange:s}){return(0,t.jsxs)(m.Select,{value:e,open:n,onValueChange:e=>{console.log("[SelectionToolbar] List value changed:",e),i(e)},onOpenChange:e=>{console.log("[SelectionToolbar] Select open state changed:",e),s(e)},children:[(0,t.jsx)(m.SelectTrigger,{className:"w-[200px]","data-testid":"select-contact-list",children:(0,t.jsx)(m.SelectValue,{placeholder:"Choose a contact list"})}),(0,t.jsx)(m.SelectContent,{className:"z-[100]",children:a.map(e=>(0,t.jsx)(m.SelectItem,{value:e.id.toString(),"data-testid":`select-item-list-${e.id}`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1.5",children:[e.isDefault&&(0,t.jsx)(x.Target,{className:"h-3.5 w-3.5 text-primary"}),e.name]}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground ml-2",children:[e.contactCount," contacts"]})]})},e.id))})]})}function p({value:e,open:n,campaigns:a,onValueChange:i,onOpenChange:s}){return(0,t.jsxs)(m.Select,{value:e,open:n,onValueChange:e=>{console.log("[SelectionToolbar] Campaign value changed:",e),i(e)},onOpenChange:e=>{console.log("[SelectionToolbar] Campaign select open state changed:",e),s(e)},children:[(0,t.jsx)(m.SelectTrigger,{className:"w-[250px]",children:(0,t.jsx)(m.SelectValue,{placeholder:0===a.length?"No active campaigns available":"Choose an active campaign"})}),(0,t.jsx)(m.SelectContent,{className:"z-[100]",children:0===a.length?(0,t.jsx)("div",{className:"p-2 text-sm text-muted-foreground",children:"No active campaigns found. Please create and activate a campaign first."}):a.map(e=>(0,t.jsx)(m.SelectItem,{value:e.id.toString(),children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:e.subject?e.subject.substring(0,50)+"...":"No subject"})]})},e.id))})]})}function h({selectedCount:e,onClear:r,selectedContactIds:d}){let[m,x]=(0,i.useState)(!1),[h,j]=(0,i.useState)(!1),[f,C]=(0,i.useState)(!1),[b,N]=(0,i.useState)(!1),[S,y]=(0,i.useState)(""),[v,D]=(0,i.useState)(""),{toast:T}=(0,c.useToast)(),[w,E]=(0,i.useState)(!1),[A,P]=(0,i.useState)(!1),[O,k]=(0,i.useState)(null),[I,q]=(0,i.useState)(null),[L,K]=(0,i.useState)(0),[B,F]=(0,i.useState)(!1),[M,R]=(0,i.useState)(null);(0,i.useEffect)(()=>{console.log("[SelectionToolbar] Component mounted/updated:",{selectedCount:e,selectedContactIds:d,contactIdCount:d.length})},[e,d]);let{data:$=[]}=(0,s.useQuery)({queryKey:["/api/contact-lists"]}),{data:Q=[]}=(0,s.useQuery)({queryKey:["/api/campaigns"]}),H=Q.filter(e=>"active"===e.status),{data:V=[]}=(0,s.useQuery)({queryKey:["/api/contacts/bulk",d],queryFn:async()=>{if(0===d.length)return[];let e=await fetch("/api/contacts/bulk?"+new URLSearchParams({ids:d.join(",")}));if(!e.ok)throw Error("Failed to fetch contact details");return e.json()},enabled:d.length>0}),z=(0,o.useMutation)({mutationFn:async({contactListId:e,contactIds:t})=>{console.log("[SelectionToolbar] Making API request to add contacts:",{contactListId:e,contactIds:t,endpoint:`/api/contact-lists/${e}/contacts`});let n=await (0,l.apiRequest)("POST",`/api/contact-lists/${e}/contacts`,{contactIds:t}),a=await n.json();return console.log("[SelectionToolbar] API response:",a),a},onSuccess:(e,{contactListId:t})=>{console.log("[SelectionToolbar] Mutation succeeded:",{data:e,contactListId:t}),l.queryClient.invalidateQueries({queryKey:["/api/contact-lists"]}),l.queryClient.invalidateQueries({queryKey:[`/api/contact-lists/${t}/contacts`]}),R({totalSubmitted:d.length,noEmailError:e.noEmailCount||0,duplicationError:e.duplicateCount||0,otherListDuplicateError:e.otherListDuplicateCount||0,successfullyAdded:e.addedCount||0,operationType:"list"}),F(!0),x(!1),y(""),k(null),E(!1)},onError:e=>{console.error("[SelectionToolbar] Mutation failed:",e),T({title:"Error adding contacts",description:e.message||"Failed to add contacts to the list",variant:"destructive"})}}),U=(0,o.useMutation)({mutationFn:async({campaignId:e,contactIds:t})=>{console.log("[SelectionToolbar] Making API request to add contacts to campaign:",{campaignId:e,contactIds:t,endpoint:`/api/campaigns/${e}/add-contacts`});let n=await (0,l.apiRequest)("POST",`/api/campaigns/${e}/add-contacts`,{contactIds:t}),a=await n.json();return console.log("[SelectionToolbar] Campaign API response:",a),a},onSuccess:(e,{campaignId:t})=>{console.log("[SelectionToolbar] Campaign mutation succeeded:",{data:e,campaignId:t}),l.queryClient.invalidateQueries({queryKey:["/api/campaigns"]}),l.queryClient.invalidateQueries({queryKey:[`/api/campaigns/${t}`]}),R({totalSubmitted:d.length,noEmailError:e.noEmailCount||0,duplicationError:e.duplicateCount||0,otherListDuplicateError:0,successfullyAdded:e.addedCount||0,operationType:"campaign"}),F(!0),j(!1),D(""),q(null),P(!1)},onError:e=>{console.error("[SelectionToolbar] Campaign mutation failed:",e),T({title:"Error adding contacts to campaign",description:e.message||"Failed to add contacts to the campaign",variant:"destructive"})}});(0,i.useEffect)(()=>{if(S&&""!==S){let e=parseInt(S);console.log("[SelectionToolbar] Contact list selected:",{selectedContactList:S,listId:e,selectedContactIds:d,contactCount:d.length}),!isNaN(e)&&d.length>0?(K(V.filter(e=>!e.email).length),k(e),E(!0),x(!1)):0===d.length&&(console.warn("[SelectionToolbar] No contacts selected to add"),T({title:"No contacts selected",description:"Please select contacts before adding them to a list.",variant:"destructive"}),y(""),x(!1))}},[S,d,V,T]),(0,i.useEffect)(()=>{if(v&&""!==v){let e=parseInt(v);console.log("[SelectionToolbar] Campaign selected:",{selectedCampaign:v,campaignId:e,selectedContactIds:d,contactCount:d.length}),!isNaN(e)&&d.length>0?(K(V.filter(e=>!e.email).length),q(e),P(!0),j(!1)):0===d.length&&(console.warn("[SelectionToolbar] No contacts selected to add to campaign"),T({title:"No contacts selected",description:"Please select contacts before adding them to a campaign.",variant:"destructive"}),D(""),j(!1))}},[v,d,V,T]);let W=()=>{O&&(console.log("[SelectionToolbar] Confirmed adding to list"),z.mutate({contactListId:O,contactIds:d})),E(!1),k(null),y("")},G=()=>{E(!1),k(null),y("")},J=()=>{I&&(console.log("[SelectionToolbar] Confirmed adding to campaign"),U.mutate({campaignId:I,contactIds:d})),P(!1),q(null),D("")},X=()=>{P(!1),q(null),D("")},Y=$.find(e=>e.isDefault),Z=window.innerWidth<768,_=(0,t.jsx)("div",{className:`flex items-center gap-2 ${Z?"w-full justify-between px-4 py-2 bg-background border-t":""}`,children:m?(0,t.jsx)(g,{value:S,open:f,contactLists:$,onValueChange:e=>{y(e),C(!1),x(!1)},onOpenChange:e=>{C(e),e||S||x(!1)}}):h?(0,t.jsx)(p,{value:v,open:b,campaigns:H,onValueChange:e=>{D(e),N(!1),j(!1)},onOpenChange:e=>{N(e),e||v||j(!1)}}):(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-primary text-[11px] font-medium",children:e}),(0,t.jsx)(u,{onAddToPipeline:()=>{Y?0===d.length?T({title:"No contacts selected",description:"Please select contacts before adding them to Pipeline.",variant:"destructive"}):(console.log("[SelectionToolbar] Adding directly to Pipeline:",{pipelineId:Y.id,contactIds:d}),z.mutate({contactListId:Y.id,contactIds:d})):T({title:"Pipeline not found",description:"Could not find your Pipeline. Please try again.",variant:"destructive"})},onSelectList:()=>{x(!0),C(!0)},onSelectCampaign:()=>{j(!0),N(!0)},isPipelineLoading:z.isPending})]})});return Z?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-40 shadow-lg border-t",children:_}),(0,t.jsx)(a.Dialog,{open:w,onOpenChange:E,children:(0,t.jsxs)(a.DialogContent,{children:[(0,t.jsxs)(a.DialogHeader,{children:[(0,t.jsx)(a.DialogTitle,{children:"Confirm Adding Contacts"}),(0,t.jsxs)(a.DialogDescription,{children:["Adding ",e," contact",1!==e?"s":"",' to "',$.find(e=>e.id===O)?.name,'".']})]}),(0,t.jsxs)(a.DialogFooter,{children:[(0,t.jsx)(n.Button,{variant:"outline",onClick:G,children:"Cancel"}),(0,t.jsx)(n.Button,{onClick:W,children:"OK"})]})]})}),(0,t.jsx)(a.Dialog,{open:A,onOpenChange:P,children:(0,t.jsxs)(a.DialogContent,{children:[(0,t.jsxs)(a.DialogHeader,{children:[(0,t.jsx)(a.DialogTitle,{children:"Confirm Adding Contacts"}),(0,t.jsxs)(a.DialogDescription,{children:["Adding ",e," contact",1!==e?"s":"",' to campaign "',H.find(e=>e.id===I)?.name,'".']})]}),(0,t.jsxs)(a.DialogFooter,{children:[(0,t.jsx)(n.Button,{variant:"outline",onClick:X,children:"Cancel"}),(0,t.jsx)(n.Button,{onClick:J,children:"OK"})]})]})}),(0,t.jsx)(a.Dialog,{open:B,onOpenChange:F,children:(0,t.jsxs)(a.DialogContent,{children:[(0,t.jsxs)(a.DialogHeader,{children:[(0,t.jsx)(a.DialogTitle,{children:"Operation Report"}),(0,t.jsxs)(a.DialogDescription,{children:["Results of adding contacts to ",M?.operationType==="list"?"contact list":"campaign",":"]})]}),(0,t.jsxs)("div",{className:"space-y-2 py-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total contacts submitted:"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:M?.totalSubmitted||0})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"No email error:"}),(0,t.jsx)("span",{className:"text-sm font-medium text-amber-600",children:M?.noEmailError||0})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Duplication error:"}),(0,t.jsx)("span",{className:"text-sm font-medium text-amber-600",children:M?.duplicationError||0})]}),M?.otherListDuplicateError?(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Email in other lists:"}),(0,t.jsx)("span",{className:"text-sm font-medium text-amber-600",children:M.otherListDuplicateError})]}):null,(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Successfully added:"}),(0,t.jsx)("span",{className:"text-sm font-medium text-green-600",children:M?.successfullyAdded||0})]})]}),(0,t.jsx)(a.DialogFooter,{children:(0,t.jsx)(n.Button,{onClick:()=>{F(!1),r()},children:"OK"})})]})})]}):(0,t.jsxs)(t.Fragment,{children:[_,(0,t.jsx)(a.Dialog,{open:w,onOpenChange:E,children:(0,t.jsxs)(a.DialogContent,{children:[(0,t.jsxs)(a.DialogHeader,{children:[(0,t.jsx)(a.DialogTitle,{children:"Confirm Adding Contacts"}),(0,t.jsxs)(a.DialogDescription,{children:["Adding ",e," contact",1!==e?"s":"",' to "',$.find(e=>e.id===O)?.name,'".']})]}),(0,t.jsxs)(a.DialogFooter,{children:[(0,t.jsx)(n.Button,{variant:"outline",onClick:G,children:"Cancel"}),(0,t.jsx)(n.Button,{onClick:W,children:"OK"})]})]})}),(0,t.jsx)(a.Dialog,{open:A,onOpenChange:P,children:(0,t.jsxs)(a.DialogContent,{children:[(0,t.jsxs)(a.DialogHeader,{children:[(0,t.jsx)(a.DialogTitle,{children:"Confirm Adding Contacts"}),(0,t.jsxs)(a.DialogDescription,{children:["Adding ",e," contact",1!==e?"s":"",' to campaign "',H.find(e=>e.id===I)?.name,'".']})]}),(0,t.jsxs)(a.DialogFooter,{children:[(0,t.jsx)(n.Button,{variant:"outline",onClick:X,children:"Cancel"}),(0,t.jsx)(n.Button,{onClick:J,children:"OK"})]})]})}),(0,t.jsx)(a.Dialog,{open:B,onOpenChange:F,children:(0,t.jsxs)(a.DialogContent,{children:[(0,t.jsxs)(a.DialogHeader,{children:[(0,t.jsx)(a.DialogTitle,{children:"Operation Report"}),(0,t.jsxs)(a.DialogDescription,{children:["Results of adding contacts to ",M?.operationType==="list"?"contact list":"campaign",":"]})]}),(0,t.jsxs)("div",{className:"space-y-2 py-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total contacts submitted:"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:M?.totalSubmitted||0})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"No email error:"}),(0,t.jsx)("span",{className:"text-sm font-medium text-amber-600",children:M?.noEmailError||0})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Duplication error:"}),(0,t.jsx)("span",{className:"text-sm font-medium text-amber-600",children:M?.duplicationError||0})]}),M?.otherListDuplicateError?(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Email in other lists:"}),(0,t.jsx)("span",{className:"text-sm font-medium text-amber-600",children:M.otherListDuplicateError})]}):null,(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Successfully added:"}),(0,t.jsx)("span",{className:"text-sm font-medium text-green-600",children:M?.successfullyAdded||0})]})]}),(0,t.jsx)(a.DialogFooter,{children:(0,t.jsx)(n.Button,{onClick:()=>F(!1),children:"OK"})})]})})]})}e.s(["SelectionToolbar",()=>h],35325)}]);