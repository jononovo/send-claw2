(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,47582,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(18566),i=e.i(22016),n=e.i(66027),l=e.i(54616),r=e.i(84923),d=e.i(58260),c=e.i(6625),m=e.i(4766),o=e.i(38785),x=e.i(37014),u=e.i(92590),p=e.i(90639),h=e.i(84589),j=e.i(38263),g=e.i(32076),v=e.i(71689),f=e.i(63488),N=e.i(96112),b=e.i(75254);let y=(0,b.default)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);var w=e.i(63209),C=e.i(98962),k=e.i(31343),R=e.i(95242),T=e.i(39616),S=e.i(86536),A=e.i(64659),D=e.i(27612),M=e.i(39312);let E=(0,b.default)("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]);var B=e.i(16715),q=e.i(43531),_=e.i(37727),I=e.i(45919),F=e.i(52301),P=e.i(14764),O=e.i(3116);let U=(0,b.default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function L({steps:e,totalRecipients:t,className:a}){let i=({value:e,rate:t,label:a,icon:i,iconColor:n})=>(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mb-1",children:[(0,s.jsx)(i,{className:(0,F.cn)("h-3 w-3",n)}),(0,s.jsx)("span",{children:a})]}),(0,s.jsx)("div",{className:"text-lg font-semibold",children:e}),void 0!==t&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[t,"%"]})]});return(0,s.jsxs)(m.Card,{className:(0,F.cn)("",a),children:[(0,s.jsx)(m.CardHeader,{children:(0,s.jsxs)(m.CardTitle,{className:"text-lg flex items-center justify-between",children:[(0,s.jsx)("span",{children:"Campaign Progress"}),(0,s.jsxs)(o.Badge,{variant:"outline",className:"font-normal",children:[t," recipients"]})]})}),(0,s.jsx)(m.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-7 gap-2 pb-2 border-b",children:[(0,s.jsx)("div",{className:"col-span-2"}),(0,s.jsx)("div",{className:"text-center text-sm font-medium text-muted-foreground",children:"Sent"}),(0,s.jsx)("div",{className:"text-center text-sm font-medium text-muted-foreground",children:"Opens"}),(0,s.jsx)("div",{className:"text-center text-sm font-medium text-muted-foreground",children:"Clicks"}),(0,s.jsx)("div",{className:"text-center text-sm font-medium text-muted-foreground",children:"Replies"}),(0,s.jsx)("div",{className:"text-center text-sm font-medium text-muted-foreground",children:"Unsubscribes"})]}),e.map(e=>(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"grid grid-cols-7 gap-2 items-center",children:[(0,s.jsxs)("div",{className:"col-span-2 space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"completed":return(0,s.jsx)(U,{className:"h-4 w-4 text-green-500"});case"in_progress":return(0,s.jsx)(O.Clock,{className:"h-4 w-4 text-blue-500 animate-pulse"});case"pending":return(0,s.jsx)(O.Clock,{className:"h-4 w-4 text-gray-400"})}})(e.status),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium text-sm",children:["Step ",e.stepNumber]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:e.name})]})]}),e.condition&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground ml-6",children:e.condition}),e.triggeredAt&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground ml-6",children:(0,I.format)(new Date(e.triggeredAt),"MMM d, h:mm a")})]}),(0,s.jsx)(i,{value:e.sent,label:"",icon:P.Send,iconColor:"text-gray-500"}),(0,s.jsx)(i,{value:e.opens,rate:e.openRate,label:"",icon:S.Eye,iconColor:"text-yellow-500"}),(0,s.jsx)(i,{value:e.clicks,rate:e.clickRate,label:"",icon:N.MousePointer,iconColor:"text-green-500"}),(0,s.jsx)(i,{value:e.replies,rate:e.replyRate,label:"",icon:y,iconColor:"text-blue-500"}),(0,s.jsx)(i,{value:e.unsubscribes,rate:e.unsubscribeRate,label:"",icon:C.UserX,iconColor:"text-red-500"})]}),"in_progress"===e.status&&e.sent<t&&(0,s.jsx)("div",{className:"ml-6 mr-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(x.Progress,{value:e.sent/t*100,className:"flex-1 h-1.5"}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:[(e.sent/t*100).toFixed(0),"%"]})]})})]},e.stepNumber)),0===e.length&&(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(O.Clock,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),(0,s.jsx)("p",{className:"text-sm",children:"Campaign not started yet"})]})]})})]})}var H=e.i(13853);let $=({recipients:e,showError:t=!1,errorMessage:a})=>{let i=e=>e?(0,I.format)(new Date(e),"MMM d, h:mm a"):"-";return 0===e.length?(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(f.Mail,{className:"h-8 w-8 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{children:"No recipients found"})]}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full border-collapse",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left p-3 font-medium",children:"Recipient"}),(0,s.jsx)("th",{className:"text-left p-3 font-medium",children:"Company"}),(0,s.jsx)("th",{className:"text-left p-3 font-medium",children:"Status"}),(0,s.jsx)("th",{className:"text-left p-3 font-medium",children:"Events"}),t&&(0,s.jsx)("th",{className:"text-left p-3 font-medium",children:"Error"})]})}),(0,s.jsx)("tbody",{children:e.map(e=>(0,s.jsxs)("tr",{className:"border-b hover:bg-muted/30 transition-colors",children:[(0,s.jsx)("td",{className:"p-3",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium",children:[e.firstName," ",e.lastName]}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.email})]})}),(0,s.jsx)("td",{className:"p-3",children:(0,s.jsx)("span",{className:"text-sm",children:e.companyName})}),(0,s.jsx)("td",{className:"p-3",children:(e=>{if(e.repliedAt)return(0,s.jsx)(o.Badge,{className:"bg-blue-500 text-white",children:"Replied"});if(e.clickedAt)return(0,s.jsx)(o.Badge,{className:"bg-green-500 text-white",children:"Clicked"});if(e.openedAt)return(0,s.jsx)(o.Badge,{className:"bg-yellow-500 text-white",children:"Opened"});if(e.bouncedAt)return(0,s.jsx)(o.Badge,{variant:"destructive",children:"Bounced"});if(e.unsubscribedAt)return(0,s.jsx)(o.Badge,{variant:"secondary",children:"Unsubscribed"});if(e.sentAt)return(0,s.jsx)(o.Badge,{variant:"outline",children:"Sent"});switch(e.status){case"queued":case"scheduled":return(0,s.jsx)(o.Badge,{variant:"secondary",children:"Queued"});case"sent":return(0,s.jsx)(o.Badge,{variant:"outline",children:"Sent"});case"manual_send_required":return(0,s.jsx)(o.Badge,{className:"bg-yellow-500 text-white",children:"Manual Send Required"});case"failed_generation":return(0,s.jsx)(o.Badge,{variant:"destructive",children:"Failed Generation"});case"failed_send":return(0,s.jsx)(o.Badge,{variant:"destructive",children:"Failed Send"});case"in_review":return(0,s.jsx)(o.Badge,{children:"In Review"});default:return(0,s.jsx)(o.Badge,{variant:"secondary",children:"Pending"})}})(e)}),(0,s.jsx)("td",{className:"p-3",children:(0,s.jsxs)("div",{className:"text-sm space-y-1",children:[e.sentAt&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(f.Mail,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:["Sent: ",i(e.sentAt)]})]}),e.openedAt&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-yellow-600 dark:text-yellow-400",children:[(0,s.jsx)(S.Eye,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:["Opened: ",i(e.openedAt)]})]}),e.clickedAt&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-green-600 dark:text-green-400",children:[(0,s.jsx)(N.MousePointer,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:["Clicked: ",i(e.clickedAt)]})]}),e.repliedAt&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-blue-600 dark:text-blue-400",children:[(0,s.jsx)(y,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:["Replied: ",i(e.repliedAt)]})]}),e.bouncedAt&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-red-600 dark:text-red-400",children:[(0,s.jsx)(w.AlertCircle,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:["Bounced: ",i(e.bouncedAt)]})]}),e.unsubscribedAt&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-gray-600 dark:text-gray-400",children:[(0,s.jsx)(C.UserX,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:["Unsubscribed: ",i(e.unsubscribedAt)]})]}),!e.sentAt&&!e.openedAt&&!e.clickedAt&&!e.repliedAt&&!e.bouncedAt&&!e.unsubscribedAt&&(0,s.jsx)("span",{className:"text-muted-foreground",children:"No activity yet"})]})}),t&&(0,s.jsx)("td",{className:"p-3",children:"failed_generation"===e.status||"failed_send"===e.status?(0,s.jsx)("span",{className:"text-sm text-red-600 dark:text-red-400",children:"failed_generation"===e.status?"Generation failed":"Send failed"}):(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"-"})})]},e.id))})]})})};function z(){var e;let b,P,O=(0,a.useParams)().id,U=(0,a.useRouter)(),{toast:z}=(0,d.useToast)(),[Q,G]=(0,t.useState)(!1),[K,X]=(0,t.useState)(!1),[V,Y]=(0,t.useState)(!1),[J,W]=(0,t.useState)("failed"),[Z,ee]=(0,t.useState)(new Date),{data:es,isLoading:et,error:ea,refetch:ei}=(0,n.useQuery)({queryKey:["/api/campaigns",O],enabled:!!O,refetchOnWindowFocus:!1});(0,t.useEffect)(()=>{if(!O)return;let e=null,s=()=>{e&&clearInterval(e),e=setInterval(()=>{"visible"===document.visibilityState&&(console.log("Auto-refreshing campaign data..."),ei(),ee(new Date))},2e4)},t=()=>{"visible"===document.visibilityState?(console.log("Page became visible, refreshing campaign data"),ei(),ee(new Date),s()):(console.log("Page became hidden, pausing auto-refresh"),e&&(clearInterval(e),e=null))};return"visible"===document.visibilityState&&s(),document.addEventListener("visibilitychange",t),()=>{e&&clearInterval(e),document.removeEventListener("visibilitychange",t)}},[O,ei,ee]);let en=(0,l.useMutation)({mutationFn:async e=>(0,r.apiRequest)("PUT",`/api/campaigns/${O}`,e),onSuccess:()=>{r.queryClient.invalidateQueries({queryKey:["/api/campaigns"]}),z({title:"Campaign updated",description:"Your campaign has been updated successfully."})},onError:e=>{z({title:"Error",description:e.message||"Failed to update campaign",variant:"destructive"})}}),el=(0,l.useMutation)({mutationFn:async()=>(0,r.apiRequest)("DELETE",`/api/campaigns/${O}`),onSuccess:()=>{z({title:"Campaign deleted",description:"Your campaign has been deleted successfully."}),U.push("/campaigns")},onError:e=>{z({title:"Error",description:e.message||"Failed to delete campaign",variant:"destructive"})}}),er=(0,l.useMutation)({mutationFn:async e=>(0,r.apiRequest)("POST",`/api/campaigns/${O}/restart`,{mode:e}),onSuccess:(e,s)=>{r.queryClient.invalidateQueries({queryKey:["/api/campaigns"]}),r.queryClient.invalidateQueries({queryKey:["/api/campaigns",O]}),Y(!1),z({title:"Campaign restarted",description:"all"===s?"The campaign will re-send to all recipients.":"The campaign will queue failed recipients for retry."})},onError:e=>{z({title:"Error",description:e.message||"Failed to restart campaign",variant:"destructive"})}}),ed=async(e,s)=>{try{await (0,r.apiRequest)("POST",`/api/campaigns/${e}/review/approve`,{recipientIds:s}),r.queryClient.invalidateQueries({queryKey:["/api/campaigns",e]}),z({title:"Emails approved",description:`${s.length} emails approved for sending`})}catch(e){z({title:"Error",description:"Failed to approve emails",variant:"destructive"})}},ec=async(e,s)=>{try{await (0,r.apiRequest)("POST",`/api/campaigns/${e}/review/reject`,{recipientIds:s}),r.queryClient.invalidateQueries({queryKey:["/api/campaigns",e]}),z({title:"Emails rejected",description:`${s.length} emails will be regenerated`})}catch(e){z({title:"Error",description:"Failed to reject emails",variant:"destructive"})}},em=async(e,s)=>{await ed(e,[s])},eo=async(e,s)=>{await ec(e,[s])},ex=async e=>{try{await (0,r.apiRequest)(`/api/campaigns/${e}/retry-failed`,"POST"),r.queryClient.invalidateQueries({queryKey:["/api/campaigns",e]}),z({title:"Retrying failed emails",description:"Failed emails are being retried"})}catch(e){z({title:"Error",description:"Failed to retry emails",variant:"destructive"})}},eu=async e=>{switch(e){case"pause":en.mutate({status:"paused"});break;case"resume":case"activate":en.mutate({status:"active"});break;case"stop":confirm("Are you sure you want to stop this campaign? This will permanently halt all sending.")&&en.mutate({status:"completed"});break;case"restart":Y(!0);break;case"edit":G(!0),z({title:"Edit mode",description:"You can now edit the campaign settings."});break;case"delete":confirm("Are you sure you want to delete this campaign? This action cannot be undone.")&&el.mutate()}};if(et)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading campaign details..."})]})});if(ea||!es)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(w.AlertCircle,{className:"mx-auto h-12 w-12 text-destructive"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-semibold",children:"Campaign not found"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"The campaign you're looking for doesn't exist or has been deleted."}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(i.default,{href:"/campaigns",children:(0,s.jsxs)(c.Button,{variant:"outline",children:[(0,s.jsx)(v.ArrowLeft,{className:"mr-2 h-4 w-4"}),"Back to campaigns"]})})})]})});let ep=({icon:e,label:t,value:a,percentage:i,color:n="text-foreground"})=>(0,s.jsxs)("div",{className:"flex flex-col items-center p-4 rounded-lg bg-muted/30",children:[(0,s.jsx)(e,{className:(0,F.cn)("h-8 w-8 mb-2",n)}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:t}),(0,s.jsx)("div",{className:"text-2xl font-bold",children:a}),void 0!==i&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[i.toFixed(1),"%"]})]});return(0,s.jsxs)("div",{className:"container mx-auto py-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(i.default,{href:"/campaigns",children:(0,s.jsx)(c.Button,{variant:"ghost",size:"icon",children:(0,s.jsx)(v.ArrowLeft,{className:"h-4 w-4"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:es.name}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[es.createdAt&&(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Created ",(0,I.format)(new Date(es.createdAt),"MMM d, yyyy")]}),es.startDate&&(0,s.jsxs)(s.Fragment,{children:[es.createdAt&&(0,s.jsx)("span",{className:"text-muted-foreground",children:"•"}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["completed"===es.status?"Ended":"Started"," ",(0,I.format)(new Date(es.startDate),"MMM d, yyyy")]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(e=es.status,P=(b={draft:{label:"Draft",variant:"secondary",className:""},scheduled:{label:"Scheduled",variant:"default",className:""},active:{label:"Active",variant:"default",className:"bg-green-500 hover:bg-green-600"},paused:{label:"Paused",variant:"secondary",className:"bg-yellow-500 hover:bg-yellow-600"},stopped:{label:"Stopped",variant:"destructive",className:""},completed:{label:"Completed",variant:"secondary",className:""},cancelled:{label:"Cancelled",variant:"destructive",className:""}})[e]||b.draft,(0,s.jsx)(o.Badge,{variant:P.variant,className:(0,F.cn)(P.className),children:P.label})),(0,s.jsxs)(p.DropdownMenu,{children:[(0,s.jsx)(p.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsxs)(c.Button,{variant:"outline","data-testid":"button-campaign-actions",children:["Actions",(0,s.jsx)(A.ChevronDown,{className:"h-4 w-4 ml-2"})]})}),(0,s.jsxs)(p.DropdownMenuContent,{align:"end",className:"w-48",children:["active"===es.status?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(p.DropdownMenuItem,{onClick:()=>eu("pause"),className:"text-orange-600 dark:text-orange-400","data-testid":"menu-pause-campaign",children:[(0,s.jsx)(R.Pause,{className:"h-4 w-4 mr-2"}),"Pause Campaign"]}),(0,s.jsxs)(p.DropdownMenuItem,{onClick:()=>eu("stop"),className:"text-red-600 dark:text-red-400","data-testid":"menu-stop-campaign",children:[(0,s.jsx)(E,{className:"h-4 w-4 mr-2"}),"Stop Campaign"]})]}):"paused"===es.status?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(p.DropdownMenuItem,{onClick:()=>eu("resume"),className:"text-green-600 dark:text-green-400","data-testid":"menu-resume-campaign",children:[(0,s.jsx)(k.Play,{className:"h-4 w-4 mr-2"}),"Resume Campaign"]}),(0,s.jsxs)(p.DropdownMenuItem,{onClick:()=>eu("stop"),className:"text-red-600 dark:text-red-400","data-testid":"menu-stop-campaign",children:[(0,s.jsx)(E,{className:"h-4 w-4 mr-2"}),"Stop Campaign"]})]}):"stopped"===es.status||"completed"===es.status?(0,s.jsxs)(p.DropdownMenuItem,{onClick:()=>eu("restart"),className:"text-blue-600 dark:text-blue-400","data-testid":"menu-restart-campaign",children:[(0,s.jsx)(B.RefreshCw,{className:"h-4 w-4 mr-2"}),"Restart Campaign"]}):null,(0,s.jsxs)(p.DropdownMenuItem,{onClick:()=>eu("edit"),"data-testid":"menu-edit-campaign",children:[(0,s.jsx)(T.Settings,{className:"h-4 w-4 mr-2"}),"Edit Settings"]}),"draft"===es.status&&(0,s.jsxs)(p.DropdownMenuItem,{onClick:()=>eu("activate"),className:"text-blue-600 dark:text-blue-400","data-testid":"menu-activate-campaign",children:[(0,s.jsx)(M.Zap,{className:"h-4 w-4 mr-2"}),"Activate Campaign"]}),(0,s.jsx)(p.DropdownMenuSeparator,{}),(0,s.jsxs)(p.DropdownMenuItem,{onClick:()=>eu("delete"),className:"text-red-600 dark:text-red-400","data-testid":"menu-delete-campaign",children:[(0,s.jsx)(D.Trash2,{className:"h-4 w-4 mr-2"}),"Delete Campaign"]})]})]})]})]}),"draft"!==es.status&&(0,s.jsx)(L,{steps:[{stepNumber:1,name:"Initial Email",description:"Sent at campaign creation",sent:es.emailsSent,opens:es.emailsOpened,openRate:es.openRate||0,clicks:es.emailsClicked,clickRate:es.clickRate||0,replies:es.emailsReplied,replyRate:es.replyRate||0,unsubscribes:es.emailsUnsubscribed,unsubscribeRate:es.unsubscribeRate||0,triggeredAt:es.startDate?new Date(es.startDate):void 0,status:es.emailsSent===es.totalRecipients?"completed":"active"===es.status?"in_progress":"pending"}],totalRecipients:es.totalRecipients}),(0,s.jsxs)(m.Card,{children:[(0,s.jsxs)(m.CardHeader,{children:[(0,s.jsxs)(m.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(S.Eye,{className:"h-5 w-5"}),"Overview"]}),(0,s.jsx)(m.CardDescription,{children:"Campaign performance at a glance"})]}),(0,s.jsx)(m.CardContent,{children:(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,s.jsx)(ep,{icon:f.Mail,label:"Emails sent",value:es.emailsSent,color:"text-pink-500"}),(0,s.jsx)(ep,{icon:S.Eye,label:"Opens",value:es.emailsOpened,percentage:es.openRate,color:"text-yellow-500"}),(0,s.jsx)(ep,{icon:N.MousePointer,label:"Clicks",value:es.emailsClicked,percentage:es.clickRate,color:"text-green-500"}),(0,s.jsx)(ep,{icon:y,label:"Replied",value:es.emailsReplied,percentage:es.replyRate,color:"text-blue-500"}),(0,s.jsx)(ep,{icon:w.AlertCircle,label:"Bounces",value:es.emailsBounced,percentage:es.bounceRate,color:"text-red-500"}),(0,s.jsx)(ep,{icon:C.UserX,label:"Unsubscribes",value:es.emailsUnsubscribed,percentage:es.unsubscribeRate,color:"text-gray-500"})]})})]}),(0,s.jsxs)(u.Tabs,{defaultValue:"details",className:"space-y-4",children:[(0,s.jsxs)(u.TabsList,{children:[(0,s.jsx)(u.TabsTrigger,{value:"details",children:"Campaign Details"}),(0,s.jsxs)(u.TabsTrigger,{value:"recipients",children:["Recipients (",es.totalRecipients,")"]}),(0,s.jsxs)(u.TabsTrigger,{value:"review",children:["Review Queue ",es.reviewCount&&es.reviewCount>0&&`(${es.reviewCount})`]}),(0,s.jsx)(u.TabsTrigger,{value:"activity",children:"Activity Timeline"})]}),(0,s.jsx)(u.TabsContent,{value:"details",className:"space-y-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)(m.Card,{children:[(0,s.jsx)(m.CardHeader,{children:(0,s.jsx)(m.CardTitle,{className:"text-lg",children:"Campaign Settings"})}),(0,s.jsxs)(m.CardContent,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Contact List"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:es.contactListName||"Not specified"})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total recipients"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:es.totalRecipients})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Sending progress"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(x.Progress,{value:es.emailsSent/es.totalRecipients*100,className:"w-24 h-2"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[(es.emailsSent/es.totalRecipients*100).toFixed(0),"%"]})]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Generation type"}),(0,s.jsx)(o.Badge,{variant:"outline",children:"ai_unique"===es.generationType?"AI Unique":"Template"})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Human review"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:es.requiresHumanReview?"Enabled":"Disabled"})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Tracking"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:es.trackEmails?"Enabled":"Disabled"})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Unsubscribe link"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:es.unsubscribeLink?"Enabled":"Disabled"})]}),es.startDate&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Start date/time"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:(0,I.format)(new Date(es.startDate),"MMM d, yyyy h:mm a")})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Autopilot"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:es.autopilotEnabled?"Enabled":"Disabled"})]}),es.autopilotEnabled&&es.autopilotSettings&&(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Sending schedule"}),(0,s.jsx)(c.Button,{variant:"link",size:"sm",className:"h-auto p-0 text-sm font-medium",onClick:()=>X(!0),children:"View Schedule"})]}),es.autopilotEnabled&&es.timezone&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Timezone"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:es.timezone})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Daily cap"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:["Max ",es.maxEmailsPerDay||20," emails/day"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Email delay"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[es.delayBetweenEmails||0," ",1===es.delayBetweenEmails?"minute":"minutes"," between emails"]})]})]})]}),(0,s.jsxs)(m.Card,{children:[(0,s.jsx)(m.CardHeader,{children:(0,s.jsx)(m.CardTitle,{className:"text-lg",children:"Email Template"})}),(0,s.jsx)(m.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Subject"}),(0,s.jsx)("div",{className:"text-sm font-medium p-2 bg-muted rounded",children:es.emailSubject||"No subject set"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Body Preview"}),(0,s.jsx)("div",{className:"text-sm p-2 bg-muted rounded max-h-48 overflow-y-auto whitespace-pre-wrap",children:es.emailBody?es.emailBody.substring(0,300)+(es.emailBody.length>300?"...":""):"No email body set"})]})]})})]})]})}),(0,s.jsx)(u.TabsContent,{value:"recipients",children:(0,s.jsxs)(m.Card,{children:[(0,s.jsxs)(m.CardHeader,{children:[(0,s.jsx)(m.CardTitle,{children:"Campaign Recipients"}),(0,s.jsx)(m.CardDescription,{children:"Track engagement for each recipient"})]}),(0,s.jsx)(m.CardContent,{children:(0,s.jsxs)(u.Tabs,{defaultValue:"all",className:"mb-4",children:[(0,s.jsxs)(u.TabsList,{className:"grid w-full grid-cols-6",children:[(0,s.jsxs)(u.TabsTrigger,{value:"all",children:["All (",es.recipients?.length||0,")"]}),(0,s.jsxs)(u.TabsTrigger,{value:"queued",children:["Queued (",es.recipients?.filter(e=>"queued"===e.status||"scheduled"===e.status).length||0,")"]}),(0,s.jsxs)(u.TabsTrigger,{value:"sent",children:["Sent (",es.recipients?.filter(e=>"sent"===e.status).length||0,")"]}),(0,s.jsxs)(u.TabsTrigger,{value:"manual",children:["Manual (",es.recipients?.filter(e=>"manual_send_required"===e.status).length||0,")"]}),(0,s.jsxs)(u.TabsTrigger,{value:"engaged",children:["Engaged (",es.recipients?.filter(e=>e.openedAt||e.clickedAt||e.repliedAt).length||0,")"]}),(0,s.jsxs)(u.TabsTrigger,{value:"failed",children:["Failed (",es.recipients?.filter(e=>"failed_generation"===e.status||"failed_send"===e.status).length||0,")"]})]}),(0,s.jsx)(u.TabsContent,{value:"all",className:"mt-4",children:(0,s.jsx)($,{recipients:es.recipients||[]})}),(0,s.jsx)(u.TabsContent,{value:"queued",className:"mt-4",children:(0,s.jsx)($,{recipients:es.recipients?.filter(e=>"queued"===e.status||"scheduled"===e.status)||[]})}),(0,s.jsx)(u.TabsContent,{value:"sent",className:"mt-4",children:(0,s.jsx)($,{recipients:es.recipients?.filter(e=>"sent"===e.status)||[]})}),(0,s.jsx)(u.TabsContent,{value:"engaged",className:"mt-4",children:(0,s.jsx)($,{recipients:es.recipients?.filter(e=>e.openedAt||e.clickedAt||e.repliedAt)||[]})}),(0,s.jsx)(u.TabsContent,{value:"manual",className:"mt-4",children:(0,s.jsx)("div",{className:"space-y-4",children:es.recipients?.filter(e=>"manual_send_required"===e.status).length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(w.AlertCircle,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-medium text-yellow-800 dark:text-yellow-300",children:"Manual Send Required"}),(0,s.jsx)("p",{className:"text-sm text-yellow-700 dark:text-yellow-400 mt-1",children:"Gmail is not connected for automatic sending. You'll need to send these emails manually."}),(0,s.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,s.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>window.open("/api/gmail/auth?userId=1","_blank"),children:"Connect Gmail"}),(0,s.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>{let e=es.recipients?.filter(e=>"manual_send_required"===e.status)||[];if(e.length>0){let s=e[0],t=`https://mail.google.com/mail/?view=cm&to=${encodeURIComponent(s.email)}&su=${encodeURIComponent(s.emailSubject||"")}&body=${encodeURIComponent(s.emailContent||"")}`;window.open(t,"_blank")}},children:"Open in Gmail"})]})]})]})}),(0,s.jsx)($,{recipients:es.recipients?.filter(e=>"manual_send_required"===e.status)||[]})]}):(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(q.Check,{className:"h-8 w-8 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{children:"No manual sends required"}),(0,s.jsx)("p",{className:"text-sm mt-1",children:"All emails are being sent automatically"})]})})}),(0,s.jsx)(u.TabsContent,{value:"failed",className:"mt-4",children:(0,s.jsx)("div",{className:"space-y-4",children:es.recipients?.filter(e=>"failed_generation"===e.status||"failed_send"===e.status).length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)(c.Button,{variant:"outline",size:"sm",onClick:()=>ex(es.id),children:[(0,s.jsx)(B.RefreshCw,{className:"h-4 w-4 mr-1"}),"Retry Failed"]})}),(0,s.jsx)($,{recipients:es.recipients?.filter(e=>"failed_generation"===e.status||"failed_send"===e.status)||[],showError:!0})]}):(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(q.Check,{className:"h-8 w-8 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{children:"No failed recipients"}),(0,s.jsx)("p",{className:"text-sm mt-1",children:"All emails processed successfully"})]})})})]})})]})}),(0,s.jsx)(u.TabsContent,{value:"review",children:(0,s.jsxs)(m.Card,{children:[(0,s.jsxs)(m.CardHeader,{children:[(0,s.jsx)(m.CardTitle,{children:"Email Review Queue"}),(0,s.jsx)(m.CardDescription,{children:"Review and approve generated emails before sending"})]}),(0,s.jsx)(m.CardContent,{children:es.recipientsInReview&&es.recipientsInReview.length>0?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex gap-2 justify-end pb-4 border-b",children:[(0,s.jsxs)(c.Button,{variant:"outline",onClick:()=>ec(es.id,es.recipientsInReview.map(e=>e.id)),children:[(0,s.jsx)(_.X,{className:"h-4 w-4 mr-1"}),"Reject All"]}),(0,s.jsxs)(c.Button,{onClick:()=>ed(es.id,es.recipientsInReview.map(e=>e.id)),children:[(0,s.jsx)(q.Check,{className:"h-4 w-4 mr-1"}),"Approve All"]})]}),(0,s.jsx)("div",{className:"space-y-4",children:es.recipientsInReview.slice(0,3).map(e=>(0,s.jsxs)("div",{className:"border rounded-lg p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium",children:["To: ",e.firstName," ",e.lastName]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.email," • ",e.companyName]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(c.Button,{size:"sm",variant:"outline",onClick:()=>eo(es.id,e.id),children:(0,s.jsx)(_.X,{className:"h-3 w-3"})}),(0,s.jsx)(c.Button,{size:"sm",onClick:()=>em(es.id,e.id),children:(0,s.jsx)(q.Check,{className:"h-3 w-3"})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Subject"}),(0,s.jsx)("div",{className:"text-sm font-medium p-2 bg-muted rounded",children:e.emailSubject})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Body"}),(0,s.jsx)("div",{className:"text-sm p-3 bg-muted rounded max-h-48 overflow-y-auto",dangerouslySetInnerHTML:{__html:e.emailContent||""}})]})]})]},e.id))}),es.recipientsInReview.length>3&&(0,s.jsxs)("div",{className:"text-center text-sm text-muted-foreground pt-2",children:["Showing 3 of ",es.recipientsInReview.length," emails for review"]})]}):(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(f.Mail,{className:"h-8 w-8 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{children:"No emails pending review"}),(0,s.jsx)("p",{className:"text-sm mt-1",children:"Emails will appear here after generation"})]})})]})}),(0,s.jsx)(u.TabsContent,{value:"activity",children:(0,s.jsxs)(m.Card,{children:[(0,s.jsxs)(m.CardHeader,{children:[(0,s.jsx)(m.CardTitle,{children:"Activity Timeline"}),(0,s.jsx)(m.CardDescription,{children:"Recent campaign events and batch history"})]}),(0,s.jsx)(m.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex gap-4 items-start",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500 mt-2"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"Campaign started"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:es.startDate?(0,I.format)(new Date(es.startDate),"MMM d, h:mm a"):"Not started"})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Campaign activated and ready to send emails"})]})]}),es.emailsSent>0&&(0,s.jsxs)("div",{className:"flex gap-4 items-start",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full bg-blue-500 mt-2"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"Batch sent"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Today"})]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Sent ",es.emailsSent," emails to recipients"]})]})]}),es.emailsOpened>0&&(0,s.jsxs)("div",{className:"flex gap-4 items-start",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full bg-purple-500 mt-2"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"Recipients engaged"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Ongoing"})]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[es.emailsOpened," opens, ",es.emailsClicked," clicks recorded"]})]})]}),"paused"===es.status&&(0,s.jsxs)("div",{className:"flex gap-4 items-start",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full bg-yellow-500 mt-2"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"Campaign paused"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:es.updatedAt?(0,I.format)(new Date(es.updatedAt),"MMM d, h:mm a"):"Recently"})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Campaign temporarily paused"})]})]}),"completed"===es.status&&(0,s.jsxs)("div",{className:"flex gap-4 items-start",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full bg-gray-500 mt-2"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"Campaign completed"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:es.endDate?(0,I.format)(new Date(es.endDate),"MMM d, h:mm a"):"Recently"})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"All scheduled emails have been sent"})]})]}),(!es.emailsSent||0===es.emailsSent)&&"completed"!==es.status&&(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No activity yet. Campaign will start sending emails based on schedule."})]})})]})})]}),es&&es.autopilotSettings&&(0,s.jsx)(H.AutopilotModal,{open:K,onOpenChange:X,settings:"string"==typeof es.autopilotSettings?JSON.parse(es.autopilotSettings):es.autopilotSettings,onApply:async e=>{await en.mutateAsync({autopilotSettings:e}),X(!1),z({title:"Schedule Updated",description:"Campaign autopilot schedule has been updated successfully."})},totalEmails:es.totalRecipients||100}),(0,s.jsx)(h.Dialog,{open:V,onOpenChange:Y,children:(0,s.jsxs)(h.DialogContent,{className:"sm:max-w-md",children:[(0,s.jsxs)(h.DialogHeader,{children:[(0,s.jsx)(h.DialogTitle,{children:"Restart Campaign"}),(0,s.jsx)(h.DialogDescription,{children:"Choose how you want to restart this campaign"})]}),(0,s.jsx)("div",{className:"grid gap-4 py-4",children:(0,s.jsxs)(j.RadioGroup,{value:J,onValueChange:e=>W(e),children:[(0,s.jsxs)("div",{className:"flex items-start space-x-3 space-y-0",children:[(0,s.jsx)(j.RadioGroupItem,{value:"failed",id:"failed",className:"mt-1"}),(0,s.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,s.jsx)(g.Label,{htmlFor:"failed",className:"cursor-pointer",children:"Only queue failed recipients"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Re-queue recipients whose emails failed to send or generate"})]})]}),(0,s.jsxs)("div",{className:"flex items-start space-x-3 space-y-0 mt-4",children:[(0,s.jsx)(j.RadioGroupItem,{value:"all",id:"all",className:"mt-1"}),(0,s.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,s.jsx)(g.Label,{htmlFor:"all",className:"cursor-pointer",children:"Resend to all campaign recipients"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Start over and re-send emails to everyone in the campaign"})]})]})]})}),(0,s.jsxs)(h.DialogFooter,{children:[(0,s.jsx)(c.Button,{variant:"outline",onClick:()=>Y(!1),children:"Cancel"}),(0,s.jsx)(c.Button,{onClick:()=>{er.mutate(J)},disabled:er.isPending,children:er.isPending?"Restarting...":"Restart Campaign"})]})]})})]})}e.s(["default",()=>z],47582)},74485,e=>{e.n(e.i(47582))}]);